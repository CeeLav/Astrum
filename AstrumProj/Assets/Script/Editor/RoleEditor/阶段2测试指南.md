# 角色编辑器 - 阶段2测试指南

> 📅 完成日期：2025-10-08  
> ✅ 状态：待测试

## 快速测试步骤

### 1. 刷新Unity项目

在Unity编辑器中：
- 按 `Ctrl+R` 或点击 `Assets > Refresh`
- 等待Unity重新编译（应该没有错误）

### 2. 打开角色编辑器

菜单路径：
```
Tools > Role & Skill Editor > Role Editor
```

### 3. 功能测试清单

#### 基础功能测试

✅ **窗口打开**
- [ ] 窗口正常打开，显示三个面板
- [ ] 左侧显示角色列表
- [ ] 中间显示详情面板
- [ ] 右侧显示预览面板

✅ **数据加载**
- [ ] Console显示：`[RoleEditor] Loaded X roles`
- [ ] 列表显示所有角色
- [ ] 第一个角色自动选中

✅ **列表操作**
- [ ] 点击角色可以选中
- [ ] 选中的角色有高亮背景
- [ ] 搜索框可以过滤角色
- [ ] 点击 × 可以清空搜索

✅ **CRUD操作**
- [ ] 点击"新建"创建新角色
- [ ] 新角色ID自动生成（不重复）
- [ ] 点击"复制"克隆角色
- [ ] 克隆角色名称自动加"_Copy"
- [ ] 点击"删除"弹出确认对话框
- [ ] 确认后角色被删除

#### 详情面板测试（Odin）

✅ **Odin UI自动生成**
- [ ] 看到"实体配置"分组
- [ ] 看到"角色配置"分组
- [ ] 所有字段都有中文标签
- [ ] Range字段显示滑块
- [ ] 模型路径有文件夹选择器

✅ **数据编辑**
- [ ] 修改任意字段
- [ ] 角色列表项显示 * 标记
- [ ] 状态栏显示"[已修改]"
- [ ] 顶部工具栏显示未保存数量

✅ **数据验证**
- [ ] 输入非法值会有提示（Odin Range限制）
- [ ] 保存时会验证所有数据

#### 预览面板测试

✅ **模型预览**
- [ ] 选中角色后右侧显示模型
- [ ] 如果没有模型，显示"请先选择一个角色"
- [ ] 左键拖拽可以旋转模型
- [ ] 滚轮可以缩放
- [ ] 点击"重置视角"恢复初始状态

✅ **动画播放**
- [ ] 底部显示动画控制面板
- [ ] 动画下拉框显示可用动作（待机、行走等）
- [ ] 选择动画后自动播放
- [ ] "播放/暂停"按钮切换播放状态
- [ ] "停止"按钮重置到开头
- [ ] 速度滑块可以调整播放速度（0.1x - 2.0x）

#### 保存和加载测试

✅ **保存功能**
- [ ] 修改角色数据
- [ ] 点击"保存"按钮
- [ ] Console显示保存成功
- [ ] 弹出"保存成功"对话框
- [ ] 检查CSV文件是否更新
- [ ] 检查是否生成备份文件

✅ **加载功能**
- [ ] 关闭编辑器窗口
- [ ] 重新打开
- [ ] 数据正确加载
- [ ] 修改被保留

✅ **未保存提醒**
- [ ] 修改数据但不保存
- [ ] 关闭窗口
- [ ] 弹出"未保存的修改"对话框
- [ ] 选择"保存"后数据被保存
- [ ] 选择"不保存"后修改丢失

---

## 常见问题排查

### 问题1：窗口打开但列表为空

**可能原因**：
- CSV文件读取失败
- 路径配置错误

**检查**：
- 查看Console是否有错误日志
- 运行 `Tools > Role & Skill Editor > Test > Test CSV Read`
- 检查CSV文件是否存在

### 问题2：预览面板显示"请先选择一个角色"

**可能原因**：
- 角色的ModelPath未配置
- 模型资源不存在

**检查**：
- 在详情面板查看"模型路径"字段
- 检查路径对应的Prefab是否存在

### 问题3：动画不播放

**可能原因**：
- ActionID未配置
- ActionTable中的AnimationName路径错误
- 动画资源不存在
- Animancer未正确初始化

**检查**：
- 查看Console是否有 `[ConfigTableHelper]` 或 `[AnimationHelper]` 的错误日志
- 检查ActionTable配置
- 检查动画资源是否存在

### 问题4：编译错误

**可能原因**：
- Animancer未导入
- Odin Inspector未导入
- CsvHelper引用错误

**检查**：
- 从 `Art/` 目录导入 Animancer Lite
- 从 `Art/` 目录导入 Odin Inspector
- 检查 `RoleEditor.asmdef` 配置

### 问题5：ConfigManager初始化失败

**可能原因**：
- Config目录路径错误
- bytes文件不存在

**检查**：
- 查看 `AstrumProj/Config/` 目录是否存在
- 检查是否有 `.bytes` 文件
- 可能需要先运行Luban生成工具

---

## 性能检查

### 预期性能

- [ ] 列表滚动流畅（60fps）
- [ ] 预览窗口旋转流畅（30-60fps）
- [ ] 动画播放流畅（30fps）
- [ ] 切换角色响应迅速（< 0.5秒）

### 如果性能不佳

**优化点**：
1. 减少Repaint频率（只在动画播放时Repaint）
2. 预览分辨率降低
3. 添加资源缓存

---

## 下一步

测试通过后：
1. 创建测试报告文档
2. 记录发现的bug
3. 进行必要的优化
4. 准备进入阶段3（技能编辑器）或阶段4（时间轴系统）

---

## 测试报告模板

```
测试时间：____年__月__日
测试人员：________
Unity版本：________

| 功能项 | 状态 | 备注 |
|--------|------|------|
| 窗口打开 | ✅/❌ | |
| 数据加载 | ✅/❌ | |
| 列表显示 | ✅/❌ | |
| CRUD操作 | ✅/❌ | |
| 详情编辑 | ✅/❌ | |
| 模型预览 | ✅/❌ | |
| 动画播放 | ✅/❌ | |
| 保存功能 | ✅/❌ | |

发现的问题：
1. 
2. 
3. 

建议改进：
1. 
2. 
3. 
```


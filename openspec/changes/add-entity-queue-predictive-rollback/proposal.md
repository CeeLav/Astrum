# Change: 单实体消息队列预测回滚

## Why
当前回滚基于全局世界状态，实体交互耦合导致回滚成本高、延迟大。希望利用按实体解耦的消息队列，让本地实体可低延迟预测执行，同时在权威帧到达时仅对受影响实体进行回滚重放，降低开销并提升手感。

## What Changes
- 为所有对战消息统一携带权威帧编号，消息队列按实体按帧分片管理并可备份重放（服务器下行均为权威消息）。
- 阶段一：仅本地实体预测，创建自影子（shadowId=-entityId）在预测帧运行，原始实体只跑权威；影子产生的预测消息不作用于权威，外发交互消息标记预测帧，目标实体待权威帧追平后消费。
- 阶段二：可为被作用的其他实体创建影子做预测交互，与对应权威实体对齐哈希，不一致回滚影子重放，一致后收敛销毁。
- 定义回滚触发策略：按权威帧批次回滚重放，避免第三方输入逐条触发；无输入数据的非玩家实体保持权威驱动。

## Impact
- 规范：新增 frame-sync 能力（单实体预测、回滚与消息队列约束）。
- 代码：帧同步/回滚管线、消息队列结构（如 FrameSyncHandler、消息处理器）、实体模拟/哈希比对工具。


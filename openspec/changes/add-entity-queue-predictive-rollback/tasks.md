## 1. 方案落地
- [ ] 1.1 复盘现有帧同步/回滚与消息处理流程（FrameSyncHandler、WorldSnapshot* 相关 Handler），梳理可挂接的队列与回滚点。
- [ ] 1.2 设计并落地按实体、按帧分片的消息队列与备份数据结构（含帧号戳），确认序列化/持久化方式。
- [ ] 1.3 阶段一实现：本地实体预测执行、发送消息附带预测帧号，其他实体在权威帧追平后再消费；支持基于权威帧的单实体回滚与重放。
- [ ] 1.4 阶段二实现：交互时创建影子实体做预测，维护权威实体同步；实现帧级哈希比对、影子实体回滚与减速收敛/销毁流程。
- [ ] 1.5 回滚触发策略与无输入实体处理：按权威帧批次触发回滚，避免逐条第三方输入触发；无输入/AI实体保持权威驱动。

## 2. 验证
- [ ] 2.1 单元/组件测试：消息帧号标记、队列分片、回滚重放、哈希比对与影子实体收敛。
- [ ] 2.2 集成/回归：端到端帧同步场景（本地预测/权威追帧/回滚）、含第三方输入的顺序一致性校验。
- [ ] 2.3 规范校验：`openspec validate add-entity-queue-predictive-rollback --strict` 并修正所有问题。


## 0. 预备
- [x] 0.1 清理现有"全局世界预测回滚"路径（代码/配置/开关），确保不会与按实体队列方案并存；保留权威回放与快照校正。
  - 已移除 `ClientLSController.Rollback` 中的全局世界回滚逻辑（清理整个 World、替换 MainWorld、重放所有输入）
  - 已移除 `SetOneFrameInputs` 中的全局回滚触发逻辑（输入不匹配时的 Rollback 调用）
  - 已保留 `SaveState`/`LoadState` 方法（后续影子回滚需要快照功能）
  - 已保留 `FrameBuffer` 快照功能

## 1. 方案落地
- [ ] 1.1 复盘现有帧同步/回滚与消息处理流程（FrameSyncHandler、WorldSnapshot* 相关 Handler），梳理可挂接的队列与回滚点。
- [ ] 1.2 设计并落地按实体、按帧分片的消息队列与备份数据结构（含帧号戳），确认序列化/持久化方式。
- [ ] 1.3 阶段一实现：仅本地实体预测，创建自影子（shadowId=-entityId）在预测帧运行，原始实体只跑权威；影子消息不作用权威；外发消息标记预测帧，目标实体在权威帧追平后消费；支持基于权威帧的影子回滚与重放。
- [ ] 1.4 阶段二实现：可为被作用的其他实体创建影子预测交互，维护与对应权威实体的哈希比对；实现影子回滚、重放与收敛/销毁流程。
- [ ] 1.5 回滚触发策略与无输入实体处理：按权威帧批次触发回滚，避免逐条第三方输入触发；无输入/AI实体保持权威驱动。

## 2. 验证
- [ ] 2.1 单元/组件测试：消息帧号标记、队列分片、回滚重放、哈希比对与影子实体收敛。
- [ ] 2.2 集成/回归：端到端帧同步场景（本地预测/权威追帧/回滚）、含第三方输入的顺序一致性校验。
- [ ] 2.3 规范校验：`openspec validate add-entity-queue-predictive-rollback --strict` 并修正所有问题。


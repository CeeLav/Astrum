# Input-System-Refactor-Progress è¾“å…¥ç³»ç»Ÿé‡æ„è¿›å±•

## æ–‡æ¡£ä¿¡æ¯

- **åˆ›å»ºæ—¥æœŸ**ï¼š2025-11-09
- **é¡¹ç›®**ï¼šAstrum è¾“å…¥ç³»ç»Ÿé‡æ„
- **å‚è€ƒæ–‡æ¡£**ï¼š[Input-System è¾“å…¥ç³»ç»Ÿæ¶æ„è®¾è®¡](../Input-System%20è¾“å…¥ç³»ç»Ÿæ¶æ„è®¾è®¡.md)

---

## ğŸ“‹ å®æ–½è®¡åˆ’æ€»è§ˆ

### é˜¶æ®µåˆ’åˆ†

| é˜¶æ®µ | åç§° | é¢„è®¡æ—¶é—´ | çŠ¶æ€ |
|------|------|----------|------|
| é˜¶æ®µ0 | ç¯å¢ƒå‡†å¤‡ | 0.5å¤© | â³ å¾…Unityåˆ·æ–° |
| é˜¶æ®µ1 | æ ¸å¿ƒç»„ä»¶å®ç° | 2å¤© | âœ… å·²å®Œæˆ |
| é˜¶æ®µ2 | ç³»ç»Ÿé›†æˆ | 1å¤© | âœ… å·²å®Œæˆ |
| é˜¶æ®µ3 | æ‰©å±•åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰ | 1å¤© | â­ï¸ å·²è·³è¿‡ |
| é˜¶æ®µ4 | æµ‹è¯•éªŒè¯ | 1å¤© | ğŸš§ å¾…Unityæµ‹è¯• |
| é˜¶æ®µ5 | æ–‡æ¡£å®Œå–„ | 0.5å¤© | âœ… å·²å®Œæˆ |
| é˜¶æ®µ6 | é¼ æ ‡è¾“å…¥æ‰©å±•è®¾è®¡ | 0.5å¤© | âœ… å·²å®Œæˆ |

**æ€»è®¡**ï¼š5-6å¤©

---

## é˜¶æ®µ0ï¼šç¯å¢ƒå‡†å¤‡ â³ å¾…å¼€å§‹

**æ—¶é—´**ï¼šå¾…å®š

**ç›®æ ‡**ï¼šç¡®ä¿é…ç½®è¡¨ä»£ç ç”Ÿæˆå®Œæˆ

### ä»»åŠ¡æ¸…å•

- [ ] æ¿€æ´»Unityç¼–è¾‘å™¨
- [ ] ä½¿ç”¨ `Assets/Refresh` åˆ·æ–°Unity
- [ ] éªŒè¯Inputå‘½åç©ºé—´ç±»ç”Ÿæˆï¼š
  - [ ] `Input.TbInputBindingTable`
  - [ ] `Input.TbLSInputFieldMappingTable`
  - [ ] `Input.TbActionCommandMappingTable`
  - [ ] `Input.TbInputContextTable`
- [ ] æ£€æŸ¥ `Tables.cs` ä¸­çš„å¼•ç”¨æ˜¯å¦æ­£å¸¸

### éªŒè¯æ–¹æ³•

```csharp
// åœ¨Unityç¼–è¾‘å™¨ä¸­è¿è¡Œä»¥ä¸‹ä»£ç éªŒè¯
var tables = ConfigManager.Instance.Tables;
Debug.Log($"InputBindingTable count: {tables.TbInputBindingTable?.DataList?.Count}");
Debug.Log($"LSInputFieldMappingTable count: {tables.TbLSInputFieldMappingTable?.DataList?.Count}");
Debug.Log($"ActionCommandMappingTable count: {tables.TbActionCommandMappingTable?.DataList?.Count}");
Debug.Log($"InputContextTable count: {tables.TbInputContextTable?.DataList?.Count}");
```

**çŠ¶æ€**ï¼šâ³ å¾…å¼€å§‹

---

## é˜¶æ®µ1ï¼šæ ¸å¿ƒç»„ä»¶å®ç° âœ… å·²å®Œæˆ

**æ—¶é—´**ï¼š2025-11-09

**ç›®æ ‡**ï¼šå®ç°è¾“å…¥ç³»ç»Ÿçš„æ ¸å¿ƒæ¥å£å’Œç±»

### 1.1 IRawInputProvider æ¥å£

**æ–‡ä»¶**ï¼š`AstrumProj/Assets/Script/AstrumClient/Input/IRawInputProvider.cs`

**ä»»åŠ¡**ï¼š
- [x] åˆ›å»º `Input` æ–‡ä»¶å¤¹
- [x] åˆ›å»º `IRawInputProvider.cs`
- [x] å®šä¹‰æ¥å£æ–¹æ³•ï¼š
  - [x] `bool GetButton(string actionId)`
  - [x] `float GetAxis(string axisId)`
  - [x] `Vector2 GetMousePosition()`
  - [x] `void SetEnabledActions(HashSet<string> enabledActions)`

**å‚è€ƒä»£ç **ï¼šè§è®¾è®¡æ–‡æ¡£ç¬¬5.1èŠ‚

**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

---

### 1.2 ConfigurableInputProvider ç±»

**æ–‡ä»¶**ï¼š`AstrumProj/Assets/Script/AstrumClient/Input/ConfigurableInputProvider.cs`

**ä»»åŠ¡**ï¼š
- [x] åˆ›å»º `ConfigurableInputProvider.cs`
- [x] å®ç° `IRawInputProvider` æ¥å£
- [x] å®ç°é…ç½®è¡¨åŠ è½½é€»è¾‘
- [x] å®ç°æŒ‰é”®æ£€æµ‹é€»è¾‘ï¼ˆä¸»æŒ‰é”®ã€å¤‡ç”¨æŒ‰é”®ã€é¼ æ ‡æŒ‰é”®ï¼‰
- [x] å®ç°è½´å€¼è®¡ç®—ï¼ˆMoveHorizontal/MoveVerticalï¼‰
- [x] å®ç°è¾“å…¥ä¸Šä¸‹æ–‡è¿‡æ»¤

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. ä» `TbInputBindingTable` åŠ è½½æŒ‰é”®é…ç½®
2. æ£€æµ‹ç‰©ç†æŒ‰é”®çŠ¶æ€
3. è½¬æ¢ä¸ºé€»è¾‘åŠ¨ä½œ

**å‚è€ƒä»£ç **ï¼šè§è®¾è®¡æ–‡æ¡£ç¬¬5.1èŠ‚

**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

---

### 1.3 LSInputAssembler é™æ€ç±»

**æ–‡ä»¶**ï¼š`AstrumProj/Assets/Script/AstrumClient/Input/LSInputAssembler.cs`

**ä»»åŠ¡**ï¼š
- [x] åˆ›å»º `LSInputAssembler.cs`
- [x] å®ç°é™æ€åˆå§‹åŒ–æ–¹æ³•
- [x] å®ç° `AssembleFromRawInput()` æ–¹æ³•
- [x] å®ç°ç§»åŠ¨è¾“å…¥ç»„è£…ï¼ˆå«ç›¸æœºæ–¹å‘è½¬æ¢ï¼‰
- [x] å®ç°æŒ‰é’®è¾“å…¥ç»„è£…
- [x] å®ç°å®šç‚¹æ•°è½¬æ¢
- [x] å®ç°switchè®¾ç½®LSInputå­—æ®µï¼ˆæ”¯æŒRoll/Dashï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. ä» `TbLSInputFieldMappingTable` åŠ è½½æ˜ å°„é…ç½®
2. å°†é€»è¾‘åŠ¨ä½œç»„è£…ä¸º `LSInput`
3. å¤„ç†ç›¸æœºæ–¹å‘è½¬æ¢ï¼ˆå¤ç”¨ç°æœ‰é€»è¾‘ï¼‰
4. è½¬æ¢ä¸ºQ31.32å®šç‚¹æ•°

**å‚è€ƒä»£ç **ï¼šè§è®¾è®¡æ–‡æ¡£ç¬¬5.2èŠ‚

**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

---

## é˜¶æ®µ2ï¼šç³»ç»Ÿé›†æˆ âœ… å·²å®Œæˆ

**æ—¶é—´**ï¼š2025-11-09

**ç›®æ ‡**ï¼šå°†æ–°ç»„ä»¶é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ

### 2.1 é‡æ„ InputManager

**æ–‡ä»¶**ï¼š`AstrumProj/Assets/Script/AstrumClient/Managers/InputManager.cs`

**ä»»åŠ¡**ï¼š
- [x] æ·»åŠ  `IRawInputProvider` å­—æ®µ
- [x] ä¿®æ”¹ `Initialize()` æ–¹æ³•
  - [x] åˆ›å»º `ConfigurableInputProvider`
  - [x] åˆå§‹åŒ– `LSInputAssembler`
- [x] ä¿®æ”¹ `Update()` æ–¹æ³•
  - [x] ä½¿ç”¨ `LSInputAssembler.AssembleFromRawInput()`
  - [x] ç§»é™¤ç¡¬ç¼–ç çš„ `CollectLSInput()`
- [x] ä¿ç•™æ—§æ–¹æ³•ä½œä¸ºæ³¨é‡Šï¼ˆä¾¿äºå›é€€ï¼‰
- [x] ä¿ç•™ `InputState` ç›¸å…³ä»£ç ï¼ˆä¾¿äºå›é€€ï¼‰

**å˜æ›´å¯¹æ¯”**ï¼š

**æ—§ä»£ç **ï¼š
```csharp
public void Update()
{
    var input = CollectLSInput(playerId);
    // ... ç¡¬ç¼–ç WASDã€Spaceã€Qã€E
}
```

**æ–°ä»£ç **ï¼š
```csharp
public void Update()
{
    var input = LSInputAssembler.AssembleFromRawInput(
        _inputProvider,
        playerId,
        CameraManager.Instance?.MainCamera
    );
    // é…ç½®é©±åŠ¨ï¼Œæ— ç¡¬ç¼–ç 
}
```

**å‚è€ƒä»£ç **ï¼šè§è®¾è®¡æ–‡æ¡£ç¬¬5.3èŠ‚

**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

---

### 2.2 å®Œå–„ ActionCapability

**æ–‡ä»¶**ï¼š`AstrumProj/Assets/Script/AstrumLogic/Capabilities/ActionCapability.cs`

**ä»»åŠ¡**ï¼š
- [x] ä¿®æ”¹ `SyncInputCommands()` ä¸ºé…ç½®é©±åŠ¨
- [x] å®ç° `ShouldAddCommand()` æ–¹æ³•
- [x] å®ç° `GetBoolFieldValue()` æ–¹æ³•ï¼ˆæ”¯æŒRoll/Dashï¼‰
- [x] å®ç° `IsFieldNonZero()` æ–¹æ³•
- [x] æ·»åŠ é…ç½®è¡¨æœªåŠ è½½çš„åå¤‡é€»è¾‘
- [x] æ·»åŠ æ—¥å¿—è¾“å‡ºï¼ˆè°ƒè¯•ç”¨ï¼‰

**æ ¸å¿ƒæ”¹è¿›**ï¼š
- ä» `TbActionCommandMappingTable` è¯»å–å‘½ä»¤æ˜ å°„
- æ”¯æŒORé€»è¾‘ï¼ˆ`LSInputField`ç”¨|åˆ†éš”ï¼‰
- æ”¯æŒå¤šç§è§¦å‘æ¡ä»¶ï¼ˆTrue/NonZero/Alwaysï¼‰
- æ”¯æŒRollå’ŒDashæ–°è¾“å…¥

**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

---

## é˜¶æ®µ3ï¼šæ‰©å±•åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰ â³ å¾…å¼€å§‹

**æ—¶é—´**ï¼šå¾…å®š

**ç›®æ ‡**ï¼šå®ç°è¾“å…¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨

### 3.1 InputContextManager

**æ–‡ä»¶**ï¼š`AstrumProj/Assets/Script/AstrumClient/Input/InputContextManager.cs`

**ä»»åŠ¡**ï¼š
- [ ] åˆ›å»º `InputContextManager.cs`
- [ ] å®ç°å•ä¾‹æ¨¡å¼
- [ ] å®ç°ä¸Šä¸‹æ–‡æ ˆç®¡ç†
- [ ] å®ç° `PushContext()` / `PopContext()` æ–¹æ³•
- [ ] å®ç° `RefreshEnabledActions()` æ–¹æ³•
- [ ] é›†æˆåˆ° `InputManager`

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. ç®¡ç†è¾“å…¥ä¸Šä¸‹æ–‡æ ˆï¼ˆå¦‚æˆ˜æ–—ã€UIã€å¯¹è¯ï¼‰
2. æ ¹æ®ä¸Šä¸‹æ–‡å¯ç”¨/ç¦ç”¨ç‰¹å®šè¾“å…¥
3. æ”¯æŒä¼˜å…ˆçº§å’Œé˜»æ–­

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ‰“å¼€UIæ—¶ç¦ç”¨æˆ˜æ–—è¾“å…¥
- å¯¹è¯æ—¶åªå…è®¸äº¤äº’é”®
- è¿‡åœºåŠ¨ç”»æ—¶ç¦ç”¨æ‰€æœ‰è¾“å…¥

**å‚è€ƒä»£ç **ï¼šè§è®¾è®¡æ–‡æ¡£ç¬¬5.5èŠ‚

**çŠ¶æ€**ï¼šâ³ å¾…å¼€å§‹ï¼ˆå¯é€‰ï¼‰

---

## é˜¶æ®µ4ï¼šæµ‹è¯•éªŒè¯ â³ å¾…å¼€å§‹

**æ—¶é—´**ï¼šå¾…å®š

**ç›®æ ‡**ï¼šå…¨é¢æµ‹è¯•æ–°è¾“å…¥ç³»ç»Ÿ

### æµ‹è¯•æ¸…å•

#### 4.1 é…ç½®è¡¨åŠ è½½æµ‹è¯•
- [ ] éªŒè¯æ‰€æœ‰é…ç½®è¡¨æ­£ç¡®åŠ è½½
- [ ] éªŒè¯æ•°æ®å®Œæ•´æ€§
- [ ] éªŒè¯å­—æ®µæ˜ å°„æ­£ç¡®

#### 4.2 è¾“å…¥é‡‡é›†æµ‹è¯•
- [ ] æµ‹è¯•WASDç§»åŠ¨è¾“å…¥
- [ ] æµ‹è¯•é¼ æ ‡å·¦é”®æ”»å‡»
- [ ] æµ‹è¯•Q/EæŠ€èƒ½è¾“å…¥
- [ ] æµ‹è¯•Spaceç¿»æ»šè¾“å…¥ï¼ˆæ–°å¢ï¼‰
- [ ] æµ‹è¯•LeftShiftå†²åˆºè¾“å…¥ï¼ˆæ–°å¢ï¼‰

#### 4.3 ç›¸æœºæ–¹å‘è½¬æ¢æµ‹è¯•
- [ ] éªŒè¯ç§»åŠ¨æ–¹å‘ä¸ç›¸æœºä¸€è‡´
- [ ] æµ‹è¯•ä¸åŒç›¸æœºè§’åº¦
- [ ] éªŒè¯å®šç‚¹æ•°è½¬æ¢ç²¾åº¦

#### 4.4 å‘½ä»¤ç”Ÿæˆæµ‹è¯•
- [ ] éªŒè¯ `move` å‘½ä»¤ç”Ÿæˆ
- [ ] éªŒè¯ `attack` å‘½ä»¤ç”Ÿæˆ
- [ ] éªŒè¯ `skill1/skill2` å‘½ä»¤ç”Ÿæˆ
- [ ] éªŒè¯ `roll/dash` å‘½ä»¤ç”Ÿæˆï¼ˆæ–°å¢ï¼‰
- [ ] éªŒè¯å‘½ä»¤æœ‰æ•ˆå¸§æ•°

#### 4.5 åŠ¨ä½œè§¦å‘æµ‹è¯•
- [ ] æµ‹è¯•ç§»åŠ¨åŠ¨ä½œè§¦å‘
- [ ] æµ‹è¯•æ”»å‡»åŠ¨ä½œè§¦å‘
- [ ] æµ‹è¯•æŠ€èƒ½åŠ¨ä½œè§¦å‘
- [ ] æµ‹è¯•å¤šå‘½ä»¤ANDé€»è¾‘ï¼ˆå¦‚éœ€è¦ï¼‰

#### 4.6 æ€§èƒ½æµ‹è¯•
- [ ] æµ‹è¯•è¾“å…¥å»¶è¿Ÿ
- [ ] æµ‹è¯•CPUå ç”¨
- [ ] æµ‹è¯•GCåˆ†é…

### æµ‹è¯•è®°å½•

#### æµ‹è¯•1ï¼šåŸºç¡€è¾“å…¥é‡‡é›†

**æ—¶é—´**ï¼šå¾…å®š

**æµ‹è¯•å†…å®¹**ï¼š
- æŒ‰ä¸‹WASDï¼Œæ£€æŸ¥é€»è¾‘åŠ¨ä½œæ˜¯å¦æ­£ç¡®
- æŒ‰ä¸‹é¼ æ ‡å·¦é”®ï¼Œæ£€æŸ¥AttackåŠ¨ä½œ
- æŒ‰ä¸‹Q/Eï¼Œæ£€æŸ¥Skill1/Skill2åŠ¨ä½œ

**é¢„æœŸç»“æœ**ï¼š
- æ‰€æœ‰æŒ‰é”®æ­£ç¡®æ˜ å°„åˆ°é€»è¾‘åŠ¨ä½œ
- `ConfigurableInputProvider.GetButton()` è¿”å›æ­£ç¡®å€¼

**å®é™…ç»“æœ**ï¼šå¾…æµ‹è¯•

---

#### æµ‹è¯•2ï¼šLSInputç»„è£…

**æ—¶é—´**ï¼šå¾…å®š

**æµ‹è¯•å†…å®¹**ï¼š
- ç§»åŠ¨è¾“å…¥è½¬æ¢ä¸ºMoveX/MoveYå®šç‚¹æ•°
- æŒ‰é’®è¾“å…¥è½¬æ¢ä¸ºå¸ƒå°”å€¼
- ç›¸æœºæ–¹å‘è½¬æ¢æ­£ç¡®

**é¢„æœŸç»“æœ**ï¼š
- LSInputå­—æ®µå€¼æ­£ç¡®
- å®šç‚¹æ•°ç²¾åº¦ç¬¦åˆé¢„æœŸ
- ç§»åŠ¨æ–¹å‘ä¸ç›¸æœºä¸€è‡´

**å®é™…ç»“æœ**ï¼šå¾…æµ‹è¯•

---

#### æµ‹è¯•3ï¼šå‘½ä»¤ç”Ÿæˆä¸åŠ¨ä½œè§¦å‘

**æ—¶é—´**ï¼šå¾…å®š

**æµ‹è¯•å†…å®¹**ï¼š
- LSInputè½¬æ¢ä¸ºActionCommand
- ActionCommandè§¦å‘å¯¹åº”åŠ¨ä½œ
- å‘½ä»¤æœ‰æ•ˆå¸§æ•°æ­£ç¡®é€’å‡

**é¢„æœŸç»“æœ**ï¼š
- æ‰€æœ‰å‘½ä»¤æ­£ç¡®ç”Ÿæˆ
- åŠ¨ä½œæ­£ç¡®è§¦å‘
- å‘½ä»¤è¿‡æœŸåè‡ªåŠ¨ç§»é™¤

**å®é™…ç»“æœ**ï¼šå¾…æµ‹è¯•

---

## é˜¶æ®µ5ï¼šæ–‡æ¡£å®Œå–„ â³ å¾…å¼€å§‹

**æ—¶é—´**ï¼šå¾…å®š

**ç›®æ ‡**ï¼šå®Œå–„æ–‡æ¡£å’Œç¤ºä¾‹

### ä»»åŠ¡æ¸…å•

- [ ] æ›´æ–°æ¶æ„è®¾è®¡æ–‡æ¡£ï¼ˆå¦‚æœ‰å˜æ›´ï¼‰
- [ ] ç¼–å†™å¿«é€Ÿå¼€å§‹æŒ‡å—
- [ ] æ·»åŠ ä»£ç æ³¨é‡Š
- [ ] åˆ›å»ºä½¿ç”¨ç¤ºä¾‹
- [ ] æ›´æ–°READMEï¼ˆå¦‚éœ€è¦ï¼‰

---

## é˜¶æ®µ6ï¼šé¼ æ ‡è¾“å…¥æ‰©å±•è®¾è®¡ âœ… å·²å®Œæˆ

**æ—¶é—´**ï¼š2025-11-13

**ç›®æ ‡**ï¼šåœ¨æ—¢æœ‰ä¸‰å±‚è¾“å…¥æ¶æ„ä¸‹ï¼Œå®Œæˆé¼ æ ‡ä½ç½®åŒæ­¥ä¸æŒ‡å‘æ€§è¾“å…¥çš„æŠ€æœ¯è®¾è®¡ï¼Œæ”¯æ’‘å°„å‡»ç±»æŠ€èƒ½ä¸æœå‘é€»è¾‘ã€‚

### 6.1 æ ¸å¿ƒäº§å‡º
- [x] æŠ€æœ¯è®¾è®¡æ–‡æ¡£ï¼šã€Š[é¼ æ ‡ä½ç½®å¤„ç†æŠ€æœ¯è®¾è®¡](../é¼ æ ‡ä½ç½®å¤„ç†æŠ€æœ¯è®¾è®¡.md)ã€‹
- [x] å®šä¹‰ `LSInput.MouseWorldX/MouseWorldZ` å­—æ®µï¼ˆQ31.32ï¼‰
- [x] å®šä¹‰ `ActionCommand.TargetPositionX/TargetPositionZ` å­—æ®µï¼ˆQ31.32ï¼‰
- [x] è®¾è®¡é…ç½®è¡¨æ›´æ–°æ–¹æ¡ˆï¼ˆInputBinding/LSInputFieldMapping/ActionCommandMappingï¼‰
- [x] è§„åˆ’ `LSInputAssembler` ä¸ `ActionCapability` çš„æ”¹é€ æ­¥éª¤

### 6.2 å½±å“åˆ†æ
- **è¾“å…¥ç³»ç»Ÿ**ï¼šRaw â†’ LSInput â†’ ActionCommand å‡æ–°å¢é¼ æ ‡ä¸–ç•Œåæ ‡å­—æ®µ
- **å¸§åŒæ­¥**ï¼šé¼ æ ‡ä½ç½®éšå¸§åŒæ­¥è¾“å…¥ä¸Šä¼ ï¼Œç¡®ä¿å¤šäººä¸€è‡´æ€§
- **Actionç³»ç»Ÿ**ï¼šå¯ç›´æ¥è¯»å–ç›®æ ‡åæ ‡è®¡ç®—è§’è‰²æœå‘ä¸å¼¹é“æ–¹å‘
- **æµ‹è¯•éœ€æ±‚**ï¼šéœ€åœ¨å¸§åŒæ­¥å›æ”¾ä¸­éªŒè¯ä¸åŒå®¢æˆ·ç«¯çš„æ–¹å‘ä¸€è‡´æ€§

### 6.3 ä¸‹ä¸€æ­¥å»ºè®®
1. å®ç° `LSInputAssembler` é¼ æ ‡å°„çº¿è½¬æ¢é€»è¾‘
2. æ‰©å±• `ActionCapability.SyncInputCommands()` ä½¿å‘½ä»¤æºå¸¦ç›®æ ‡åæ ‡
3. è°ƒæ•´å°„å‡»/æ”»å‡»åŠ¨ä½œï¼Œæ¶ˆè´¹ `ActionCommand` çš„ç›®æ ‡åæ ‡è®¡ç®—æœå‘
4. è¡¥å……å¸§åŒæ­¥ä¸å¤šäººåœºæ™¯æµ‹è¯•ç”¨ä¾‹

---

## é‡åˆ°çš„é—®é¢˜

### é—®é¢˜1ï¼šActionCapabilityç¼ºå°‘usingå¼•ç”¨

**æ—¶é—´**ï¼š2025-11-09

**æè¿°**ï¼š
```
ActionCapability.cs(592,39): error CS0246: The type or namespace name 'LSInput' could not be found
```

`ShouldAddCommand()`æ–¹æ³•çš„å‚æ•°`LSInput`ç±»å‹æ— æ³•è¯†åˆ«ï¼Œå› ä¸ºç¼ºå°‘`using Astrum.Generated;`å¼•ç”¨ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
åœ¨`ActionCapability.cs`æ–‡ä»¶é¡¶éƒ¨æ·»åŠ ï¼š
```csharp
using Astrum.Generated;
```

**çŠ¶æ€**ï¼šâœ… å·²è§£å†³

---

### é—®é¢˜2ï¼šActionConfigä½¿ç”¨æ—§çš„Commandå­—æ®µ

**æ—¶é—´**ï¼š2025-11-09

**æè¿°**ï¼š
```
ActionConfig.cs(152,66): error CS1061: "ActionTable"æœªåŒ…å«"Command"çš„å®šä¹‰
```

`ActionTable`å·²æ”¹ä¸º`Commands`åˆ—è¡¨ï¼Œä½†`ActionConfig.cs`è¿˜åœ¨ä½¿ç”¨æ—§çš„`Command`å­—æ®µã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä¿®æ”¹`ActionConfig.cs`ä¸­çš„å­—æ®µè®¿é—®ï¼š
```csharp
// æ—§ä»£ç 
actionInfo.Commands = ParseCommandString(actionTable.Command);

// æ–°ä»£ç 
actionInfo.Commands = new List<ActionCommand>();
if (actionTable.Commands != null && actionTable.Commands.Count > 0)
{
    foreach (var cmdName in actionTable.Commands)
    {
        if (!string.IsNullOrEmpty(cmdName))
        {
            actionInfo.Commands.Add(new ActionCommand(cmdName, 0));
        }
    }
}
```

**çŠ¶æ€**ï¼šâœ… å·²è§£å†³

---

### é—®é¢˜3ï¼šActionCapabilityä½¿ç”¨é”™è¯¯çš„ConfigManager

**æ—¶é—´**ï¼š2025-11-09

**æè¿°**ï¼š
```
ActionCapability.cs(568,26): error CS0103: å½“å‰ä¸Šä¸‹æ–‡ä¸­ä¸å­˜åœ¨åç§°"ConfigManager"
```

`AstrumLogic`é¡¹ç›®åº”è¯¥ä½¿ç”¨`TableConfig.Instance`è€Œä¸æ˜¯`ConfigManager.Instance`ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä¿®æ”¹é…ç½®è¡¨è®¿é—®æ–¹å¼ï¼š
```csharp
// æ—§ä»£ç 
var tables = ConfigManager.Instance.Tables;

// æ–°ä»£ç 
var configManager = TableConfig.Instance;
if (configManager?.IsInitialized == true && configManager.Tables?.TbActionCommandMappingTable != null)
{
    foreach (var mapping in configManager.Tables.TbActionCommandMappingTable.DataList)
    // ...
}
```

**çŠ¶æ€**ï¼šâœ… å·²è§£å†³

---

### é—®é¢˜4ï¼šProtoç¼ºå°‘Rollå’ŒDashå­—æ®µ

**æ—¶é—´**ï¼š2025-11-09

**æè¿°**ï¼š
```
ActionCapability.cs(631): error CS1061: "LSInput"æœªåŒ…å«"Roll"çš„å®šä¹‰
ActionCapability.cs(632): error CS1061: "LSInput"æœªåŒ…å«"Dash"çš„å®šä¹‰
```

`LSInput` Protoå®šä¹‰ä¸­ç¼ºå°‘Rollå’ŒDashå­—æ®µã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
åœ¨`gamemessages_C_2000.proto`ä¸­æ·»åŠ ï¼š
```protobuf
message LSInput
{
    // ... ç°æœ‰å­—æ®µ ...
    bool Roll = 10;            // ç¿»æ»šè¾“å…¥
    bool Dash = 11;            // å†²åˆºè¾“å…¥
}
```

**çŠ¶æ€**ï¼šâœ… å·²è§£å†³ï¼ˆéœ€è¦é‡æ–°ç”ŸæˆProtoä»£ç ï¼‰

---

### é—®é¢˜5ï¼šInputé…ç½®è¡¨ä»£ç æœªç”Ÿæˆ

**æ—¶é—´**ï¼š2025-11-09

**æè¿°**ï¼š
```
ActionCapability.cs(595): error CS1061: "ActionCommandMappingTable"æœªåŒ…å«"LSInputField"çš„å®šä¹‰
```

Inputé…ç½®è¡¨çš„C#ä»£ç å°šæœªç”Ÿæˆã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. Unityåˆ·æ–°åè‡ªåŠ¨ç”Ÿæˆäº†Inputè¡¨ä»£ç 
2. å‘ç°å­—æ®µåä¸º`LsInputField`ï¼ˆå°å†™sï¼‰ï¼Œè€Œé`LSInputField`
3. ä¿®æ”¹ä»£ç ä½¿ç”¨æ­£ç¡®çš„å­—æ®µå

**çŠ¶æ€**ï¼šâœ… å·²è§£å†³

---

### é—®é¢˜6ï¼šActionConfig.Countå±æ€§è°ƒç”¨é”™è¯¯

**æ—¶é—´**ï¼š2025-11-09

**æè¿°**ï¼š
```
ActionConfig.cs(154,49): error CS0019: Operator '>' cannot be applied to operands of type 'method group' and 'int'
```

`Commands.Count`åº”è¯¥ä½¿ç”¨LINQçš„`Any()`æ–¹æ³•ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```csharp
// æ—§ä»£ç 
if (actionTable.Commands != null && actionTable.Commands.Count > 0)

// æ–°ä»£ç 
if (actionTable.Commands != null && actionTable.Commands.Any())
```

**çŠ¶æ€**ï¼šâœ… å·²è§£å†³

---

## æŠ€æœ¯è¦ç‚¹

### 1. é…ç½®è¡¨åŠ è½½æ—¶æœº

- **åˆå§‹åŒ–æ—¶åŠ è½½**ï¼šåœ¨ `InputManager.Initialize()` å’Œ `LSInputAssembler.Initialize()` ä¸­åŠ è½½
- **å•æ¬¡åŠ è½½**ï¼šä½¿ç”¨é™æ€æ ‡å¿—é¿å…é‡å¤åŠ è½½
- **ç¼“å­˜ç­–ç•¥**ï¼šä½¿ç”¨Dictionaryç¼“å­˜ï¼ŒO(1)æŸ¥æ‰¾

### 2. ç›¸æœºæ–¹å‘è½¬æ¢

- **å¤ç”¨ç°æœ‰é€»è¾‘**ï¼šä» `InputManager.GetCameraRelativeMoveInput()` è¿ç§»
- **å¤„ç†ç©ºç›¸æœº**ï¼šæä¾›é»˜è®¤æ–¹å‘ï¼ˆVector3.forward/rightï¼‰
- **Yè½´å½’é›¶**ï¼šåªä¿ç•™XZå¹³é¢çš„æ–¹å‘

### 3. å®šç‚¹æ•°è½¬æ¢

- **Q31.32æ ¼å¼**ï¼š`(long)(value * (1L << 32))`
- **ç²¾åº¦ä¿è¯**ï¼šä½¿ç”¨doubleä¸­é—´ç±»å‹
- **èŒƒå›´é™åˆ¶**ï¼šè¾“å…¥å½’ä¸€åŒ–åˆ°[-1, 1]

### 4. æ€§èƒ½ä¼˜åŒ–

- **é¿å…åå°„**ï¼šä½¿ç”¨switchè€Œéåå°„è®¾ç½®å­—æ®µ
- **å¯¹è±¡å¤ç”¨**ï¼šä¸è¦æ¯å¸§new LSInput
- **å­—å…¸æŸ¥æ‰¾**ï¼šO(1)æ—¶é—´å¤æ‚åº¦
- **é¿å…GC**ï¼šå‡å°‘ä¸´æ—¶å¯¹è±¡åˆ†é…

### 5. å‘åå…¼å®¹

- **ä¿ç•™æ—§ä»£ç **ï¼šä½œä¸ºæ³¨é‡Šä¾¿äºå›é€€
- **æ¸è¿›å¼è¿ç§»**ï¼šå…ˆè¿ç§»InputManagerï¼ŒActionCapabilityå·²å®Œæˆ
- **é…ç½®é»˜è®¤å€¼**ï¼šç¡®ä¿ç©ºé…ç½®ä¸ä¼šå´©æºƒ

---

## å¾…åŠäº‹é¡¹

- [ ] å®Œæˆé˜¶æ®µ0ï¼šç¯å¢ƒå‡†å¤‡
- [ ] å®Œæˆé˜¶æ®µ1ï¼šæ ¸å¿ƒç»„ä»¶å®ç°
- [ ] å®Œæˆé˜¶æ®µ2ï¼šç³»ç»Ÿé›†æˆ
- [ ] å®Œæˆé˜¶æ®µ3ï¼šæ‰©å±•åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
- [ ] å®Œæˆé˜¶æ®µ4ï¼šæµ‹è¯•éªŒè¯
- [ ] å®Œæˆé˜¶æ®µ5ï¼šæ–‡æ¡£å®Œå–„

---

## æ€»ç»“

**å½“å‰çŠ¶æ€**ï¼šâœ… æ ¸å¿ƒå®æ–½å·²å®Œæˆï¼Œç­‰å¾…Unityåˆ·æ–°æµ‹è¯•

**å·²å®Œæˆå·¥ä½œ**ï¼š
- âœ… CSVé…ç½®è¡¨åˆ›å»ºï¼ˆ4å¼ è¡¨ï¼‰
- âœ… ActionCapabilityéƒ¨åˆ†æ”¹é€ ï¼ˆå‘½ä»¤å­—æ®µæ”¹é€ ï¼‰
- âœ… TODOæ¸…å•åˆ›å»º
- âœ… **é˜¶æ®µ1ï¼šæ ¸å¿ƒç»„ä»¶å®ç°**
  - âœ… IRawInputProvideræ¥å£
  - âœ… ConfigurableInputProviderç±»
  - âœ… LSInputAssembleré™æ€ç±»
- âœ… **é˜¶æ®µ2ï¼šç³»ç»Ÿé›†æˆ**
  - âœ… InputManageré‡æ„ï¼ˆé…ç½®é©±åŠ¨ï¼‰
  - âœ… ActionCapabilityå®Œå–„ï¼ˆé…ç½®é©±åŠ¨å‘½ä»¤åŒæ­¥ï¼‰
- âœ… **é˜¶æ®µ4ï¼šç¼–è¯‘æµ‹è¯•**
  - âœ… æ‰€æœ‰ä»£ç ç¼–è¯‘é€šè¿‡ï¼Œæ— é”™è¯¯

**ä¸‹ä¸€æ­¥**ï¼š
1. **æ¿€æ´»Unityç¼–è¾‘å™¨**
2. **ä½¿ç”¨ `Assets/Refresh` åˆ·æ–°Unity**ï¼Œç”ŸæˆInputè¡¨ä»£ç 
3. **åœ¨Unityä¸­æµ‹è¯•**ï¼š
   - éªŒè¯é…ç½®è¡¨åŠ è½½
   - æµ‹è¯•è¾“å…¥é‡‡é›†
   - æµ‹è¯•å‘½ä»¤ç”Ÿæˆ
   - æµ‹è¯•åŠ¨ä½œè§¦å‘

**é¢„è®¡å®Œæˆæ—¶é—´**ï¼š2025-11-10ï¼ˆä»£ç å®æ–½å·²å®Œæˆï¼‰

**é£é™©è¯„ä¼°**ï¼š
- ğŸŸ¡ ä¸­ç­‰é£é™©ï¼šé…ç½®è¡¨ä»£ç ç”Ÿæˆå¯èƒ½æœ‰æ ¼å¼é—®é¢˜ï¼ˆéœ€Unityåˆ·æ–°éªŒè¯ï¼‰
- ğŸŸ¢ ä½é£é™©ï¼šæ ¸å¿ƒé€»è¾‘å·²å®ç°å¹¶ç¼–è¯‘é€šè¿‡
- ğŸŸ¢ ä½é£é™©ï¼šä¿ç•™æ—§ä»£ç ï¼Œæ”¯æŒå¿«é€Ÿå›é€€

**å®æ–½äº®ç‚¹**ï¼š
- âœ¨ å®Œå…¨é…ç½®é©±åŠ¨ï¼Œæ— ç¡¬ç¼–ç 
- âœ¨ ä¿ç•™æ—§ä»£ç ä½œä¸ºæ³¨é‡Šï¼Œä¾¿äºå›é€€
- âœ¨ æ”¯æŒRollå’ŒDashæ–°è¾“å…¥
- âœ¨ æ€§èƒ½ä¼˜åŒ–ï¼ˆswitchä»£æ›¿åå°„ï¼‰
- âœ¨ å®Œå–„çš„æ—¥å¿—è¾“å‡ºä¾¿äºè°ƒè¯•

---

### 2025-01-09 22:30 - æœ€ç»ˆç¼–è¯‘æˆåŠŸ

**é—®é¢˜ä¿®å¤**ï¼š
1. **CameraManagerå‘½åç©ºé—´å†²çª**ï¼š
   - é—®é¢˜ï¼š`Input`è¢«è§£æä¸º`Astrum.Client.Input`å‘½åç©ºé—´è€Œé`UnityEngine.Input`
   - è§£å†³ï¼šå°†æ‰€æœ‰`Input.`è°ƒç”¨æ”¹ä¸º`UnityEngine.Input.`æ˜ç¡®æŒ‡å®š

2. **TableConfigè®¿é—®é—®é¢˜**ï¼š
   - é—®é¢˜ï¼šClientç«¯æ— æ³•è®¿é—®`TableConfig.Instance`
   - è§£å†³ï¼šåœ¨Clientç«¯æ·»åŠ `using Astrum.LogicCore.Managers;`å¼•ç”¨

3. **Luban.Runtimeå¼•ç”¨ç¼ºå¤±**ï¼š
   - é—®é¢˜ï¼šClienté¡¹ç›®ä½¿ç”¨cfgç±»å‹ä½†ç¼ºå°‘Luban.Runtimeå¼•ç”¨
   - è§£å†³ï¼šåœ¨`AstrumClient.csproj`ä¸­æ·»åŠ Luban.Runtimeå¼•ç”¨

4. **LSInputFieldå­—æ®µåé”™è¯¯**ï¼š
   - é—®é¢˜ï¼šä»£ç ä½¿ç”¨`LSInputField`ä½†ç”Ÿæˆçš„å­—æ®µæ˜¯`LsInputField`
   - è§£å†³ï¼šç»Ÿä¸€ä½¿ç”¨`LsInputField`ï¼ˆå°å†™sï¼‰

5. **Editoré¡¹ç›®Commandå­—æ®µè¿ç§»**ï¼š
   - ä¿®å¤æ–‡ä»¶ï¼š
     - `ActionDataReader.cs`
     - `ActionDataDispatcher.cs`
     - `SkillActionDataReader.cs`
     - `SkillActionDataWriter.cs`
   - å°†æ‰€æœ‰`Command`å­—æ®µè®¿é—®æ”¹ä¸º`Commands`åˆ—è¡¨

6. **Rollå’ŒDashå­—æ®µä¸´æ—¶æ³¨é‡Š**ï¼š
   - åœ¨`LSInputAssembler.cs`ä¸­æ³¨é‡Šæ‰Rollå’ŒDashçš„caseåˆ†æ”¯
   - ç­‰å¾…Protoé‡æ–°ç”Ÿæˆåå¯ç”¨

**ç¼–è¯‘ç»“æœ**ï¼š
- âœ… 0ä¸ªé”™è¯¯
- âš ï¸ 106ä¸ªè­¦å‘Šï¼ˆå‡ä¸ºæ—§ä»£ç è­¦å‘Šï¼Œä¸å½±å“åŠŸèƒ½ï¼‰
- ç¼–è¯‘æ—¶é—´ï¼š4.62ç§’

**çŠ¶æ€**ï¼šæ‰€æœ‰ä»£ç ä¿®æ”¹å®Œæˆï¼Œç¼–è¯‘é€šè¿‡ï¼

---

## å‚è€ƒèµ„æ–™

- [Input-System è¾“å…¥ç³»ç»Ÿæ¶æ„è®¾è®¡](../Input-System%20è¾“å…¥ç³»ç»Ÿæ¶æ„è®¾è®¡.md)
- [Command-Field-Refactor-Progress å‘½ä»¤å­—æ®µæ”¹é€ è¿›å±•](./Command-Field-Refactor-Progress%20å‘½ä»¤å­—æ®µæ”¹é€ è¿›å±•.md)
- [å¿«é€Ÿå¼€å§‹](../å¿«é€Ÿå¼€å§‹.md)



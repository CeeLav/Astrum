# 输入系统快速开始

## 一、概述

本输入系统采用**三层架构 + CSV配置驱动**的设计，实现了从物理输入到游戏动作的完整映射链路。

## 二、三层架构

```
第一层：物理输入 → 逻辑动作
  配置：InputBindingTable.csv
  示例：KeyCode.W → "MoveForward"

第二层：逻辑动作 → 帧同步输入
  配置：LSInputFieldMappingTable.csv
  示例：MoveForward + 相机方向 → LSInput.MoveY

第三层：帧同步输入 → 动作指令
  配置：ActionCommandMappingTable.csv
  示例：LSInput.Attack → ActionCommand("attack")
```

## 三、配置表位置

所有配置表位于：`AstrumConfig/Tables/Datas/Input/`

| 配置表 | 功能 |
|--------|------|
| #InputBindingTable.csv | 按键绑定 |
| #LSInputFieldMappingTable.csv | LSInput映射 |
| #ActionCommandMappingTable.csv | 命令映射 |
| #InputContextTable.csv | 输入上下文 |

## 四、常见操作

### 修改按键绑定

编辑 `#InputBindingTable.csv`：

```csv
# 将攻击改为鼠标左键
Attack,攻击,None,None,0,Button,Combat
```

### 添加新输入

1. 在 `#InputBindingTable.csv` 添加：
   ```csv
   Jump,跳跃,Space,None,-1,Button,Movement
   ```

2. 修改 `gamemessages_C_2000.proto` 添加字段：
   ```protobuf
   bool Jump = 10;
   ```

3. 在 `#LSInputFieldMappingTable.csv` 添加：
   ```csv
   Jump,DirectButton,Jump,false,直接映射Jump按钮
   ```

4. 在 `#ActionCommandMappingTable.csv` 添加：
   ```csv
   jump,Jump,True,2,5,跳跃
   ```

5. 运行Luban生成工具

### 使用输入上下文

```csharp
// 打开UI时禁用战斗输入
InputContextManager.Instance.PushContext("UI");

// 关闭UI时恢复
InputContextManager.Instance.PopContext();
```

## 五、实施状态

- ✅ 架构设计完成
- ✅ CSV配置表创建
- ⏳ 代码实现（待开始）
- ⏳ 测试验证（待开始）

## 六、下一步

1. 配置Luban生成规则
2. 实现核心代码（IRawInputProvider、LSInputAssembler等）
3. 重构InputManager
4. 修改ActionCapability
5. 测试验证

## 七、详细文档

完整设计文档：[Input-System 输入系统架构设计](./Input-System%20输入系统架构设计.md)

## 八、优势

✅ **配置驱动**：修改按键无需改代码  
✅ **易于扩展**：添加新输入只需修改配置表  
✅ **职责清晰**：每层单一职责  
✅ **统一体系**：与项目Luban配置表一致  
✅ **版本友好**：CSV文本格式，Git diff友好  


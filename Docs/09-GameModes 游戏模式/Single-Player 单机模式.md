# ğŸ¯ å•æœºæ¨¡å¼è®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: v0.3.0  
**çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæˆ  
**æœ€åæ›´æ–°**: 2025-10-11

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [è®¾è®¡ç›®æ ‡](#è®¾è®¡ç›®æ ‡)
3. [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
4. [å¯åŠ¨æµç¨‹](#å¯åŠ¨æµç¨‹)
5. [å¸§å¾ªç¯æœºåˆ¶](#å¸§å¾ªç¯æœºåˆ¶)
6. [AIç³»ç»Ÿ](#aiç³»ç»Ÿ)
7. [å­˜æ¡£ç³»ç»Ÿ](#å­˜æ¡£ç³»ç»Ÿ)
8. [å…³å¡ç³»ç»Ÿ](#å…³å¡ç³»ç»Ÿ)
9. [ä¸è”æœºæ¨¡å¼çš„åŒºåˆ«](#ä¸è”æœºæ¨¡å¼çš„åŒºåˆ«)

---

## æ¦‚è¿°

å•æœºæ¨¡å¼æ˜¯ Astrum æ¸¸æˆçš„æœ¬åœ°æ¸¸ç©æ–¹å¼ï¼Œç©å®¶æ— éœ€è¿æ¥æœåŠ¡å™¨å³å¯ä½“éªŒå®Œæ•´çš„æ¸¸æˆå†…å®¹ã€‚è¯¥æ¨¡å¼é‡‡ç”¨**æœ¬åœ°å¸§åŒæ­¥**æ¶æ„ï¼Œä¸è”æœºæ¨¡å¼å…±äº«ç›¸åŒçš„é€»è¾‘å±‚ä»£ç ï¼Œç¡®ä¿æ¸¸æˆä½“éªŒçš„ä¸€è‡´æ€§ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **æ— ç½‘ç»œä¾èµ–** - å®Œå…¨æœ¬åœ°è¿è¡Œï¼Œ0å»¶è¿Ÿ
- **ç¡®å®šæ€§é€»è¾‘** - ä½¿ç”¨ TrueSync ç¡®ä¿é€»è¾‘ç¡®å®šæ€§
- **AIå¯¹æ‰‹** - æ™ºèƒ½AIæ›¿ä»£çœŸå®ç©å®¶
- **å­˜æ¡£æ”¯æŒ** - æœ¬åœ°å­˜æ¡£ç³»ç»Ÿ
- **å¯æš‚åœ** - æ”¯æŒæ¸¸æˆæš‚åœå’Œç»§ç»­
- **è°ƒè¯•å‹å¥½** - ä¾¿äºå¼€å‘å’Œæµ‹è¯•

---

## è®¾è®¡ç›®æ ‡

### å¼€å‘é˜¶æ®µç›®æ ‡

1. **å¿«é€ŸéªŒè¯ç©æ³•** ğŸ®
   - ä¸ä¾èµ–æœåŠ¡å™¨å’Œç½‘ç»œï¼Œå¿«é€Ÿè¿­ä»£æ ¸å¿ƒç©æ³•
   - æä¾›å®Œæ•´çš„æˆ˜æ–—ã€æŠ€èƒ½ã€ç‰©ç†ç³»ç»Ÿæµ‹è¯•ç¯å¢ƒ

2. **é€»è¾‘å±‚æµ‹è¯•** ğŸ§ª
   - ä½œä¸ºé€»è¾‘å±‚çš„ä¸»è¦æµ‹è¯•ç¯å¢ƒ
   - éªŒè¯ ECC æ¶æ„ã€å¸§åŒæ­¥ã€ç¢°æ’æ£€æµ‹ç­‰æ ¸å¿ƒç³»ç»Ÿ

3. **å†…å®¹å¼€å‘åŸºç¡€** ğŸ“¦
   - å…³å¡è®¾è®¡å’Œæµ‹è¯•
   - AIè¡Œä¸ºè°ƒè¯•
   - æ•°å€¼å¹³è¡¡

### ç©å®¶ä½“éªŒç›®æ ‡

1. **å®Œæ•´æ¸¸æˆä½“éªŒ** âœ…
   - æä¾›ä¸è”æœºæ¨¡å¼ç›¸åŒè´¨é‡çš„æˆ˜æ–—ä½“éªŒ
   - æ”¯æŒæ‰€æœ‰è§’è‰²ã€æŠ€èƒ½ã€è£…å¤‡ç³»ç»Ÿ

2. **æµç•…æ€§èƒ½** âš¡
   - 60 FPS ç¨³å®šå¸§ç‡
   - å³æ—¶å“åº”ï¼Œæ— å»¶è¿Ÿ

3. **è¿›åº¦ä¿å­˜** ğŸ’¾
   - å…³å¡è¿›åº¦è‡ªåŠ¨ä¿å­˜
   - è§’è‰²æˆé•¿æ•°æ®æŒä¹…åŒ–

---

## æ ¸å¿ƒæ¶æ„

### ç³»ç»Ÿç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         GameApplication (å…¥å£)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GameConfig   â”‚       â”‚GamePlayManagerâ”‚
â”‚  (é…ç½®ç®¡ç†)   â”‚       â”‚  (æ¸¸æˆç®¡ç†)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“                       â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚     Room     â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚    World    â”‚
            â”‚  (æ¸¸æˆæˆ¿é—´)   â”‚        â”‚ (ECSä¸–ç•Œ)   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚     Stage    â”‚
            â”‚  (è¡¨ç°èˆå°)   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç±»è¯´æ˜

#### 1. GameConfig
**è·¯å¾„**: `AstrumClient/Core/GameConfig.cs`

**èŒè´£**:
- ç®¡ç†æ¸¸æˆæ¨¡å¼çŠ¶æ€ï¼ˆå•æœº/è”æœºï¼‰
- æ¸¸æˆéš¾åº¦è®¾ç½®
- å…¨å±€é…ç½®ç®¡ç†

**å…³é”®æ¥å£**:
```csharp
public bool IsSinglePlayerMode { get; }
public void SetSinglePlayerMode(bool enabled);
public void SetDifficulty(GameDifficulty difficulty);
```

#### 2. GamePlayManager
**è·¯å¾„**: `AstrumClient/Managers/GamePlayManager.cs`

**èŒè´£**:
- è½»é‡çº§å…¥å£ï¼Œå§”æ‰˜ç»™å…·ä½“çš„ GameMode
- æ¨¡å¼é€‰æ‹©å’Œåˆ‡æ¢
- ç»Ÿä¸€çš„å¯¹å¤–æ¥å£

**å…³é”®æ¥å£**:
```csharp
public void StartGame(string gameSceneName);
public void StartSinglePlayerGame(string gameSceneName);  // å…¼å®¹æ¥å£
public Stage MainStage { get; }  // å§”æ‰˜ç»™ GameMode
public Room MainRoom { get; }    // å§”æ‰˜ç»™ GameMode
```

#### 3. SinglePlayerGameMode
**è·¯å¾„**: `AstrumClient/Managers/GameModes/SinglePlayerGameMode.cs`

**èŒè´£**:
- å•æœºæ¸¸æˆçš„å®Œæ•´å¯åŠ¨å’Œè¿è¡Œé€»è¾‘
- Roomã€Worldã€Stage çš„åˆ›å»ºå’Œåˆå§‹åŒ–
- ç©å®¶è§’è‰²çš„åˆ›å»º
- æœ¬åœ°å¸§å¾ªç¯é©±åŠ¨
- æƒå¨å¸§æ¨¡æ‹Ÿï¼ˆæ¨¡æ‹ŸæœåŠ¡å™¨æ¨è¿›ï¼‰

**å…³é”®æ–¹æ³•**:
```csharp
public void Initialize();
public void StartGame(string sceneName);
public void Update(float deltaTime);  // æœ¬åœ°å¸§å¾ªç¯
```

#### 4. Room (é€»è¾‘å±‚)
**è·¯å¾„**: `LogicCore/Core/Room.cs`

**èŒè´£**:
- æ¸¸æˆé€»è¾‘çš„å®¹å™¨
- å¸§åŒæ­¥ç®¡ç†
- ç©å®¶å’Œå®ä½“çš„ç®¡ç†

**å…³é”®å±æ€§**:
```csharp
public World MainWorld { get; set; }
public int RoomId { get; }
public string RoomName { get; }
```

#### 5. World (é€»è¾‘å±‚)
**è·¯å¾„**: `LogicCore/Core/World.cs`

**èŒè´£**:
- ECS ç³»ç»Ÿçš„å®¹å™¨
- å®ä½“çš„åˆ›å»ºå’Œç®¡ç†
- ç³»ç»Ÿçš„æ‰§è¡Œ

#### 6. Stage (è¡¨ç°å±‚)
**è·¯å¾„**: `AstrumView/Core/Stage.cs`

**èŒè´£**:
- Unity åœºæ™¯ç®¡ç†
- å®ä½“è§†å›¾çš„åˆ›å»ºå’ŒåŒæ­¥
- è¡¨ç°å±‚çš„ç”Ÿå‘½å‘¨æœŸ

---

## å¯åŠ¨æµç¨‹

### å®Œæ•´æµç¨‹å›¾

```
ç©å®¶ç‚¹å‡»"å•æœºæ¸¸æˆ"æŒ‰é’®
        â†“
[1] GameConfig.SetSinglePlayerMode(true)
        â†“
[2] GamePlayManager.StartSinglePlayerGame("DungeonsGame")
        â†“
[3] EnsureCorrectGameMode()
    - æ£€æµ‹åˆ°éœ€è¦åˆ›å»º SinglePlayerGameMode
    - åˆ›å»ºå¹¶åˆå§‹åŒ– SinglePlayerGameMode
        â†“
[4] SinglePlayerGameMode.StartGame("DungeonsGame")
        â†“
[5] åˆ›å»º Room(id=1, "SinglePlayerRoom")
    - åˆ›å»º World å¹¶å…³è”åˆ° Room
    - Room.Initialize() åˆ›å»º LSController
        â†“
[6] åˆ›å»º Stage("GameStage")
    - Stage.Initialize()
    - Stage.SetRoom(room)
        â†“
[7] åˆ‡æ¢åˆ°æ¸¸æˆåœºæ™¯ (LoadSceneAsync)
        â†“
[8] åœºæ™¯åŠ è½½å®Œæˆå›è°ƒ OnGameSceneLoaded()
    - å…³é—­ Login UI
    - Stage.SetActive(true)
    - Stage.OnEnter()
    - è®¢é˜… EntityView åˆ›å»ºäº‹ä»¶
        â†“
[9] åˆ›å»ºç©å®¶å®ä½“ CreatePlayer()
    - Room.AddPlayer() åˆ›å»º Entity
    - è®¾ç½® PlayerId å’Œ MainPlayerId
    - LSController.Start() â† å¯åŠ¨å¸§åŒæ­¥
    - åˆ›å»ºå¯¹åº”çš„ EntityView
        â†“
[10] å¼€å§‹æœ¬åœ°å¸§å¾ªç¯
    - Unity Update() é©±åŠ¨
    - SinglePlayerGameMode.Update()
        - AuthorityFrame = PredictionFrame â† æ¨¡æ‹ŸæœåŠ¡å™¨
        - Room.Update() â†’ LSController.Tick()
        - Stage.Update() â†’ æ›´æ–°è¡¨ç°å±‚
        â†“
æ¸¸æˆè¿è¡Œä¸­...
```

### è¯¦ç»†æ­¥éª¤

#### Step 1-2: æ¨¡å¼è®¾ç½®å’Œå¯åŠ¨å…¥å£
```csharp
// åœ¨ LoginView ä¸­ç‚¹å‡»"å•æœºæ¸¸æˆ"æŒ‰é’®
GameConfig.Instance.SetSinglePlayerMode(true);
GamePlayManager.Instance.StartSinglePlayerGame("DungeonsGame");
```

#### Step 3-4: åˆ›å»º SinglePlayerGameMode
```csharp
// GamePlayManager.StartGame() å†…éƒ¨
EnsureCorrectGameMode();  // æ£€æµ‹å¹¶åˆ›å»º SinglePlayerGameMode
_currentGameMode.StartGame("DungeonsGame");  // å§”æ‰˜ç»™ SinglePlayerGameMode
```

#### Step 5-6: åˆ›å»ºé€»è¾‘å±‚ç¯å¢ƒ
```csharp
// SinglePlayerGameMode.StartGame()
var room = new Room(1, "SinglePlayerRoom");
var world = new World();
room.MainWorld = world;
room.Initialize();  // åˆ›å»º LSControllerï¼ˆä½†æœªå¯åŠ¨ï¼‰

Stage gameStage = new Stage("GameStage", "æ¸¸æˆåœºæ™¯");
gameStage.Initialize();
gameStage.SetRoom(room);
```

**å…³é”®ç‚¹**:
- Room ä¸è¿æ¥æœåŠ¡å™¨ï¼Œä½¿ç”¨æœ¬åœ°å¸§åŒæ­¥
- LSController åˆ›å»ºä½†æœªå¯åŠ¨ï¼ˆç­‰å¾…ç©å®¶åˆ›å»ºåå†å¯åŠ¨ï¼‰
- æ‰€æœ‰è¾“å…¥ç›´æ¥åœ¨æœ¬åœ°å¤„ç†

#### Step 7-8: åœºæ™¯åˆ‡æ¢å’ŒåŠ è½½
```csharp
SceneManager.LoadSceneAsync("DungeonsGame", () => {
    OnGameSceneLoaded();
});

// OnGameSceneLoaded()
gameStage.SetActive(true);
gameStage.OnEnter();
```

#### Step 9-10: åˆ›å»ºç©å®¶å¹¶å¯åŠ¨å¸§åŒæ­¥
```csharp
// CreatePlayer()
long playerId = room.AddPlayer();  // åˆ›å»ºç©å®¶å®ä½“
room.MainPlayerId = playerId;  // è®¾ç½®ä¸»ç©å®¶ID

// å¯åŠ¨æœ¬åœ°å¸§åŒæ­¥æ§åˆ¶å™¨ï¼ˆå…³é”®ï¼ï¼‰
room.LSController.CreationTime = TimeInfo.Instance.ServerNow();
room.LSController.Start();  // IsRunning = true

// EntityView ä¼šè‡ªåŠ¨åˆ›å»ºï¼ˆé€šè¿‡äº‹ä»¶ï¼‰
```

**å…³é”®ç‚¹**:
- âœ… å¿…é¡»å¯åŠ¨ LSControllerï¼Œå¦åˆ™å¸§å¾ªç¯ä¸ä¼šæ‰§è¡Œ
- âœ… å¿…é¡»è®¾ç½® MainPlayerIdï¼Œå¦åˆ™è¾“å…¥ä¸ä¼šè¢«å¤„ç†

---

## å¸§å¾ªç¯æœºåˆ¶

### æœ¬åœ°å¸§åŒæ­¥æ¶æ„

å•æœºæ¨¡å¼ä½¿ç”¨**æœ¬åœ°ç¡®å®šæ€§å¸§åŒæ­¥**ï¼Œä¸è”æœºæ¨¡å¼çš„åŒºåˆ«åœ¨äºï¼š

| ç‰¹æ€§ | å•æœºæ¨¡å¼ | è”æœºæ¨¡å¼ |
|------|----------|----------|
| å¸§é©±åŠ¨ | Unity Update() | æœåŠ¡å™¨å¸§æ¨é€ |
| è¾“å…¥æº | æœ¬åœ° InputManager | ç½‘ç»œæ¥æ”¶ |
| å»¶è¿Ÿ | 0ms | ç½‘ç»œå»¶è¿Ÿ |
| ç¡®å®šæ€§ | æœ¬åœ°éªŒè¯ | æœåŠ¡å™¨æƒå¨ |

### å¸§å¾ªç¯æµç¨‹

```
Unity Update()
    â†“
[1] InputManager.Tick()
    - æ”¶é›†é”®ç›˜/é¼ æ ‡è¾“å…¥
    - è½¬æ¢ä¸º Input å¯¹è±¡
    â†“
[2] Room.Tick(input)
    - æ‰§è¡Œé€»è¾‘å¸§
    - æ›´æ–°æ‰€æœ‰ System
    â†“
[3] World.Tick()
    - MovementSystem.Tick()
    - CombatSystem.Tick()
    - PhysicsSystem.Tick()
    - SkillSystem.Tick()
    â†“
[4] Stage.Tick()
    - åŒæ­¥å®ä½“ä½ç½®/çŠ¶æ€
    - æ›´æ–°åŠ¨ç”»çŠ¶æ€
    - è§¦å‘ç‰¹æ•ˆ/éŸ³æ•ˆ
    â†“
[5] Render()
    - Unity æ¸²æŸ“
```

### ä»£ç ç¤ºä¾‹

```csharp
// SinglePlayerGameMode.Update() - å®é™…çš„å¸§å¾ªç¯ä»£ç 
public void Update(float deltaTime)
{
    if (!IsRunning) return;
    
    // å•æœºæ¨¡å¼ï¼šæ¨¡æ‹ŸæœåŠ¡å™¨çš„æƒå¨å¸§æ¨è¿›ï¼ˆå…³é”®ï¼ï¼‰
    // è”æœºæ¨¡å¼ä¸‹ï¼ŒAuthorityFrame ç”±æœåŠ¡å™¨é€šè¿‡ FrameSyncData æ›´æ–°
    // å•æœºæ¨¡å¼ä¸‹ï¼Œè®© AuthorityFrame è·Ÿéš PredictionFrame
    if (MainRoom?.LSController != null && MainRoom.LSController.IsRunning)
    {
        MainRoom.LSController.AuthorityFrame = MainRoom.LSController.PredictionFrame;
    }
    
    // 1. æ›´æ–° Roomï¼ˆæ‰§è¡Œé€»è¾‘å¸§ï¼‰
    MainRoom?.Update(deltaTime);
    //   â”œâ”€ LSController.Tick()
    //   â”‚   â”œâ”€ InputManager å·²è®¾ç½®è¾“å…¥åˆ° LSController
    //   â”‚   â”œâ”€ PredictionFrame++
    //   â”‚   â”œâ”€ GetOneFrameMessages() â†’ è·å–è¾“å…¥
    //   â”‚   â””â”€ Room.FrameTick(inputs) â†’ æ‰§è¡Œé€»è¾‘
    //   â”‚       â”œâ”€ World.Update() â†’ æ›´æ–°æ‰€æœ‰å®ä½“
    //   â”‚       â””â”€ SkillEffectManager.Update()
    
    // 2. æ›´æ–° Stageï¼ˆåŒæ­¥åˆ°è¡¨ç°å±‚ï¼‰
    MainStage?.Update(deltaTime);
    //   â””â”€ æ›´æ–°æ‰€æœ‰ EntityView
}
```

---

## AIç³»ç»Ÿ

> **çŠ¶æ€**: ğŸ“ è§„åˆ’ä¸­

### è®¾è®¡ç›®æ ‡

- æä¾›æŒ‘æˆ˜æ€§çš„AIå¯¹æ‰‹
- æ¨¡æ‹ŸçœŸå®ç©å®¶çš„è¡Œä¸º
- æ”¯æŒå¤šç§éš¾åº¦çº§åˆ«

### AIæ¶æ„ï¼ˆè§„åˆ’ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        AIController            â”‚
â”‚  (AIæ§åˆ¶å™¨ï¼Œç±»ä¼¼ç©å®¶è¾“å…¥)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
        â†“               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DecisionTree â”‚  â”‚  Behavior    â”‚
â”‚   (å†³ç­–æ ‘)    â”‚  â”‚   (è¡Œä¸ºæ ‘)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AIè¾“å…¥ç”Ÿæˆ

AIæ›¿ä»£çœŸå®ç©å®¶ï¼Œç”Ÿæˆ `Input` å¯¹è±¡ï¼š

```csharp
public class AIController
{
    public Input GenerateInput(Entity aiEntity, World world)
    {
        // 1. æ„ŸçŸ¥ç¯å¢ƒ
        var enemies = ScanNearbyEnemies(aiEntity, world);
        var obstacles = ScanObstacles(aiEntity, world);
        
        // 2. å†³ç­–
        var decision = DecideAction(enemies, obstacles);
        
        // 3. ç”Ÿæˆè¾“å…¥
        return new Input
        {
            PlayerId = aiEntity.UniqueId,
            MoveX = decision.MoveDirection.x,
            MoveY = decision.MoveDirection.y,
            Attack = decision.ShouldAttack,
            Skill = decision.SkillIndex
        };
    }
}
```

### éš¾åº¦çº§åˆ«

| éš¾åº¦ | ååº”æ—¶é—´ | å†³ç­–è´¨é‡ | æŠ€èƒ½ä½¿ç”¨ |
|------|----------|----------|----------|
| ç®€å• | æ…¢ (500ms) | åŸºç¡€ | å°‘ |
| æ™®é€š | ä¸­ç­‰ (300ms) | ä¸­ç­‰ | ä¸­ç­‰ |
| å›°éš¾ | å¿« (100ms) | é«˜çº§ | é¢‘ç¹ |
| åœ°ç‹± | å³æ—¶ (0ms) | å®Œç¾ | æœ€ä¼˜ |

---

## å­˜æ¡£ç³»ç»Ÿ

> **çŠ¶æ€**: ğŸ“ è§„åˆ’ä¸­

### å­˜æ¡£å†…å®¹

#### 1. æ¸¸æˆè¿›åº¦
- å·²å®Œæˆçš„å…³å¡
- å½“å‰å…³å¡è¿›åº¦
- è§£é”çš„å†…å®¹

#### 2. è§’è‰²æ•°æ®
- è§’è‰²ç­‰çº§å’Œç»éªŒ
- è§’è‰²å±æ€§
- å·²å­¦ä¹ çš„æŠ€èƒ½
- è£…å¤‡å’Œé“å…·

#### 3. é…ç½®è®¾ç½®
- æ¸¸æˆéš¾åº¦
- éŸ³é¢‘è®¾ç½®
- æ“ä½œè®¾ç½®

### å­˜æ¡£æ ¼å¼

**æ¨è**: JSON + MemoryPack äºŒè¿›åˆ¶

```csharp
[MemoryPackable]
public partial class SaveData
{
    public int Version { get; set; } = 1;
    public DateTime SaveTime { get; set; }
    
    // è¿›åº¦æ•°æ®
    public int CurrentLevel { get; set; }
    public List<int> CompletedLevels { get; set; }
    
    // è§’è‰²æ•°æ®
    public PlayerData PlayerData { get; set; }
    
    // é…ç½®
    public GameSettings Settings { get; set; }
}
```

### å­˜æ¡£ä½ç½®

```
Windows: %AppData%/Astrum/Saves/
Mac: ~/Library/Application Support/Astrum/Saves/
Linux: ~/.config/Astrum/Saves/
```

### è‡ªåŠ¨ä¿å­˜

- å…³å¡å®Œæˆæ—¶
- é‡è¦äº‹ä»¶åï¼ˆBosså‡»è´¥ã€å…³é”®é“å…·è·å¾—ï¼‰
- é€€å‡ºæ¸¸æˆæ—¶

---

## å…³å¡ç³»ç»Ÿ

> **çŠ¶æ€**: ğŸ“ è§„åˆ’ä¸­

### å…³å¡ç»“æ„

```
å…³å¡ (Level)
  â”œâ”€â”€ å…³å¡é…ç½® (LevelConfig)
  â”‚   â”œâ”€â”€ åœ°å›¾åœºæ™¯
  â”‚   â”œâ”€â”€ å‡ºç”Ÿç‚¹
  â”‚   â”œâ”€â”€ æ•Œäººæ³¢æ¬¡
  â”‚   â””â”€â”€ èƒœåˆ©æ¡ä»¶
  â”‚
  â”œâ”€â”€ æ•Œäººç”Ÿæˆå™¨ (EnemySpawner)
  â”‚   â”œâ”€â”€ æ³¢æ¬¡ç®¡ç†
  â”‚   â”œâ”€â”€ ç”Ÿæˆä½ç½®
  â”‚   â””â”€â”€ AIé…ç½®
  â”‚
  â””â”€â”€ å…³å¡äº‹ä»¶ (LevelEvents)
      â”œâ”€â”€ å¼€å§‹äº‹ä»¶
      â”œâ”€â”€ è¿›åº¦äº‹ä»¶
      â””â”€â”€ ç»“æŸäº‹ä»¶
```

### å…³å¡é…ç½®è¡¨

```csharp
// é…ç½®è¡¨å®šä¹‰
public class LevelConfig
{
    public int LevelId;
    public string LevelName;
    public string SceneName;
    public List<SpawnPoint> PlayerSpawnPoints;
    public List<EnemyWave> EnemyWaves;
    public VictoryCondition WinCondition;
    public int RewardExp;
    public List<int> RewardItems;
}
```

### å…³å¡æµç¨‹

```
[å¼€å§‹å…³å¡]
    â†“
åŠ è½½å…³å¡é…ç½®
    â†“
åˆå§‹åŒ–åœºæ™¯
    â†“
ç”Ÿæˆç©å®¶è§’è‰²
    â†“
[å…³å¡è¿›è¡Œä¸­]
    â”œâ”€â†’ ç”Ÿæˆæ•Œäººæ³¢æ¬¡
    â”œâ”€â†’ æ£€æµ‹èƒœåˆ©/å¤±è´¥æ¡ä»¶
    â””â”€â†’ æ›´æ–°UIæ˜¾ç¤º
    â†“
[å…³å¡ç»“æŸ]
    â†“
ç»“ç®—å¥–åŠ±
    â†“
ä¿å­˜è¿›åº¦
    â†“
è¿”å›ä¸»èœå•/ä¸‹ä¸€å…³å¡
```

---

## ä¸è”æœºæ¨¡å¼çš„åŒºåˆ«

### æ¶æ„å¯¹æ¯”

| ç»„ä»¶ | å•æœºæ¨¡å¼ | è”æœºæ¨¡å¼ |
|------|----------|----------|
| **Room** | æœ¬åœ°åˆ›å»º | æœåŠ¡å™¨åˆ›å»º |
| **å¸§åŒæ­¥** | æœ¬åœ°é©±åŠ¨ | æœåŠ¡å™¨æ¨é€ |
| **è¾“å…¥** | ç›´æ¥åº”ç”¨ | ä¸ŠæŠ¥æœåŠ¡å™¨ |
| **å¯¹æ‰‹** | AIæ§åˆ¶ | å…¶ä»–ç©å®¶ |
| **å»¶è¿Ÿ** | 0ms | ç½‘ç»œå»¶è¿Ÿ |
| **æš‚åœ** | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| **å­˜æ¡£** | æœ¬åœ°æ–‡ä»¶ | æœåŠ¡å™¨æ•°æ®åº“ |
| **è°ƒè¯•** | ç®€å• | å¤æ‚ |

### ä»£ç å¤ç”¨

**å…±äº«çš„é€»è¾‘å±‚ä»£ç ** (100%å¤ç”¨):
- âœ… Entity-Component-Capability æ¶æ„
- âœ… æˆ˜æ–—ç³»ç»Ÿ (æŠ€èƒ½ã€ä¼¤å®³ã€buff)
- âœ… ç‰©ç†ç³»ç»Ÿ (ç¢°æ’æ£€æµ‹)
- âœ… åŠ¨ä½œç³»ç»Ÿ (åŠ¨ä½œçŠ¶æ€æœº)
- âœ… å¸§åŒæ­¥é€»è¾‘ (FrameSyncManager)

**ä¸åŒçš„å®¢æˆ·ç«¯ä»£ç **:
- âŒ è¾“å…¥å¤„ç†æ–¹å¼
  - å•æœº: `InputManager` â†’ `Room`
  - è”æœº: `InputManager` â†’ `NetworkManager` â†’ `Server` â†’ `Room`
  
- âŒ å¸§é©±åŠ¨æ–¹å¼
  - å•æœº: `Unity Update()` é©±åŠ¨
  - è”æœº: æœåŠ¡å™¨å¸§æ¨é€é©±åŠ¨

- âŒ å¯¹æ‰‹æ¥æº
  - å•æœº: `AIController` ç”Ÿæˆè¾“å…¥
  - è”æœº: å…¶ä»–ç©å®¶çš„ç½‘ç»œè¾“å…¥

### åˆ‡æ¢é€»è¾‘

é€šè¿‡ `GameConfig.IsSinglePlayerMode` åŒºåˆ†ï¼š

```csharp
// åœ¨å¯åŠ¨æ¸¸æˆæ—¶
if (GameConfig.Instance.IsSinglePlayerMode)
{
    // å•æœºæ¨¡å¼
    GamePlayManager.Instance.StartSinglePlayerGame("GameScene");
}
else
{
    // è”æœºæ¨¡å¼
    NetworkManager.Instance.Connect(serverAddress);
    // ... åç»­ç™»å½•ã€åŒ¹é…ã€è¿›å…¥æˆ¿é—´æµç¨‹
}
```

---

## æŠ€æœ¯é™åˆ¶å’Œæ³¨æ„äº‹é¡¹

### å…³é”®å®ç°ç»†èŠ‚ï¼ˆv0.3.0ï¼‰

#### 1. LSController çš„å¯åŠ¨æ—¶æœº âš ï¸

**è”æœºæ¨¡å¼**:
```csharp
// æœåŠ¡å™¨é€šçŸ¥å¸§åŒæ­¥å¼€å§‹æ—¶å¯åŠ¨
OnFrameSyncStartNotification(notification)
{
    MainRoom.LSController.CreationTime = notification.startTime;  // æœåŠ¡å™¨æ—¶é—´
    MainRoom.LSController.Start();
}
```

**å•æœºæ¨¡å¼**:
```csharp
// åˆ›å»ºç©å®¶æ—¶ç«‹å³å¯åŠ¨
CreatePlayer()
{
    MainRoom.LSController.CreationTime = TimeInfo.Instance.ServerNow();  // æœ¬åœ°æ—¶é—´
    MainRoom.LSController.Start();
}
```

#### 2. æƒå¨å¸§çš„æ›´æ–°æœºåˆ¶ âš ï¸

**è”æœºæ¨¡å¼**:
```csharp
// æœåŠ¡å™¨é€šè¿‡ FrameSyncData ä¸‹å‘
OnFrameSyncData(frameData)
{
    MainRoom.LSController.AuthorityFrame = frameData.authorityFrame;
}
```

**å•æœºæ¨¡å¼**:
```csharp
// æ¯å¸§æ‰‹åŠ¨åŒæ­¥ï¼Œæ¨¡æ‹ŸæœåŠ¡å™¨æ¨è¿›
Update(deltaTime)
{
    MainRoom.LSController.AuthorityFrame = MainRoom.LSController.PredictionFrame;
}
```

**ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·åšï¼Ÿ**

`LSController.Tick()` ä¸­æœ‰é¢„æµ‹ä¸Šé™æ£€æŸ¥ï¼š
```csharp
if (PredictionFrame - AuthorityFrame > MaxPredictionFrames)
    return;  // åœæ­¢æ‰§è¡Œ
```

- è”æœºæ¨¡å¼ï¼šå…è®¸é¢„æµ‹ 5 å¸§ï¼ˆç½‘ç»œå»¶è¿Ÿè¡¥å¿ï¼‰
- å•æœºæ¨¡å¼ï¼šå·®è·åº”è¯¥æ˜¯ 0ï¼ˆæ— å»¶è¿Ÿï¼Œç«‹å³ç¡®è®¤ï¼‰

#### 3. è¾“å…¥å¤„ç†æµç¨‹

**å…±äº«éƒ¨åˆ†**ï¼ˆå•æœºå’Œè”æœºç›¸åŒï¼‰:
```csharp
InputManager.Update()
    â†“
CollectLSInput(playerId) â†’ æ”¶é›†é”®ç›˜è¾“å…¥
    â†“
LSController.SetPlayerInput(playerId, input)
    â†“
LSController.Tick()
    â†“
Room.FrameTick(inputs)
```

**å·®å¼‚éƒ¨åˆ†**:

**è”æœº**: `FrameDataUploadEventData` â†’ `MultiplayerGameMode` è®¢é˜… â†’ å‘é€åˆ°æœåŠ¡å™¨
**å•æœº**: `FrameDataUploadEventData` â†’ æ— äººè®¢é˜… â†’ è‡ªåŠ¨å¿½ç•¥ âœ…

è¿™æ˜¯**äº‹ä»¶é©±åŠ¨æ¶æ„çš„ä¼˜åŠ¿**ï¼šé€»è¾‘å±‚åªè´Ÿè´£å‘å¸ƒäº‹ä»¶ï¼Œå®¢æˆ·ç«¯å±‚å†³å®šæ˜¯å¦å¤„ç†ã€‚

---

### ç¡®å®šæ€§è¦æ±‚

å³ä½¿æ˜¯å•æœºæ¨¡å¼ï¼Œä¹Ÿå¿…é¡»ä¿æŒé€»è¾‘çš„**ç¡®å®šæ€§**ï¼ŒåŸå› ï¼š

1. **å›æ”¾ç³»ç»Ÿ** - æ”¯æŒå½•åƒå›æ”¾
2. **è°ƒè¯•** - å¯é‡ç°bug
3. **ä»£ç ä¸€è‡´æ€§** - ä¸è”æœºæ¨¡å¼å…±äº«ä»£ç 

**å…³é”®åŸåˆ™**:
- âœ… ä½¿ç”¨ TrueSync (FP) è€Œé float
- âœ… é¿å… Random.Range()ï¼Œä½¿ç”¨ç¡®å®šæ€§éšæœº
- âœ… é¿å… Time.deltaTimeï¼Œä½¿ç”¨å›ºå®šæ—¶é—´æ­¥

### æ€§èƒ½ä¼˜åŒ–

å•æœºæ¨¡å¼æ— ç½‘ç»œå»¶è¿Ÿï¼Œä½†ä»éœ€æ³¨æ„ï¼š

- ä¿æŒ 60 FPS
- Entity æ•°é‡æ§åˆ¶ï¼ˆå»ºè®® < 100ï¼‰
- ç‰©ç†æŸ¥è¯¢ä¼˜åŒ–
- GC å‹åŠ›æ§åˆ¶

### è°ƒè¯•å»ºè®®

1. **Gizmoså¯è§†åŒ–** - å·²å®ç°ç¢°æ’ç›’å¯è§†åŒ–
2. **æ—¥å¿—åˆ†çº§** - ä½¿ç”¨ ASLogger çš„ä¸åŒçº§åˆ«
3. **å¸§å›æ”¾** - è®°å½•è¾“å…¥åºåˆ—ï¼Œæ”¯æŒé‡æ”¾
4. **æ€§èƒ½åˆ†æ** - Unity Profiler

---

## æ¶æ„æ”¹è¿›ï¼ˆv0.3.0ï¼‰

### GameMode æ¨¡å¼åˆ†ç¦»æ¶æ„

**æ ¸å¿ƒæ”¹è¿›**:
- âœ… å•æœºå’Œè”æœºé€»è¾‘å®Œå…¨è§£è€¦
- âœ… GamePlayManager èŒè´£æ¸…æ™°ï¼ˆåªåšå§”æ‰˜ï¼‰
- âœ… å»¶è¿Ÿåˆ›å»º GameModeï¼ˆæŒ‰éœ€åŠ è½½ï¼‰
- âœ… æ”¯æŒæ¨¡å¼åŠ¨æ€åˆ‡æ¢

**æ–°æ–‡ä»¶ç»“æ„**:
```
AstrumClient/Managers/
â”œâ”€â”€ GamePlayManager.cs          (460 è¡Œï¼Œè½»é‡çº§å…¥å£)
â””â”€â”€ GameModes/
    â”œâ”€â”€ IGameMode.cs            (æ¸¸æˆæ¨¡å¼æ¥å£)
    â”œâ”€â”€ SinglePlayerGameMode.cs (å•æœºæ¨¡å¼å®ç°)
    â””â”€â”€ MultiplayerGameMode.cs  (è”æœºæ¨¡å¼å®ç°)
```

**è¯¦ç»†è®¾è®¡**: æŸ¥çœ‹ [GamePlayManager é‡æ„æ–¹æ¡ˆ](../../07-Development%20å¼€å‘æŒ‡å—/GamePlayManager-Refactoring%20é‡æ„æ–¹æ¡ˆ.md)

---

## ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

### Phase 1: åŸºç¡€æ¶æ„ âœ…
- âœ… GameConfig å•æœºæ¨¡å¼æ ‡è®°
- âœ… SinglePlayerGameMode å®Œæ•´å®ç°
- âœ… Room/World æœ¬åœ°åˆ›å»º
- âœ… Stage è¡¨ç°å±‚åŒæ­¥
- âœ… LSController æœ¬åœ°é©±åŠ¨
- âœ… æƒå¨å¸§æ¨¡æ‹Ÿ

### Phase 2: æ ¸å¿ƒç©æ³• âœ…
- âœ… ç©å®¶è§’è‰²åˆ›å»º
- âœ… ç§»åŠ¨å’Œæ“ä½œ
- âœ… æˆ˜æ–—ç³»ç»Ÿ
- âœ… æŠ€èƒ½æ•ˆæœ
- âœ… å¸§å¾ªç¯é©±åŠ¨
- âœ… å®Œæ•´æµ‹è¯•é€šè¿‡

### Phase 3-5: æš‚ä¸å¼€å‘ ğŸ“
- ğŸ“ AIç³»ç»Ÿ - æš‚ä¸å¼€å‘
- ğŸ“ å…³å¡ç³»ç»Ÿ - æš‚ä¸å¼€å‘
- ğŸ“ å­˜æ¡£ç³»ç»Ÿ - æš‚ä¸å¼€å‘

**å½“å‰çŠ¶æ€**: å•æœºæ¨¡å¼æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼Œå¯è¿›è¡Œå®Œæ•´çš„æ¸¸æˆæµ‹è¯•å’Œç©æ³•éªŒè¯ã€‚

---

## ç›¸å…³æ–‡æ¡£

- [å•æœºæ¨¡å¼å¼€å‘è¿›å±•](_status%20å¼€å‘è¿›å±•/Single-Player-Progress%20å•æœºæ¨¡å¼å¼€å‘è¿›å±•.md) - è¯¦ç»†å¼€å‘è®°å½•
- [è”æœºæ¨¡å¼](Network-Multiplayer%20è”æœºæ¨¡å¼.md) - å¯¹æ¯”å‚è€ƒ
- [æˆ˜æ–—ç³»ç»Ÿ](../02-CombatSystem%20æˆ˜æ–—ç³»ç»Ÿ/) - å…±äº«çš„æˆ˜æ–—é€»è¾‘
- [ECCæ¶æ„](../05-CoreArchitecture%20æ ¸å¿ƒæ¶æ„/ECC-System%20ECCç»“æ„è¯´æ˜.md) - é€»è¾‘å±‚æ¶æ„
- [å¸§åŒæ­¥]() - å¸§åŒæ­¥æœºåˆ¶ï¼ˆå¾…è¡¥å……ï¼‰

---

**æœ€åæ›´æ–°**: 2025-10-11  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ  
**ç‰ˆæœ¬**: v0.3.0

---

## æ›´æ–°æ—¥å¿—

### v0.3.0 (2025-10-11)
- âœ… æ¶æ„é‡æ„ï¼šGameMode æ¨¡å¼åˆ†ç¦»
- âœ… ä¿®å¤ LSController å¯åŠ¨é—®é¢˜
- âœ… ä¿®å¤æƒå¨å¸§é©±åŠ¨é—®é¢˜
- âœ… å®Œæ•´æµ‹è¯•é€šè¿‡

### v0.2.0 (2025-10-10)
- âœ… æˆ˜æ–—ç³»ç»Ÿå®Œæ•´é›†æˆ
- âœ… ç‰©ç†ç³»ç»Ÿå®Œå–„

### v0.1.0
- âœ… åŸºç¡€æ¶æ„æ­å»º




# 道具系统策划案

> 📦 **道具与装备设计** - Astrum 核心数值支点  
> **版本**: v1.0  
> **创建日期**: 2025-01-22

---

## 📋 目录

- [一、系统总览](#一系统总览)
- [二、道具分类](#二道具分类)
- [三、表格设计](#三表格设计)
- [四、数据规范](#四数据规范)
- [五、关联关系](#五关联关系)
- [六、数值平衡](#六数值平衡)

---

## 一、系统总览

### 1.1 核心定位

道具系统是 Astrum **"搜打撤 + 塔防 + 工厂"** 循环的数值支点，提供：
- **装备成长** - 强化角色战斗能力
- **资源管理** - 星能、材料的生产与消耗
- **探索收益** - 掉落的装备与材料
- **策略深度** - 制作、强化、附魔等玩法

### 1.2 系统边界

```
道具系统
├── 装备系统
│   ├── 武器（单手剑、法杖、弓等）
│   ├── 防具（轻甲、重甲、布甲）
│   └── 星能器（特殊装备）
├── 消耗品系统
│   ├── 药水（生命、法力、Buff）
│   └── 食物（持续恢复）
├── 材料资源
│   ├── 星能结晶（核心资源）
│   ├── 魔力符文（附魔材料）
│   └── 遗迹材料（高级建造）
└── 制作系统
    ├── 装备制作
    ├── 材料精炼
    └── 设施建造
```

---

## 二、道具分类

### 2.1 道具类型枚举

| 类型 | ID范围 | 说明 | 示例 |
|------|--------|------|------|
| 武器 | 1000-1999 | 单手剑、双手剑、法杖、弓箭等 | 1001-星辉长刃 |
| 防具 | 2000-2999 | 轻甲、重甲、布甲、鞋子等 | 2001-星能轻甲 |
| 星能器 | 3000-3999 | 特殊装备，提供星能增益 | 3001-星核护符 |
| 药水 | 4000-4999 | 生命药水、法力药水、Buff药水 | 4001-生命药水 |
| 食物 | 5000-5999 | 持续恢复效果 | 5001-面包 |
| 星能材料 | 6000-6999 | 星能结晶、星能粉末等 | 6001-星能结晶 |
| 魔力材料 | 7000-7999 | 魔力符文、符文碎片等 | 7001-魔力符文 |
| 遗迹材料 | 8000-8999 | 高级建造材料 | 8001-遗物碎片 |
| 组件模块 | 9000-9999 | 防御塔组件、工厂模块 | 9001-箭塔核心 |

### 2.2 稀有度枚举

| 稀有度 | ID | 系数 | 颜色 | 说明 |
|--------|-----|------|------|------|
| 普通 | 1 | 1.0 | 白色 | 基础装备，无特殊效果 |
| 精良 | 2 | 1.5 | 绿色 | 属性提升，有1个词条 |
| 史诗 | 3 | 2.0 | 蓝色 | 大幅属性提升，有2个词条 |
| 星界 | 4 | 3.0 | 紫色 | 顶级装备，有3个词条 |

---

## 三、表格设计

### 3.1 ItemBaseTable（道具基础表）

**作用**: 所有道具的总表，定义类型、稀有度、图标、说明等通用属性。

**字段设计**:

```csv
##var,itemId,name,itemType,rarity,astralType,desc,weight,stackable,sellPrice,iconId,modelPath
##type,int,string,int,int,int,string,int,bool,int,int,string
##desc,道具ID,道具名称,道具类型,稀有度,星能反应类型,描述,重量*1000,可堆叠,售价,图标ID,模型路径
```

| 字段名 | 类型 | 说明 | 示例 |
|-------|------|------|------|
| itemId | int | 道具唯一标识 | 1001 |
| name | string | 显示名称 | 星辉长刃 |
| itemType | int | 道具类型（见2.1） | 1001（武器） |
| rarity | int | 稀有度（1-4） | 2（精良） |
| astralType | int | 星能反应类型（1=光,2=暗,3=虚,4=实） | 1（光） |
| desc | string | 文本说明 | 由星能结晶锻造的长刃，可导引能量波动 |
| weight | int | 重量*1000 | 3200（3.2kg） |
| stackable | bool | 是否可堆叠 | FALSE |
| sellPrice | int | 商店或交易所基准价 | 120 |
| iconId | int | 图标ID（关联资源系统） | 401 |
| modelPath | string | 模型资源路径 | Assets/ArtRes/Items/Sword01 |

### 3.2 EquipmentStatsTable（装备属性表）

**作用**: 定义武器、防具、星能器的属性数值。

**字段设计**:

```csv
##var,itemId,equipType,attackPower,defensePower,astralGuideRatio,critRate,critDamage,additionalStats,maxDurability
##type,int,int,int,int,int,int,int,string,int
##desc,道具ID,装备类型,攻击力,防御力,星能引导倍率*1000,暴击率*1000,暴击伤害*1000,附加属性JSON,最大耐久度
```

| 字段名 | 类型 | 说明 | 示例 |
|-------|------|------|------|
| itemId | int | 对应ItemBaseTable.itemId | 1001 |
| equipType | int | 装备类型（1=武器,2=防具,3=星能器） | 1 |
| attackPower | int | 基础攻击力（整数） | 35 |
| defensePower | int | 基础防御力（整数） | 8 |
| astralGuideRatio | int | 星能引导倍率*1000 | 1200（1.2倍） |
| critRate | int | 暴击率*1000 | 50（5%） |
| critDamage | int | 暴击伤害*1000 | 2000（200%） |
| additionalStats | string | 附加属性JSON | 见下文 |
| maxDurability | int | 最大耐久度 | 100 |

**附加属性JSON格式**:

```json
{
  "ATK_PERCENT": 500,    // 攻击力+50%
  "SPD_FLAT": 2000,      // 速度+2.0
  "HP_REGEN": 5000,      // 生命回复+5.0/秒
  "MANA_MAX": 50         // 法力上限+50
}
```

### 3.3 CraftingRecipeTable（制作配方表）⚠️ 暂不实现

**作用**: 定义每个装备或道具的合成方式。

**字段设计**:

```csv
##var,recipeId,targetItemId,materialCost,craftTime,factoryType,skillLevelRequired,unlockCondition
##type,int,int,string,float,int,int,int
##desc,配方ID,产物道具ID,所需材料JSON,制作时间（秒）,工厂类型,熟练度要求,解锁条件ID
```

| 字段名 | 类型 | 说明 | 示例 |
|-------|------|------|------|
| recipeId | int | 配方唯一标识 | 10001 |
| targetItemId | int | 产物ItemID | 1001 |
| materialCost | string | 所需材料JSON | 见下文 |
| craftTime | float | 制作时间（秒） | 12.0 |
| factoryType | int | 工厂类型（1=锻造台,2=星能工坊,3=防御塔芯炉） | 1 |
| skillLevelRequired | int | 熟练度要求 | 20 |
| unlockCondition | int | 解锁条件ID（0=已解锁） | 0 |

**所需材料JSON格式**:

```json
{
  "6001": 3,    // 星能结晶×3
  "7002": 2,    // 精钢锭×2
  "6005": 1     // 星辉粉末×1
}
```

### 3.4 UpgradeTable（装备强化表）⚠️ 暂不实现

**作用**: 定义装备升级或强化后的数值成长。

**字段设计**:

```csv
##var,upgradeId,itemId,level,materialCost,attackGrowth,defenseGrowth,astralGrowth,critRateGrowth,successRate
##type,int,int,int,string,int,int,int,int,int
##desc,强化ID,装备ID,强化等级,升级所需材料JSON,攻击力成长,防御力成长,星能倍率成长*1000,暴击率成长*1000,成功率*1000
```

| 字段名 | 类型 | 说明 | 示例 |
|-------|------|------|------|
| upgradeId | int | 强化配置唯一标识 | 1 |
| itemId | int | 装备ID | 1001 |
| level | int | 强化等级（1-5） | 1 |
| materialCost | string | 升级所需材料JSON | {"6001":2,"6002":1} |
| attackGrowth | int | 攻击力成长 | 10 |
| defenseGrowth | int | 防御力成长 | 5 |
| astralGrowth | int | 星能倍率成长*1000 | 100 |
| critRateGrowth | int | 暴击率成长*1000 | 50 |
| successRate | int | 成功率*1000 | 850（85%） |

### 3.5 LootTable（战利品掉落表）

**作用**: 定义探索、敌人、事件中的掉落概率。

**字段设计**:

```csv
##var,lootId,sourceType,sourceId,itemId,dropRate,amountMin,amountMax,weightGroup
##type,int,int,int,int,int,int,int,string
##desc,掉落ID,来源类型,来源ID,物品ID,掉落几率*1000,最小数量,最大数量,权重组
```

| 字段名 | 类型 | 说明 | 示例 |
|-------|------|------|------|
| lootId | int | 掉落配置唯一标识 | 10001 |
| sourceType | int | 来源类型（1=敌人,2=宝箱,3=星能风暴,4=工厂产出） | 1 |
| sourceId | int | 来源ID（对应敌人/BOSS/宝箱ID） | 5001 |
| itemId | int | 掉落目标道具ID | 1001 |
| dropRate | int | 掉落几率*1000 | 120（12%） |
| amountMin | int | 最小数量 | 1 |
| amountMax | int | 最大数量 | 2 |
| weightGroup | string | 权重组（同组随机选择） | mid_tier_loot |

### 3.6 MaterialResourceTable（资源定义表）

**作用**: 定义工厂、采集、星能提炼等相关资源。

**字段设计**:

```csv
##var,materialId,name,gatheringSource,refinedProduct,rarity,weightPerUnit,usageDesc
##type,int,string,string,int,int,int,string
##desc,材料ID,材料名称,采集来源,精炼产物ID,稀有度,单位重量*1000,用途说明
```

| 字段名 | 类型 | 说明 | 示例 |
|-------|------|------|------|
| materialId | int | 材料唯一标识 | 6001 |
| name | string | 材料名称 | 星能矿石 |
| gatheringSource | string | 采集来源描述 | 星陨地带 / 星能风暴后 |
| refinedProduct | int | 精炼产物ID（0=无） | 6002（星能结晶） |
| rarity | int | 稀有度 | 1（普通） |
| weightPerUnit | int | 单位重量*1000 | 500（0.5kg） |
| usageDesc | string | 用途说明 | 用于强化与附魔 |

---

## 四、数据规范

### 4.1 数值存储规则

**配置表全部使用 `int` 类型，避免float不确定性**（遵循现有数值系统设计）

| 属性类型 | 配置示例 | 运行时值 | 转换规则 |
|---------|---------|---------|---------|
| 攻击/防御 | `80` | `FP(80)` | 直接转换 |
| 重量 | `3200` | `FP(3.2)` | 除以1000 |
| 星能倍率 | `1200` | `FP(1.2)` | 除以1000 |
| 暴击率 | `50` | `FP(0.05)` | 除以1000（5%） |
| 成功率 | `850` | `FP(0.85)` | 除以1000（85%） |

### 4.2 Luban格式规范

**文件命名**: 使用 `#` 前缀，如 `#ItemBaseTable.csv`  
**头部格式**: 必须包含 `##var`, `##type`, `##group`, `##desc` 四行  
**逗号对齐**: 所有行的逗号数量必须完全一致  
**编码格式**: 使用 UTF-8 with BOM

**基本数据类型**:
- `int` - 整数（数值属性、ID、数量）
- `float` - 浮点数（制作时间等）
- `string` - 字符串（名称、描述、路径、JSON）
- `bool` - 布尔值（TRUE/FALSE）

---

## 五、关联关系

### 5.1 表格关联图

```
ItemBaseTable (道具基础)
    ↓ itemId
EquipmentStatsTable (装备属性)

LootTable (战利品掉落)
    ↓ itemId
    └─> ItemBaseTable

MaterialResourceTable (资源定义)
    ↓ materialId
    └─> ItemBaseTable

⚠️ 暂不实现:
UpgradeTable (装备强化) - 规划中
CraftingRecipeTable (制作配方) - 规划中
```

### 5.2 ID分配规范

| 系统 | ID范围 | 预留空间 | 说明 |
|------|--------|---------|------|
| 道具ID | 1000-9999 | 9000个 | 按类型分配 |
| 配方ID | 10000-19999 | 10000个 | 制作配方 |
| 强化ID | 20000-29999 | 10000个 | 装备强化 |
| 掉落ID | 30000-39999 | 10000个 | 战利品配置 |
| 图标ID | 400-999 | 600个 | 道具图标 |
| 模型ID | 自动生成 | - | 从路径解析 |

---

## 六、数值平衡

### 6.1 装备价值曲线

**装备评分公式**:
```
装备评分 = (基础属性 × 稀有度系数) × (1 + 星能倍率 × 0.1)

稀有度系数：
- 普通(1.0) × 属性
- 精良(1.5) × 属性 + 1个词条
- 史诗(2.0) × 属性 + 2个词条
- 星界(3.0) × 属性 + 3个词条
```

### 6.2 属性成长建议

**武器（单手剑为例）**:
```
普通级（1001）:
- 攻击: 35
- 暴击率: 5%
- 星能倍率: 1.0

精良级（1002）:
- 攻击: 52 (35×1.5)
- 暴击率: 8%
- 星能倍率: 1.2
- 词条: 攻击力+10%

史诗级（1003）:
- 攻击: 70 (35×2.0)
- 暴击率: 12%
- 星能倍率: 1.5
- 词条: 攻击力+15%, 暴击率+10%

星界级（1004）:
- 攻击: 105 (35×3.0)
- 暴击率: 20%
- 星能倍率: 2.0
- 词条: 攻击力+20%, 暴击率+15%, 星能倍率+0.5
```

### 6.3 掉落概率建议

| 稀有度 | 普通敌人 | 精英敌人 | BOSS | 宝箱 |
|--------|---------|---------|------|------|
| 普通 | 80% | 50% | 20% | 100% |
| 精良 | 15% | 40% | 50% | 60% |
| 史诗 | 5% | 10% | 25% | 30% |
| 星界 | 0% | 0% | 5% | 10% |

---

## 七、实施清单

### Phase 1：基础表结构
- [x] 创建策划案文档
- [ ] 创建 ItemBaseTable CSV
- [ ] 创建 EquipmentStatsTable CSV
- [ ] 创建 LootTable CSV
- [ ] 创建 MaterialResourceTable CSV
- [ ] ~~创建 CraftingRecipeTable CSV~~ ⚠️ 暂不实现
- [ ] ~~创建 UpgradeTable CSV~~ ⚠️ 暂不实现

### Phase 2：初始数据
- [ ] 填充20个基础道具数据
- [ ] 填充10件装备属性数据
- [ ] 填充30个掉落配置
- [ ] 填充20个资源材料
- [ ] ~~填充15个制作配方~~ ⚠️ 暂不实现

### Phase 3：测试验证
- [ ] Luban生成配置
- [ ] 运行时读取测试
- [ ] 关联关系验证
- [ ] 数值平衡调整

---

## 八、示例数据

### 示例1：星辉长刃（精良武器）

**ItemBaseTable**:
```csv
,1001,星辉长刃,1000,2,1,由星能结晶锻造的长刃，可导引能量波动,3200,FALSE,120,401,Assets/ArtRes/Items/Sword01
```

**EquipmentStatsTable**:
```csv
,1001,1,52,8,1200,80,2200,{"ATK_PERCENT":1000},100
```

**LootTable**:
```csv
,30001,1,5001,1001,120,1,1,mid_tier_loot
```

---

**创建日期**: 2025-01-22  
**作者**: Astrum开发团队  
**状态**: 📝 策划完成，待实施

# å¸§åˆ»åº¦å¡«æ»¡ä¸åŒæ­¥ä¿®å¤

> ğŸ“… **æ—¥æœŸ**: 2025-10-11  
> ğŸ¯ **ç›®æ ‡**: ä¿®å¤å¸§åˆ»åº¦ä¸å¡«æ»¡ã€ä¸éšçª—å£å˜åŒ–çš„é—®é¢˜  
> âœ… **çŠ¶æ€**: å®Œæˆ

---

## ğŸ› **é—®é¢˜ç°è±¡**

**è½¨é“åŒºåŸŸå¡«æ»¡** âœ…ï¼š
- âœ… è½¨é“èƒŒæ™¯å·²ç»æ­£ç¡®å¡«æ»¡
- âœ… Durationè™šçº¿æ˜¾ç¤ºæ­£å¸¸

**å¸§åˆ»åº¦é—®é¢˜** âŒï¼š
- âŒ å¸§åˆ»åº¦åªæ˜¾ç¤ºåˆ°30å¸§å·¦å³å°±ç»“æŸï¼Œå³è¾¹æœ‰å¤§é‡ç©ºç™½
- âŒ å¸§åˆ»åº¦ä¸éšçª—å£å·¦å³æ‹‰ä¼¸å˜åŒ–
- âŒ å¸§åˆ»åº¦å’Œè½¨é“åŒºåŸŸä¸åŒæ­¥æ»šåŠ¨

---

## ğŸ” **é—®é¢˜åˆ†æ**

### **æ ¹æœ¬åŸå› **

**1. å¸§åˆ»åº¦æ²¡æœ‰ä½¿ç”¨ScrollView**ï¼š
- è½¨é“åŒºåŸŸä½¿ç”¨äº† `ScrollView`ï¼Œå†…å®¹å¯ä»¥å¡«æ»¡å¹¶æ»šåŠ¨
- å¸§åˆ»åº¦ç›´æ¥åœ¨å›ºå®š `Rect` å†…ç»˜åˆ¶ï¼Œå†…å®¹å®½åº¦å›ºå®š
- å¯¼è‡´å¸§åˆ»åº¦æ— æ³•å¡«æ»¡ï¼Œä¹Ÿæ— æ³•æ»šåŠ¨

**2. å¸§åˆ»åº¦å’Œè½¨é“ä¸åŒæ­¥**ï¼š
- è½¨é“åŒºåŸŸæœ‰è‡ªå·±çš„æ»šåŠ¨ä½ç½® `_scrollPosition`
- å¸§åˆ»åº¦æ²¡æœ‰ä½¿ç”¨ `_scrollPosition`
- å¯¼è‡´æ»šåŠ¨æ—¶å¸§åˆ»åº¦å’Œè½¨é“é”™ä½

**3. åæ ‡ç³»ä¸ä¸€è‡´**ï¼š
- åœ¨ScrollViewå†…éƒ¨ï¼Œåæ ‡ç³»ä» (0, 0) å¼€å§‹
- å¸§åˆ»åº¦çš„ç»˜åˆ¶ä»£ç ä½¿ç”¨äº† `rect.x + trackHeaderWidth`
- åº”è¯¥ä½¿ç”¨ `trackHeaderWidth`ï¼ˆScrollViewå†…éƒ¨åæ ‡ï¼‰

---

## ğŸ”§ **è§£å†³æ–¹æ¡ˆ**

### **æ ¸å¿ƒä¿®å¤**

**1. ä¸ºå¸§åˆ»åº¦æ·»åŠ ScrollView**ï¼š

```csharp
// === ä¿®å¤å‰ âŒ ===
public void DrawFrameScale(Rect rect, int totalFrames, int currentFrame)
{
    EditorGUI.DrawRect(rect, COLOR_FRAME_SCALE_BG);
    DrawFrameLines(rect, totalFrames);
    DrawFrameNumbers(rect, totalFrames);
    DrawBorder(rect, COLOR_TIMELINE_BORDER);
}

// === ä¿®å¤å âœ… ===
public void DrawFrameScale(Rect rect, int totalFrames, int currentFrame)
{
    EditorGUI.DrawRect(rect, COLOR_FRAME_SCALE_BG);
    
    // è®¡ç®—å†…å®¹å®½åº¦ï¼Œä¸è½¨é“åŒºåŸŸä¿æŒä¸€è‡´
    float contentWidth = Mathf.Max(
        _layoutCalculator.GetContentWidth() + _layoutCalculator.GetTrackHeaderWidth(),
        rect.width
    );
    
    // åˆ›å»ºScrollViewï¼ˆä¸è½¨é“åŒºåŸŸå…±äº«æ»šåŠ¨ä½ç½®ï¼‰
    Rect viewRect = new Rect(0, 0, contentWidth, rect.height);
    _scrollPosition = GUI.BeginScrollView(rect, _scrollPosition, viewRect, GUIStyle.none, GUIStyle.none);
    
    // ç»˜åˆ¶å·¦ä¾§è½¨é“æ ‡é¢˜èƒŒæ™¯åŒºåŸŸï¼ˆä¸è½¨é“åŒºåŸŸå¯¹é½ï¼‰
    float trackHeaderWidth = _layoutCalculator.GetTrackHeaderWidth();
    Rect headerBgRect = new Rect(0, 0, trackHeaderWidth, viewRect.height);
    EditorGUI.DrawRect(headerBgRect, COLOR_TRACK_HEADER);
    DrawVerticalLine(new Vector2(trackHeaderWidth, 0), viewRect.height, COLOR_TRACK_SEPARATOR);
    
    // ç»˜åˆ¶åˆ»åº¦çº¿å’Œæ•°å­—
    DrawFrameLines(viewRect, totalFrames);
    DrawFrameNumbers(viewRect, totalFrames);
    
    GUI.EndScrollView();
    DrawBorder(rect, COLOR_TIMELINE_BORDER);
}
```

**å…³é”®ç‚¹**ï¼š
- âœ… ä½¿ç”¨ç›¸åŒçš„ `contentWidth` è®¡ç®—æ–¹å¼ï¼ˆä¸è½¨é“åŒºåŸŸä¸€è‡´ï¼‰
- âœ… å…±äº« `_scrollPosition`ï¼ˆå¸§åˆ»åº¦å’Œè½¨é“åŒæ­¥æ»šåŠ¨ï¼‰
- âœ… ä½¿ç”¨ `GUIStyle.none` éšè—ScrollViewçš„æ»šåŠ¨æ¡ï¼ˆåªåœ¨è½¨é“åŒºåŸŸæ˜¾ç¤ºï¼‰
- âœ… ç»˜åˆ¶å·¦ä¾§æ ‡é¢˜èƒŒæ™¯åŒºåŸŸï¼ˆè§†è§‰å¯¹é½ï¼‰

---

**2. ä¿®å¤åæ ‡ç³»**ï¼š

```csharp
// === ä¿®å¤å‰ âŒ ===
private void DrawFrameLines(Rect rect, int totalFrames)
{
    float startX = rect.x + trackHeaderWidth; // å¤–éƒ¨åæ ‡ç³»
    
    for (int frame = 0; frame <= totalFrames; frame++)
    {
        float x = startX + _layoutCalculator.FrameToPixel(frame);
        if (x < rect.x || x > rect.xMax) continue; // è¾¹ç•Œæ£€æŸ¥
        
        // ç»˜åˆ¶åˆ»åº¦çº¿ï¼ˆä½¿ç”¨ rect.yï¼‰
        DrawVerticalLine(new Vector2(x, rect.y + rect.height), ...);
    }
}

// === ä¿®å¤å âœ… ===
private void DrawFrameLines(Rect rect, int totalFrames)
{
    float startX = trackHeaderWidth; // ScrollViewå†…éƒ¨åæ ‡ç³»ï¼ˆä»0å¼€å§‹ï¼‰
    
    for (int frame = 0; frame <= totalFrames; frame++)
    {
        float x = startX + _layoutCalculator.FrameToPixel(frame);
        // ScrollViewä¼šè‡ªåŠ¨è£å‰ªï¼Œæ— éœ€è¾¹ç•Œæ£€æŸ¥
        
        // ç»˜åˆ¶åˆ»åº¦çº¿ï¼ˆä½¿ç”¨ç›¸å¯¹åæ ‡ï¼‰
        DrawVerticalLine(new Vector2(x, rect.height), ...);
    }
}
```

**åŒæ ·ä¿®å¤ `DrawFrameNumbers`**ï¼š

```csharp
// === ä¿®å¤å‰ âŒ ===
float startX = rect.x + trackHeaderWidth;
Rect labelRect = new Rect(x - 20, rect.y + 2, 40, 12);

// === ä¿®å¤å âœ… ===
float startX = trackHeaderWidth;
Rect labelRect = new Rect(x - 20, 2, 40, 12);
```

---

## ğŸ“Š **æ•ˆæœå¯¹æ¯”**

### **ä¿®å¤å‰**

```
å¸§åˆ»åº¦åŒºåŸŸï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [0] [5] [10] [15] [20] [25] [30]       â”‚  â† åˆ»åº¦åœ¨30å¸§å°±ç»“æŸ
â”‚                                   [ç©ºç™½]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è½¨é“åŒºåŸŸï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚  â† è½¨é“å¡«æ»¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼š
âŒ å¸§åˆ»åº¦ä¸å¡«æ»¡
âŒ å¸§åˆ»åº¦å’Œè½¨é“å®½åº¦ä¸ä¸€è‡´
âŒ æ¨ªå‘æ»šåŠ¨æ—¶ï¼Œå¸§åˆ»åº¦ä¸åŠ¨ï¼Œè½¨é“æ»šåŠ¨ï¼ˆé”™ä½ï¼‰
```

### **ä¿®å¤å**

```
å¸§åˆ»åº¦åŒºåŸŸï¼ˆScrollViewï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [0] [5] [10] [15] [20] [25] [30]                     â”‚  â† åˆ»åº¦å¡«æ»¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†• å…±äº« _scrollPosition
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ             â”‚  â† è½¨é“å¡«æ»¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•ˆæœï¼š
âœ… å¸§åˆ»åº¦å¡«æ»¡æ•´ä¸ªå¯ç”¨å®½åº¦
âœ… å¸§åˆ»åº¦å’Œè½¨é“å®½åº¦å®Œå…¨ä¸€è‡´
âœ… æ¨ªå‘æ»šåŠ¨æ—¶ï¼Œå¸§åˆ»åº¦å’Œè½¨é“åŒæ­¥æ»šåŠ¨
âœ… çª—å£æ‹‰ä¼¸æ—¶ï¼Œå¸§åˆ»åº¦è‡ªåŠ¨è°ƒæ•´
```

---

## ğŸ¯ **å®ç°ç»†èŠ‚**

### **1. ScrollViewå…±äº«æœºåˆ¶**

**å…³é”®ä»£ç **ï¼š
```csharp
// å¸§åˆ»åº¦çš„ScrollView
_scrollPosition = GUI.BeginScrollView(rect, _scrollPosition, viewRect, GUIStyle.none, GUIStyle.none);
//                                      â†‘                                    â†‘           â†‘
//                              å…±äº«æ»šåŠ¨ä½ç½®                          éšè—æ°´å¹³æ»šåŠ¨æ¡  éšè—å‚ç›´æ»šåŠ¨æ¡

// è½¨é“åŒºåŸŸçš„ScrollView
_scrollPosition = GUI.BeginScrollView(rect, _scrollPosition, viewRect);
//                                      â†‘
//                               åŒä¸€ä¸ª _scrollPosition å˜é‡
```

**å·¥ä½œåŸç†**ï¼š
1. å¸§åˆ»åº¦å…ˆç»˜åˆ¶ï¼ˆæ›´æ–° `_scrollPosition`ï¼‰
2. è½¨é“åŒºåŸŸåç»˜åˆ¶ï¼ˆä½¿ç”¨æ›´æ–°åçš„ `_scrollPosition`ï¼‰
3. å¦‚æœè½¨é“åŒºåŸŸæ»šåŠ¨ï¼Œä¼šæ›´æ–° `_scrollPosition`
4. ä¸‹ä¸€å¸§ç»˜åˆ¶æ—¶ï¼Œå¸§åˆ»åº¦ä½¿ç”¨æ–°çš„ `_scrollPosition`
5. ç»“æœï¼šä¸¤è€…å§‹ç»ˆä¿æŒåŒæ­¥

### **2. å†…å®¹å®½åº¦è®¡ç®—**

**ç»Ÿä¸€ä½¿ç”¨**ï¼š
```csharp
float contentWidth = Mathf.Max(
    _layoutCalculator.GetContentWidth() + _layoutCalculator.GetTrackHeaderWidth(),
    rect.width
);
```

**ç¡®ä¿**ï¼š
- âœ… å¸§åˆ»åº¦å’Œè½¨é“ä½¿ç”¨ç›¸åŒçš„å†…å®¹å®½åº¦
- âœ… å†…å®¹å®½åº¦è‡³å°‘å¡«æ»¡å¯ç”¨å®½åº¦
- âœ… å¯¹äºé•¿åŠ¨ç”»ï¼Œå†…å®¹å®½åº¦å¯ä»¥è¶…å‡ºï¼ˆå…è®¸æ»šåŠ¨ï¼‰

### **3. åæ ‡ç³»è½¬æ¢**

**ScrollViewåæ ‡ç³»è§„åˆ™**ï¼š
```
å¤–éƒ¨åæ ‡ç³»ï¼ˆEditorWindowï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (rect.x, rect.y)                   â”‚
â”‚                                    â”‚
â”‚   ScrollViewåŒºåŸŸ                   â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ScrollViewå†…éƒ¨åæ ‡ç³»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (0, 0)  â† å§‹ç»ˆä»åŸç‚¹å¼€å§‹           â”‚
â”‚                                    â”‚
â”‚   å†…å®¹åŒºåŸŸ (viewRect)              â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åæ ‡è½¬æ¢**ï¼š
- âŒ å¤–éƒ¨ï¼š`rect.x + trackHeaderWidth`
- âœ… å†…éƒ¨ï¼š`trackHeaderWidth`

---

## ğŸ“ **ä¿®æ”¹æ–‡ä»¶æ¸…å•**

1. âœ… `Timeline/TimelineRenderer.cs`
   - ä¸º `DrawFrameScale` æ·»åŠ ScrollView
   - ä¿®å¤ `DrawFrameLines` çš„åæ ‡ç³»
   - ä¿®å¤ `DrawFrameNumbers` çš„åæ ‡ç³»
   - æ·»åŠ å·¦ä¾§æ ‡é¢˜èƒŒæ™¯åŒºåŸŸç»˜åˆ¶

---

## âœ… **ç¼–è¯‘ç»“æœ**

```bash
âœ… ç¼–è¯‘æˆåŠŸ - 0 errors
âœ… å¸§åˆ»åº¦ä½¿ç”¨ScrollView
âœ… å¸§åˆ»åº¦å’Œè½¨é“åŒæ­¥æ»šåŠ¨
âœ… åæ ‡ç³»ä¿®å¤
```

---

## ğŸ® **éªŒè¯æ­¥éª¤**

1. æ‰“å¼€UnityæŠ€èƒ½åŠ¨ä½œç¼–è¾‘å™¨
2. é€‰æ‹©ä¸€ä¸ªåŠ¨ä½œï¼ˆä¾‹å¦‚ï¼šattack_01ï¼‰
3. éªŒè¯æ•ˆæœï¼š
   - âœ… å¸§åˆ»åº¦å¡«æ»¡æ•´ä¸ªå®½åº¦
   - âœ… å¸§åˆ»åº¦å’Œè½¨é“å®½åº¦ä¸€è‡´
   - âœ… æ¨ªå‘æ»šåŠ¨æ—¶ï¼Œå¸§åˆ»åº¦å’Œè½¨é“åŒæ­¥
   - âœ… æ‹‰ä¼¸çª—å£æ—¶ï¼Œå¸§åˆ»åº¦è‡ªåŠ¨è°ƒæ•´

---

## ğŸš€ **å…¶ä»–æ”¹è¿›**

### **è§†è§‰å¯¹é½**

åœ¨å¸§åˆ»åº¦åŒºåŸŸæ·»åŠ äº†å·¦ä¾§æ ‡é¢˜èƒŒæ™¯ï¼š

```csharp
// ç»˜åˆ¶å·¦ä¾§è½¨é“æ ‡é¢˜èƒŒæ™¯åŒºåŸŸ
Rect headerBgRect = new Rect(0, 0, trackHeaderWidth, viewRect.height);
EditorGUI.DrawRect(headerBgRect, COLOR_TRACK_HEADER);
DrawVerticalLine(new Vector2(trackHeaderWidth, 0), viewRect.height, COLOR_TRACK_SEPARATOR);
```

**æ•ˆæœ**ï¼š
```
å¸§åˆ»åº¦ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ ‡é¢˜  â”‚ [0] [5] [10] [15] [20]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†• è§†è§‰å¯¹é½
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¢«å–æ¶ˆâ”‚ â—†                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç‰¹æ•ˆ  â”‚    â—†    â—†                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ éŸ³æ•ˆ  â”‚        â—†                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ä¿®å¤å®Œæˆï¼å¸§åˆ»åº¦ç°åœ¨å®Œç¾å¡«æ»¡å¹¶åŒæ­¥ï¼** ğŸŠ


# Phase 3A å®Œæˆ - è§¦å‘å¸§å¤šå¸§æ”¯æŒ + æ•°æ®ç»“æ„å®Œå–„

> ğŸ“… **æ—¥æœŸ**: 2025-10-11  
> ğŸ¯ **é˜¶æ®µ**: Phase 3A - æŠ€èƒ½æ•ˆæœäº‹ä»¶æ•°æ®ç»“æ„  
> âœ… **çŠ¶æ€**: å®Œæˆ

---

## ğŸ¯ **å®Œæˆç›®æ ‡**

1. âœ… è§¦å‘å¸§æ”¯æŒå¸§èŒƒå›´ï¼ˆå•å¸§/å¤šå¸§ï¼‰
2. âœ… åˆ›å»ºå®Œæ•´çš„ `SkillEffectEventData` æ•°æ®ç»“æ„
3. âœ… åˆ›å»º `SkillEffectDataReader` é…ç½®è¡¨è¯»å–æœåŠ¡
4. âœ… æ›´æ–°è¿è¡Œæ—¶å¤šå¸§å±•å¼€é€»è¾‘

---

## ğŸ“Š **è§¦å‘å¸§æ ¼å¼ï¼ˆæœ€ç»ˆç‰ˆï¼‰**

### **æ”¯æŒçš„æ ¼å¼**

**å•å¸§è§¦å‘**ï¼š
```
Frame5:Direct:4001                           // ç¬¬5å¸§ç›´æ¥è§¦å‘
Frame10:Collision(Box:5x2x1):4002           // ç¬¬10å¸§ç¢°æ’è§¦å‘
Frame15:Condition(Energy>50):4003           // ç¬¬15å¸§æ¡ä»¶è§¦å‘
```

**å¤šå¸§è§¦å‘**ï¼ˆæ–°å¢ï¼‰ï¼š
```
Frame5-10:Collision(Box:5x2x1):4001         // 5-10å¸§æŒç»­ç¢°æ’åˆ¤å®š
Frame15-20:Direct:4002                       // 15-20å¸§æŒç»­ç›´æ¥è§¦å‘
Frame25-30:Collision(Sphere:3.0):4003       // 25-30å¸§çƒå½¢ç¢°æ’
```

**æ··åˆä½¿ç”¨**ï¼š
```
Frame5:Direct:4001,
Frame10-20:Collision(Box:5x2x1):4002,
Frame25:Collision(Sphere:3.0):4003,
Frame30-35:Condition(Energy>30):4004
```

### **å®Œæ•´æ ¼å¼è§„èŒƒ**
```
Frame{èµ·å§‹å¸§}[-{ç»“æŸå¸§}]:{è§¦å‘ç±»å‹}[({å‚æ•°})]:{æ•ˆæœID}
```

**ç»„æˆéƒ¨åˆ†**ï¼š
1. **å¸§èŒƒå›´**ï¼š`Frame5` æˆ– `Frame5-10`
2. **è§¦å‘ç±»å‹**ï¼š`Direct` / `Collision(ç¢°æ’ç›’)` / `Condition(æ¡ä»¶)`
3. **æ•ˆæœID**ï¼šå¯¹åº” SkillEffectTable

---

## ğŸ”§ **æ•°æ®ç»“æ„æ›´æ–°**

### **TriggerFrameData (ç¼–è¾‘å™¨)**

```csharp
// Editor/RoleEditor/Data/SkillActionEditorData.cs
[Serializable]
public class TriggerFrameData
{
    public int StartFrame;       // èµ·å§‹å¸§
    public int EndFrame;         // ç»“æŸå¸§ï¼ˆå•å¸§æ—¶ç­‰äºStartFrameï¼‰
    public string TriggerType;   // Collision, Direct, Condition
    public string CollisionInfo; // ç¢°æ’ç›’ä¿¡æ¯
    public int EffectId;         // æ•ˆæœID
    
    // è¾…åŠ©å±æ€§
    public bool IsSingleFrame => StartFrame == EndFrame;
    public int Duration => EndFrame - StartFrame + 1;
    
    // è§£æï¼šæ”¯æŒ "Frame5" å’Œ "Frame5-10"
    public static List<TriggerFrameData> ParseFromString(string str);
    
    // åºåˆ—åŒ–ï¼šè‡ªåŠ¨åˆ¤æ–­å•å¸§/å¤šå¸§
    public static string SerializeToString(List<TriggerFrameData> triggers);
}
```

**è§£æé€»è¾‘**ï¼š
- `Frame5` â†’ StartFrame=5, EndFrame=5
- `Frame5-10` â†’ StartFrame=5, EndFrame=10
- éªŒè¯ï¼šStartFrame <= EndFrame

**åºåˆ—åŒ–é€»è¾‘**ï¼š
- å•å¸§ï¼š`Frame5:...`
- å¤šå¸§ï¼š`Frame5-10:...`

---

### **SkillEffectEventData (æ—¶é—´è½´)**

```csharp
// Timeline/EventData/SkillEffectEventData.cs (æ–°å»ºï¼Œ297è¡Œ)
[Serializable]
public class SkillEffectEventData
{
    // æ ¸å¿ƒæ•°æ®
    public int EffectId;
    public string TriggerType;
    public string CollisionInfo;
    
    // æ•ˆæœè¯¦æƒ…ï¼ˆä»é…ç½®è¡¨è¯»å–ï¼‰
    public string EffectName;
    public int EffectType;
    public float EffectValue;
    public float EffectRange;
    public int TargetType;
    
    // ç¢°æ’ç›’è§£æç»“æœ
    public string CollisionShapeType; // Box, Sphere, Capsule, Point
    public string CollisionShapeSize; // "5x2x1" æˆ– "3.0"
    
    // æ–¹æ³•
    public static SkillEffectEventData CreateFromTable(int effectId, ...);
    public void RefreshFromTable();
    public void ParseCollisionInfo();
    public string GetDisplayName();        // "æ™®é€šæ”»å‡» (150)"
    public string GetDetailText();         // å®Œæ•´ä¿¡æ¯
    public Color GetEffectTypeColor();     // æ•ˆæœç±»å‹é¢œè‰²
    public string GetTriggerIcon();        // è§¦å‘ç±»å‹å›¾æ ‡
    public bool Validate(out List<string> errors);
}
```

**åŠŸèƒ½**ï¼š
- âœ… ä»é…ç½®è¡¨è‡ªåŠ¨è¯»å–æ•ˆæœè¯¦æƒ…
- âœ… è§£æç¢°æ’ç›’ä¿¡æ¯
- âœ… æä¾›æ˜¾ç¤ºåç§°å’Œé¢œè‰²
- âœ… æ•°æ®éªŒè¯

---

### **SkillEffectDataReader (æœåŠ¡)**

```csharp
// Services/SkillEffectDataReader.cs (æ–°å»ºï¼Œ159è¡Œ)
public static class SkillEffectDataReader
{
    // è¯»å–
    public static List<SkillEffectTableData> ReadAllSkillEffects();
    public static SkillEffectTableData GetSkillEffect(int effectId);
    
    // åˆ†ç»„å’Œç­›é€‰
    public static Dictionary<int, List<...>> GroupByEffectType();
    public static List<...> FilterByEffectType(int effectType);
    public static List<...> SearchEffects(string keyword);
    
    // è¾…åŠ©
    public static string GetEffectTypeName(int type);
    public static string GetTargetTypeName(int type);
    public static string GetEffectTypeIcon(int type);
    public static void ClearCache();
}
```

**åŠŸèƒ½**ï¼š
- âœ… è¯»å–æ‰€æœ‰æŠ€èƒ½æ•ˆæœé…ç½®
- âœ… æŒ‰æ•ˆæœç±»å‹åˆ†ç»„
- âœ… æœç´¢å’Œç­›é€‰
- âœ… æ•°æ®ç¼“å­˜æœºåˆ¶

---

## ğŸ”„ **è¿è¡Œæ—¶å¤„ç†**

### **å¤šå¸§å±•å¼€é€»è¾‘**

**è¾“å…¥**ï¼ˆé…ç½®è¡¨ï¼‰ï¼š
```
Frame10-20:Collision(Box:5x2x1):4002
```

**å¤„ç†**ï¼ˆSkillConfigManagerï¼‰ï¼š
```csharp
for (int frame = 10; frame <= 20; frame++)
{
    results.Add(new TriggerFrameInfo
    {
        Frame = frame,
        TriggerType = "Collision",
        CollisionShape = ParsedShape,
        EffectId = 4002
    });
}
```

**è¾“å‡º**ï¼ˆè¿è¡Œæ—¶ï¼‰ï¼š
```
11ä¸ª TriggerFrameInfo å¯¹è±¡
Frame=10, Frame=11, ..., Frame=20
```

**é€å¸§æ£€æŸ¥**ï¼š
```csharp
// SkillExecutorCapability.ProcessFrame()
var triggersAtFrame = skillAction.TriggerEffects
    .Where(t => t.Frame == currentFrame)  // âœ… ä»ç„¶æ˜¯å•å¸§æ£€æŸ¥
    .ToList();
```

---

## ğŸ“ **ä¿®æ”¹æ–‡ä»¶æ¸…å•**

### **æ–°å»ºæ–‡ä»¶ (2ä¸ª)**
1. âœ… `SkillEffectEventData.cs` (297è¡Œ)
2. âœ… `SkillEffectDataReader.cs` (159è¡Œ)

### **æ›´æ–°æ–‡ä»¶ (3ä¸ª)**
1. âœ… `SkillActionEditorData.cs`
   - TriggerFrameData æ·»åŠ  StartFrame/EndFrame
   - æ›´æ–° ParseFromString() æ”¯æŒå¸§èŒƒå›´
   - æ›´æ–° SerializeToString() è‡ªåŠ¨åˆ¤æ–­å•å¸§/å¤šå¸§
   - æ›´æ–° Clone() æ–¹æ³•

2. âœ… `SkillConfigManager.cs`
   - ParseTriggerFrames() æ”¯æŒå¸§èŒƒå›´è§£æ
   - å¤šå¸§å±•å¼€ä¸ºå•å¸§åˆ—è¡¨
   - æ›´æ–°æ—¥å¿—è¾“å‡º

3. âœ… æ–‡æ¡£æ›´æ–°ï¼ˆå¾…å®Œæˆï¼‰

---

## ğŸ¨ **æ—¶é—´è½´æ˜¾ç¤ºæ•ˆæœï¼ˆé¢„æœŸï¼‰**

```
æ—¶é—´è½´ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¥ æŠ€èƒ½æ•ˆæœ                                 â”‚
â”‚  â—†5  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ10-20  â—†25  â–ˆâ–ˆâ–ˆâ–ˆ30-35     â”‚
â”‚  â†‘   â†‘                  â†‘    â†‘             â”‚
â”‚  å•å¸§ å¤šå¸§ç¢°æ’åŒºé—´       å•å¸§  å¤šå¸§åŒºé—´      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å›¾ä¾‹ï¼š
â—† - å•å¸§äº‹ä»¶ï¼ˆè±å½¢æ ‡è®°ï¼Œå®½åº¦å›ºå®šï¼‰
â–ˆ - å¤šå¸§äº‹ä»¶ï¼ˆçŸ©å½¢åŒºé—´ï¼Œå®½åº¦æ ¹æ®å¸§æ•°ï¼‰

é¢œè‰²ï¼š
ğŸ”´ çº¢è‰² - ä¼¤å®³æ•ˆæœ
ğŸŸ¢ ç»¿è‰² - æ²»ç–—æ•ˆæœ
ğŸŸ  æ©™è‰² - å‡»é€€æ•ˆæœ
ğŸ”µ è“è‰² - Buffæ•ˆæœ
ğŸŸ£ ç´«è‰² - Debuffæ•ˆæœ
```

---

## âœ… **ç¼–è¯‘ç»“æœ**

```bash
âœ… ç¼–è¯‘æˆåŠŸ - 0 errors
âœ… æ‰€æœ‰ä»£ç è¯­æ³•æ­£ç¡®
âœ… æ–°æ–‡ä»¶å·²åˆ›å»º
âœ… æ•°æ®ç»“æ„å®Œæ•´
```

---

## ğŸš€ **ä¸‹ä¸€æ­¥ï¼šPhase 3B/3C**

### **Phase 3Bï¼šæŠ€èƒ½æ•ˆæœé€‰æ‹©å™¨** (2-3å°æ—¶)
- åˆ›å»º `SkillEffectSelectorWindow.cs`
- æ•ˆæœåˆ—è¡¨å±•ç¤ºï¼ˆæŒ‰ç±»å‹åˆ†ç»„ï¼‰
- æœç´¢å’Œç­›é€‰åŠŸèƒ½
- æ•ˆæœè¯¦æƒ…é¢„è§ˆ

### **Phase 3Cï¼šå®Œæ•´æ¸²æŸ“å™¨** (2-3å°æ—¶)
- åˆ›å»º `SkillEffectTrackRenderer.cs`
- å•å¸§äº‹ä»¶æ¸²æŸ“ï¼ˆè±å½¢ï¼‰
- å¤šå¸§äº‹ä»¶æ¸²æŸ“ï¼ˆçŸ©å½¢åŒºé—´ï¼‰
- é¢œè‰²åŒºåˆ†æ•ˆæœç±»å‹
- ç¢°æ’ç›’å›¾æ ‡æ˜¾ç¤º
- æ‚¬åœä¿¡æ¯æç¤º

---

## ğŸ“š **æ ¼å¼ç¤ºä¾‹**

### **å•å¸§ç¤ºä¾‹**
```csv
triggerFrames = "Frame5:Direct:4001,Frame10:Collision(Box:5x2x1):4002"
```
è¿è¡Œæ—¶å±•å¼€ä¸ºï¼š
- Frame 5 â†’ Directè§¦å‘
- Frame 10 â†’ Collisionè§¦å‘ï¼ˆBoxç¢°æ’ç›’ï¼‰

### **å¤šå¸§ç¤ºä¾‹**
```csv
triggerFrames = "Frame10-20:Collision(Box:5x2x1):4002"
```
è¿è¡Œæ—¶å±•å¼€ä¸ºï¼š
- Frame 10-20 â†’ æ¯å¸§éƒ½è¿›è¡ŒCollisionåˆ¤å®šï¼ˆå…±11ä¸ªåˆ¤å®šç‚¹ï¼‰

### **æ··åˆç¤ºä¾‹**
```csv
triggerFrames = "Frame5:Direct:4001,Frame10-20:Collision(Box:5x2x1):4002,Frame25:Collision(Sphere:3.0):4003"
```

---

**Phase 3A å®Œæˆï¼æ•°æ®ç»“æ„å·²å°±ç»ªï¼Œå¯ä»¥å¼€å§‹å®ç°å¯è§†åŒ–ç¼–è¾‘ï¼** ğŸŠ


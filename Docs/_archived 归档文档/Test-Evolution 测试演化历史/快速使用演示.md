# 🎯 快速使用演示 - 运行单个测试

## ✅ 现在你可以这样做了！

---

## 场景 1: 禁用编译失败的测试，运行其他测试

### 问题
`SkillSystemTests.cs` 使用了过时的 API，导致整个测试项目编译失败。

### 解决方法

#### 方式 1: 使用脚本快速禁用

```powershell
# 进入测试目录
cd AstrumTest

# 临时禁用过时的测试
.\临时禁用测试.ps1 -TestFile "AstrumTest/SkillSystemTests.cs"
```

执行后：
- ✅ `SkillSystemTests.cs` 被重命名为 `SkillSystemTests.cs.disabled`
- ✅ 不再参与编译
- ✅ 其他测试可以正常运行了

#### 方式 2: 手动重命名

```powershell
# 重命名为 .disabled
mv AstrumTest/SkillSystemTests.cs AstrumTest/SkillSystemTests.cs.disabled

# 或者重命名为 .bak
mv AstrumTest/SkillSystemTests.cs AstrumTest/SkillSystemTests.cs.bak
```

### 现在可以运行其他测试了！

```powershell
# 运行物理测试（不受影响）
.\run-test.ps1 -Module Physics

# 或直接使用 dotnet test
dotnet test AstrumTest/AstrumTest/AstrumTest.csproj --filter "Module=Physics"
```

---

## 场景 2: 运行单个物理测试

### 列出所有物理测试

```powershell
cd AstrumTest
.\run-test.ps1 -Module Physics -List
```

输出示例：
```
AstrumTest.PhysicsTests.TypeConverterTests.Test_FP_To_Fix64_Basic
AstrumTest.PhysicsTests.TypeConverterTests.Test_Fix64_To_FP_Basic
AstrumTest.PhysicsTests.TypeConverterTests.Test_FP_Fix64_RoundTrip
AstrumTest.PhysicsTests.TypeConverterTests.Test_TSVector_To_BepuVector_Basic
...
```

### 运行单个测试方法

```powershell
# 方式 1: 使用脚本
.\run-test.ps1 -TestName "Test_FP_To_Fix64_Basic" -Verbose

# 方式 2: 直接使用 dotnet test
dotnet test AstrumTest/AstrumTest/AstrumTest.csproj `
    --filter "Name=Test_FP_To_Fix64_Basic" `
    --logger "console;verbosity=detailed"
```

### 运行整个测试类

```powershell
# 运行 TypeConverterTests 类的所有测试
.\run-test.ps1 -TestName "TypeConverterTests"
```

---

## 场景 3: 开发新功能时只运行相关测试

### 开发物理功能

```powershell
# 只运行物理模块的测试
.\run-test.ps1 -Module Physics

# 实时监听，代码改变自动运行
dotnet watch test --filter "Module=Physics"
```

### 开发实体功能

```powershell
.\run-test.ps1 -Module Entity
```

---

## 场景 4: 按优先级运行

```powershell
# 只运行高优先级测试（快速验证）
dotnet test --filter "Priority=High"

# 运行单元测试（跳过慢速集成测试）
dotnet test --filter "Category=Unit"
```

---

## 场景 5: IDE 中运行单个测试

### Visual Studio / Rider

1. 打开 `TypeConverterTests.cs`
2. 找到 `Test_FP_To_Fix64_Basic()` 方法
3. 点击方法左侧的 ▶️ 图标
4. **只运行这一个测试**，不管其他测试是否能编译

---

## 🎯 完整工作流示例

### 步骤 1: 禁用过时的测试

```powershell
cd d:\Develop\Projects\Astrum\AstrumTest
.\临时禁用测试.ps1 -TestFile "AstrumTest/SkillSystemTests.cs"
```

### 步骤 2: 验证可以编译了

```powershell
dotnet build AstrumTest/AstrumTest/AstrumTest.csproj
```

应该看到：
```
✅ 生成成功
    0 个警告
    0 个错误
```

### 步骤 3: 列出可用的测试

```powershell
.\run-test.ps1 -List
```

### 步骤 4: 运行特定测试

```powershell
# 运行类型转换测试
.\run-test.ps1 -TestName "TypeConverter"

# 运行实体测试
.\run-test.ps1 -TestName "Entity"

# 运行单个测试方法
.\run-test.ps1 -TestName "Test_FP_To_Fix64_Basic" -Verbose
```

### 步骤 5: 需要时重新启用测试

```powershell
# 修复 API 后重新启用
.\临时禁用测试.ps1 -TestFile "AstrumTest/SkillSystemTests.cs" -Enable
```

---

## 📋 常用命令速查

### 禁用/启用测试

```powershell
# 禁用
.\临时禁用测试.ps1 -TestFile "AstrumTest/SkillSystemTests.cs"

# 启用
.\临时禁用测试.ps1 -TestFile "AstrumTest/SkillSystemTests.cs" -Enable
```

### 运行测试

```powershell
# 按名称（模糊匹配）
.\run-test.ps1 -TestName "Physics"

# 按类别
.\run-test.ps1 -Category Unit

# 按模块
.\run-test.ps1 -Module Physics

# 列出所有测试
.\run-test.ps1 -List

# 详细输出
.\run-test.ps1 -TestName "TypeConverter" -Verbose
```

### 原生 dotnet test 命令

```bash
# 完全限定名（精确匹配）
dotnet test --filter "FullyQualifiedName=AstrumTest.PhysicsTests.TypeConverterTests.Test_FP_To_Fix64_Basic"

# 模糊匹配
dotnet test --filter "Name~TypeConverter"
dotnet test --filter "FullyQualifiedName~Physics"

# 按 Trait
dotnet test --filter "Category=Unit"
dotnet test --filter "Module=Physics"
dotnet test --filter "Priority=High"

# 组合条件
dotnet test --filter "Category=Unit&Module=Physics"
```

---

## 💡 最佳实践

### 1. 开发新功能时

✅ **只运行相关模块的测试**

```powershell
# 开发物理功能，只跑物理测试
.\run-test.ps1 -Module Physics

# 代码改动后立即验证
dotnet watch test --filter "Module=Physics"
```

### 2. 发现测试过时时

✅ **先禁用，不阻塞其他测试**

```powershell
# 禁用过时的测试
.\临时禁用测试.ps1 -TestFile "AstrumTest/OldTest.cs"

# 继续开发其他功能
.\run-test.ps1 -Module Physics
```

✅ **稍后修复并重新启用**

```powershell
# 修复 API 调用
# 重新启用
.\临时禁用测试.ps1 -TestFile "AstrumTest/OldTest.cs" -Enable

# 验证修复
.\run-test.ps1 -TestName "OldTest"
```

### 3. 提交代码前

✅ **运行所有单元测试**

```powershell
# 快速验证
.\run-test.ps1 -Category Unit

# 如果通过，运行所有测试
dotnet test
```

---

## 🚀 下一步改进

### 立即可做（5分钟）

1. **禁用过时的 SkillSystemTests**
   ```powershell
   cd d:\Develop\Projects\Astrum\AstrumTest
   .\临时禁用测试.ps1 -TestFile "AstrumTest/SkillSystemTests.cs"
   ```

2. **验证物理测试可以运行**
   ```powershell
   .\run-test.ps1 -Module Physics
   ```

3. **在 .gitignore 中添加**
   ```
   # 禁用的测试
   *.disabled
   ```

### 中期改进（1-2 天）

1. **拆分测试项目** - 见 `测试项目改进方案.md`
2. **修复过时的 API** - 将 `SkillActions` 改为 `SkillActionIds`
3. **添加 Trait 标记** - 已完成部分

### 长期改进（持续）

1. **建立 CI/CD 流水线** - 自动运行测试
2. **监控测试覆盖率** - 确保质量
3. **定期清理过时测试** - 保持代码健康

---

## 🎉 总结

改进后，你现在可以：

✅ **禁用单个测试文件** - 不影响其他测试  
✅ **运行单个测试用例** - 精确控制运行范围  
✅ **按模块/类别过滤** - 快速定位相关测试  
✅ **便捷的脚本工具** - 简化日常操作  

**不再需要"要么全部通过，要么全部失败"！** 🎊


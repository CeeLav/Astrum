# æµ‹è¯•éš”ç¦»è§£å†³æ–¹æ¡ˆ - å®æˆ˜æŒ‡å—

## ğŸ”´ æ ¸å¿ƒé—®é¢˜

ä½ é‡åˆ°çš„é—®é¢˜éå¸¸å…¸å‹ï¼š

```
âŒ é—®é¢˜ï¼šæµ‹è¯• A è¿‡æ—¶äº† â†’ æ•´ä¸ªæµ‹è¯•é¡¹ç›®ç¼–è¯‘å¤±è´¥ â†’ æ— æ³•è¿è¡Œæµ‹è¯• B
```

**ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ**
- æ‰€æœ‰æµ‹è¯•æ–‡ä»¶éƒ½åœ¨åŒä¸€ä¸ª csproj ä¸­
- ç¼–è¯‘æ—¶ä¼šç¼–è¯‘æ‰€æœ‰ `.cs` æ–‡ä»¶
- ä¸€ä¸ªæ–‡ä»¶æœ‰é”™è¯¯ï¼Œæ•´ä¸ªé¡¹ç›®å°±ç¼–è¯‘å¤±è´¥
- **å³ä½¿ä½ åªæƒ³è¿è¡Œä¸€ä¸ªæµ‹è¯•ï¼Œä¹Ÿå¿…é¡»æ‰€æœ‰æµ‹è¯•éƒ½èƒ½ç¼–è¯‘é€šè¿‡**

---

## âœ… è§£å†³æ–¹æ¡ˆ

æˆ‘æä¾› **3 ç§æ–¹æ¡ˆ**ï¼Œä»ç®€å•åˆ°å½»åº•ï¼š

---

## æ–¹æ¡ˆ 1: æ¡ä»¶ç¼–è¯‘ + è·³è¿‡ï¼ˆæœ€ç®€å•ï¼‰â­

### å®æ–½æ–¹å¼

å¯¹äºè¿‡æ—¶çš„æµ‹è¯•ï¼Œä½¿ç”¨ `#if` æ¡ä»¶ç¼–è¯‘ï¼š

```csharp
#if ENABLE_LEGACY_TESTS  // é»˜è®¤ä¸ç¼–è¯‘è¿‡æ—¶çš„æµ‹è¯•

namespace AstrumTest
{
    [Trait("Category", "Legacy")]
    public class SkillSystemTests_Legacy
    {
        [Fact]
        public void OldTest_WithOutdatedAPI()
        {
            // ä½¿ç”¨è¿‡æ—¶çš„ API
            var skillActions = skillInfo.SkillActions;  // è¿™ä¸ª API ä¸å­˜åœ¨äº†
        }
    }
}

#endif
```

### ä½¿ç”¨æ–¹å¼

```bash
# é»˜è®¤æƒ…å†µï¼šè¿‡æ—¶çš„æµ‹è¯•ä¸ä¼šè¢«ç¼–è¯‘ï¼Œä¸å½±å“å…¶ä»–æµ‹è¯•
dotnet test

# éœ€è¦æ—¶å¯ç”¨è¿‡æ—¶çš„æµ‹è¯•
dotnet build -p:DefineConstants=ENABLE_LEGACY_TESTS
dotnet test -p:DefineConstants=ENABLE_LEGACY_TESTS
```

### ä¼˜ç‚¹
- âœ… æœ€ç®€å•ï¼Œæ”¹åŠ¨æœ€å°
- âœ… è¿‡æ—¶æµ‹è¯•ä¸å½±å“æ­£å¸¸æµ‹è¯•
- âœ… éœ€è¦æ—¶å¯ä»¥é‡æ–°å¯ç”¨

### ç¼ºç‚¹
- âš ï¸ è¿‡æ—¶æµ‹è¯•é»˜è®¤ä¸è¿è¡Œ
- âš ï¸ éœ€è¦è®°å¾—æ¸…ç†è¿‡æ—¶ä»£ç 

---

## æ–¹æ¡ˆ 2: å¤šé¡¹ç›®æ‹†åˆ†ï¼ˆæ¨èï¼‰â­â­â­

### é¡¹ç›®ç»“æ„

```
AstrumTest/
â”œâ”€â”€ AstrumTest.Core/              # æ ¸å¿ƒæµ‹è¯•ï¼ˆç¨³å®šï¼‰
â”‚   â”œâ”€â”€ AstrumTest.Core.csproj
â”‚   â”œâ”€â”€ PhysicsTests/
â”‚   â”‚   â”œâ”€â”€ TypeConverterTests.cs
â”‚   â”‚   â””â”€â”€ HitManagerTests.cs
â”‚   â””â”€â”€ EntityTests/
â”‚       â””â”€â”€ EntitySystemTests.cs
â”‚
â”œâ”€â”€ AstrumTest.Skill/             # æŠ€èƒ½æµ‹è¯•ï¼ˆç‹¬ç«‹ï¼‰
â”‚   â”œâ”€â”€ AstrumTest.Skill.csproj
â”‚   â””â”€â”€ SkillSystemTests.cs       # å³ä½¿è¿™ä¸ªè¿‡æ—¶äº†ï¼Œä¸å½±å“å…¶ä»–é¡¹ç›®
â”‚
â”œâ”€â”€ AstrumTest.Network/           # ç½‘ç»œæµ‹è¯•ï¼ˆç‹¬ç«‹ï¼‰
â”‚   â”œâ”€â”€ AstrumTest.Network.csproj
â”‚   â””â”€â”€ ProtocolSerializationTests.cs
â”‚
â””â”€â”€ AstrumTest.Common/            # å…¬å…±åŸºç¡€è®¾æ–½
    â”œâ”€â”€ AstrumTest.Common.csproj
    â”œâ”€â”€ ConfigFixture.cs
    â””â”€â”€ TestBase.cs
```

### åˆ›å»ºç‹¬ç«‹é¡¹ç›®

```bash
# åœ¨ AstrumTest ç›®å½•ä¸‹

# åˆ›å»ºæ ¸å¿ƒæµ‹è¯•é¡¹ç›®
dotnet new xunit -n AstrumTest.Core
dotnet add AstrumTest.Core reference ../AstrumProj/AstrumLogic.csproj

# åˆ›å»ºæŠ€èƒ½æµ‹è¯•é¡¹ç›®
dotnet new xunit -n AstrumTest.Skill
dotnet add AstrumTest.Skill reference ../AstrumProj/AstrumLogic.csproj

# åˆ›å»ºç½‘ç»œæµ‹è¯•é¡¹ç›®
dotnet new xunit -n AstrumTest.Network
dotnet add AstrumTest.Network reference ../AstrumProj/AstrumLogic.csproj
```

### è¿è¡Œæ–¹å¼

```bash
# åªè¿è¡Œç‰©ç†æµ‹è¯•ï¼ˆå³ä½¿æŠ€èƒ½æµ‹è¯•ç¼–è¯‘å¤±è´¥ä¹Ÿä¸å½±å“ï¼‰
dotnet test AstrumTest.Core/AstrumTest.Core.csproj --filter "Module=Physics"

# åªè¿è¡ŒæŠ€èƒ½æµ‹è¯•
dotnet test AstrumTest.Skill/AstrumTest.Skill.csproj

# è¿è¡Œæ‰€æœ‰èƒ½ç¼–è¯‘é€šè¿‡çš„æµ‹è¯•ï¼ˆå¤±è´¥çš„é¡¹ç›®ä¼šè¢«è·³è¿‡ï¼‰
dotnet test --no-build || true
```

### ä¼˜ç‚¹
- âœ… **å®Œå…¨éš”ç¦»** - ä¸€ä¸ªé¡¹ç›®ç¼–è¯‘å¤±è´¥ä¸å½±å“å…¶ä»–é¡¹ç›®
- âœ… **å¹¶è¡Œå¼€å‘** - ä¸åŒæ¨¡å—çš„æµ‹è¯•å¯ä»¥ç‹¬ç«‹æ¼”è¿›
- âœ… **æ¸…æ™°ç»„ç»‡** - æŒ‰åŠŸèƒ½é¢†åŸŸåˆ’åˆ†
- âœ… **ç‹¬ç«‹éƒ¨ç½²** - å¯ä»¥åªè¿è¡Œç‰¹å®šæ¨¡å—çš„æµ‹è¯•

### ç¼ºç‚¹
- âš ï¸ éœ€è¦é‡æ–°ç»„ç»‡æ–‡ä»¶ç»“æ„
- âš ï¸ ç»´æŠ¤å¤šä¸ª csproj

---

## æ–¹æ¡ˆ 3: ä½¿ç”¨ .bak å¤‡ä»½ï¼ˆå½“å‰æ–¹æ¡ˆçš„æ”¹è¿›ï¼‰â­

### æ”¹è¿›å½“å‰çš„ .bak æ–¹å¼

å½“å‰ä½ å·²ç»æœ‰å¾ˆå¤š `.bak` æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç³»ç»ŸåŒ–è¿™ä¸ªæ–¹æ³•ï¼š

#### åˆ›å»ºç®¡ç†è„šæœ¬

**disable-test.ps1** (ç¦ç”¨æµ‹è¯•)ï¼š

```powershell
param([string]$TestFile)

if (Test-Path $TestFile) {
    $bakFile = "$TestFile.bak"
    Move-Item -Path $TestFile -Destination $bakFile -Force
    Write-Host "å·²ç¦ç”¨æµ‹è¯•: $TestFile -> $bakFile" -ForegroundColor Yellow
}
```

**enable-test.ps1** (å¯ç”¨æµ‹è¯•)ï¼š

```powershell
param([string]$TestFile)

$bakFile = "$TestFile.bak"
if (Test-Path $bakFile) {
    Move-Item -Path $bakFile -Destination $TestFile -Force
    Write-Host "å·²å¯ç”¨æµ‹è¯•: $bakFile -> $TestFile" -ForegroundColor Green
}
```

#### ä½¿ç”¨æ–¹å¼

```powershell
# ç¦ç”¨è¿‡æ—¶çš„æµ‹è¯•
.\disable-test.ps1 AstrumTest/AstrumTest/SkillSystemTests.cs

# ç°åœ¨å¯ä»¥è¿è¡Œå…¶ä»–æµ‹è¯•äº†
dotnet test --filter "Module=Physics"

# éœ€è¦æ—¶é‡æ–°å¯ç”¨
.\enable-test.ps1 AstrumTest/AstrumTest/SkillSystemTests.cs
```

### ä¼˜ç‚¹
- âœ… ç®€å•ç›´æ¥
- âœ… ä¸æ”¹å˜é¡¹ç›®ç»“æ„
- âœ… ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

### ç¼ºç‚¹
- âš ï¸ éœ€è¦æ‰‹åŠ¨ç®¡ç† .bak æ–‡ä»¶
- âš ï¸ å®¹æ˜“å¿˜è®°é‡æ–°å¯ç”¨
- âš ï¸ Git ä¸­å¯èƒ½ä¼šæäº¤ .bak æ–‡ä»¶

---

## ğŸ¯ æ¨èå®æ–½è·¯å¾„

### çŸ­æœŸæ–¹æ¡ˆï¼ˆä»Šå¤©å°±èƒ½ç”¨ï¼‰

**ä½¿ç”¨æ¡ä»¶ç¼–è¯‘éš”ç¦»è¿‡æ—¶æµ‹è¯•**ï¼š

1. ä¿®æ”¹ `SkillSystemTests.cs`ï¼š
```csharp
// æ–‡ä»¶å¼€å¤´æ·»åŠ 
#if ENABLE_SKILL_TESTS  // æš‚æ—¶ç¦ç”¨è¿™ä¸ªæµ‹è¯•æ–‡ä»¶

// æ–‡ä»¶æœ«å°¾æ·»åŠ 
#endif
```

2. è¿è¡Œå…¶ä»–æµ‹è¯•ï¼š
```bash
# ç‰©ç†æµ‹è¯•å¯ä»¥æ­£å¸¸è¿è¡Œäº†
dotnet test --filter "Module=Physics"
```

3. éœ€è¦æ—¶å¯ç”¨ï¼š
```bash
dotnet test -p:DefineConstants=ENABLE_SKILL_TESTS
```

### ä¸­æœŸæ–¹æ¡ˆï¼ˆ1-2 å¤©å®æ–½ï¼‰

**æ‹†åˆ†ä¸ºå¤šä¸ªæµ‹è¯•é¡¹ç›®**ï¼š

æˆ‘å·²ç»ä¸ºä½ å‡†å¤‡å¥½äº†å®Œæ•´çš„è„šæœ¬å’Œæ–‡æ¡£ï¼Œåªéœ€è¦ï¼š

1. åˆ›å»º 3-4 ä¸ªç‹¬ç«‹æµ‹è¯•é¡¹ç›®
2. ç§»åŠ¨æµ‹è¯•æ–‡ä»¶åˆ°å¯¹åº”é¡¹ç›®
3. æ›´æ–°é¡¹ç›®å¼•ç”¨

### é•¿æœŸæ–¹æ¡ˆ

**å»ºç«‹å®Œå–„çš„æµ‹è¯•åŸºç¡€è®¾æ–½**ï¼š

- ä½¿ç”¨ Fixture éš”ç¦»çŠ¶æ€
- ä½¿ç”¨ Trait åˆ†ç±»ç®¡ç†
- ä½¿ç”¨ CI/CD è‡ªåŠ¨è¿è¡Œ
- ä½¿ç”¨è¦†ç›–ç‡ç›‘æ§è´¨é‡

---

## ğŸ’¡ ç«‹å³å¯ç”¨çš„å‘½ä»¤

### è¿è¡Œç‰©ç†æµ‹è¯•ï¼ˆä¸å—æŠ€èƒ½æµ‹è¯•å½±å“ï¼‰

å¦‚æœæˆ‘ä»¬æŠŠè¿‡æ—¶çš„æµ‹è¯•éš”ç¦»åï¼š

```bash
# åªè¿è¡Œç‰©ç†ç›¸å…³æµ‹è¯•
dotnet test --filter "FullyQualifiedName~PhysicsTests"

# åªè¿è¡Œç±»å‹è½¬æ¢æµ‹è¯•
dotnet test --filter "FullyQualifiedName~TypeConverterTests"

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–¹æ³•
dotnet test --filter "Name=Test_FP_To_Fix64_Basic"
```

### ä½¿ç”¨ä¾¿æ·è„šæœ¬

```powershell
# Windows
cd AstrumTest
.\run-test.ps1 -TestName "TypeConverter"  # åªè¿è¡Œç±»å‹è½¬æ¢æµ‹è¯•
.\run-test.ps1 -Module Physics            # åªè¿è¡Œç‰©ç†æ¨¡å—
.\run-test.ps1 -List                      # æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æµ‹è¯•
```

---

## ğŸ”§ ç°åœ¨å¸®ä½ ä¿®å¤

æˆ‘ç°åœ¨å¯ä»¥å¸®ä½ ï¼š

### é€‰é¡¹ A: ç¦ç”¨è¿‡æ—¶çš„æµ‹è¯•ï¼ˆå¿«é€Ÿï¼‰
```bash
# é‡å‘½åä¸º .bakï¼Œæš‚æ—¶ä¸å‚ä¸ç¼–è¯‘
mv SkillSystemTests.cs SkillSystemTests.cs.bak
```

### é€‰é¡¹ B: ä¿®å¤è¿‡æ—¶çš„ APIï¼ˆå½»åº•ï¼‰
- æŸ¥æ‰¾ SkillInfo çš„æ­£ç¡® API
- æ›´æ–°æ‰€æœ‰å¼•ç”¨
- è®©æµ‹è¯•é‡æ–°å·¥ä½œ

### é€‰é¡¹ C: æ‹†åˆ†é¡¹ç›®ï¼ˆæœ€ä½³ï¼‰
- åˆ›å»ºç‹¬ç«‹çš„æµ‹è¯•é¡¹ç›®
- å®Œå…¨éš”ç¦»ä¸åŒæ¨¡å—çš„æµ‹è¯•
- ä¸€åŠ³æ°¸é€¸è§£å†³é—®é¢˜

ä½ æƒ³é€‰æ‹©å“ªä¸ªæ–¹æ¡ˆï¼Ÿæˆ–è€…è®©æˆ‘å…¨éƒ¨å®æ–½ï¼Ÿ


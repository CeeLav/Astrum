{
  "name": "数值系统-死亡流程",
  "description": "测试角色受到致命伤害后的死亡状态变化（使用低血量目标）",
  
  "entityTemplates": [
    {
      "templateId": "attacker",
      "roleId": 1001,
      "team": 1,
      "customHealth": null
    },
    {
      "templateId": "victim",
      "roleId": 1003,
      "team": 2,
      "customHealth": 50
    }
  ],
  
  "frames": [
    {
      "frameNumber": 0,
      "comment": "创建攻击者（骑士）和受害者（法师，低血量50）",
      "inputs": [
        {
          "type": "CreateEntity",
          "templateId": "attacker",
          "position": {"x": 0, "y": 0, "z": 0},
          "entityId": "attacker"
        },
        {
          "type": "CreateEntity",
          "templateId": "victim",
          "position": {"x": 1.2, "y": 0, "z": 0},
          "entityId": "victim"
        }
      ],
      "queries": [
        {
          "type": "EntityHealth",
          "entityId": "victim",
          "resultKey": "victim_hp_initial"
        },
        {
          "type": "EntityIsAlive",
          "entityId": "victim",
          "resultKey": "victim_alive_initial"
        },
        {
          "type": "SkillActionFrame",
          "entityId": "attacker",
          "resultKey": "attacker_skill_frame_0"
        },
        {
          "type": "EntityAction",
          "entityId": "attacker",
          "resultKey": "attacker_action_0"
        }
      ],
      "expectedOutputs": {
        "victim_hp_initial": 50,
        "victim_alive_initial": "True"
      }
    },
    {
      "frameNumber": 10,
      "comment": "骑士攻击低血量法师",
      "inputs": [
        {
          "type": "CastSkill",
          "entityId": "attacker",
          "skillId": 3001,
          "targetId": "victim"
        }
      ],
      "queries": [
        {
          "type": "EntityAction",
          "entityId": "attacker",
          "resultKey": "attacker_action"
        },
        {
          "type": "HasSkillExecutorCapability",
          "entityId": "attacker",
          "resultKey": "attacker_has_executor"
        },
        {
          "type": "CapabilitiesList",
          "entityId": "attacker",
          "resultKey": "attacker_capabilities"
        },
        {
          "type": "SkillActionFrame",
          "entityId": "attacker",
          "resultKey": "attacker_skill_frame"
        },
        {
          "type": "SkillTriggerCount",
          "entityId": "attacker",
          "resultKey": "attacker_trigger_count"
        },
        {
          "type": "SkillTriggerDetails",
          "entityId": "attacker",
          "resultKey": "attacker_trigger_details"
        }
      ],
      "expectedOutputs": {
        "attacker_action": "CastingSkill"
      }
    },
    {
      "frameNumber": 11,
      "comment": "施放技能后的第一帧",
      "inputs": [],
      "queries": [
        {
          "type": "SkillActionFrame",
          "entityId": "attacker",
          "resultKey": "attacker_skill_frame_11"
        },
        {
          "type": "EntityHealth",
          "entityId": "victim",
          "resultKey": "victim_hp_11"
        }
      ],
      "expectedOutputs": {}
    },
    {
      "frameNumber": 16,
      "comment": "触发帧 6（相对帧号）",
      "inputs": [],
      "queries": [
        {
          "type": "SkillActionFrame",
          "entityId": "attacker",
          "resultKey": "attacker_skill_frame_16"
        },
        {
          "type": "EntityHealth",
          "entityId": "victim",
          "resultKey": "victim_hp_16"
        }
      ],
      "expectedOutputs": {}
    },
    {
      "frameNumber": 17,
      "comment": "触发帧 7（相对帧号）",
      "inputs": [],
      "queries": [
        {
          "type": "SkillActionFrame",
          "entityId": "attacker",
          "resultKey": "attacker_skill_frame_17"
        },
        {
          "type": "EntityHealth",
          "entityId": "victim",
          "resultKey": "victim_hp_17"
        }
      ],
      "expectedOutputs": {}
    },
    {
      "frameNumber": 30,
      "comment": "技能执行中，等待命中（应该在 frame 6-7 已经触发）",
      "inputs": [],
      "queries": [
        {
          "type": "SkillActionFrame",
          "entityId": "attacker",
          "resultKey": "attacker_skill_frame_30"
        },
        {
          "type": "EntityHealth",
          "entityId": "victim",
          "resultKey": "victim_hp_30"
        },
        {
          "type": "EntityAction",
          "entityId": "attacker",
          "resultKey": "attacker_action_30"
        },
        {
          "type": "CollisionComponentExists",
          "entityId": "attacker",
          "resultKey": "attacker_has_collision"
        },
        {
          "type": "CollisionComponentExists",
          "entityId": "victim",
          "resultKey": "victim_has_collision"
        },
        {
          "type": "EntityCollisionInfo",
          "entityId": "attacker",
          "resultKey": "attacker_collision_info"
        },
        {
          "type": "EntityCollisionInfo",
          "entityId": "victim",
          "resultKey": "victim_collision_info"
        },
        {
          "type": "HitManagerEntityCount",
          "entityId": "attacker",
          "resultKey": "hitmanager_status"
        }
      ],
      "expectedOutputs": {}
    },
    {
      "frameNumber": 80,
      "comment": "验证最终状态（victim HP应该减少，如果足够低则死亡）",
      "inputs": [],
      "queries": [
        {
          "type": "EntityHealth",
          "entityId": "victim",
          "resultKey": "victim_hp_final"
        },
        {
          "type": "EntityHealth",
          "entityId": "attacker",
          "resultKey": "attacker_hp_final"
        }
      ],
      "expectedOutputs": {
        "victim_hp_final": {"min": 0, "max": 45},
        "attacker_hp_final": {"min": 990, "max": 1000}
      }
    }
  ]
}


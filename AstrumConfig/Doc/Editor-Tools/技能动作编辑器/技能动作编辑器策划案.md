# 技能动作编辑器策划案

**版本**: v1.0  
**创建日期**: 2025-10-09  
**最后更新**: 2025-10-09  
**状态**: 规划阶段  

> 📖 **相关文档**：
> - [动作编辑器策划案](../动作编辑器/动作编辑器策划案.md) - 基础架构参考
> - [技能系统策划案](../../Combat-System/技能系统策划案.md) - 技能系统设计
> - [动作系统策划案](../../Combat-System/ActionSystem/动作系统策划案.md) - 动作系统设计

---

## 📋 目录

1. [概述](#概述)
2. [设计理念](#设计理念)
3. [继承与扩展](#继承与扩展)
4. [技能专属功能](#技能专属功能)
5. [时间轴扩展](#时间轴扩展)
6. [数据结构](#数据结构)
7. [UI/UX设计](#uiux设计)
8. [技术实现](#技术实现)
9. [开发优先级](#开发优先级)
10. [后续规划](#后续规划)

---

## 概述

### 1.1 项目背景

技能动作编辑器是基于动作编辑器扩展的专用工具，用于编辑 **SkillActionTable** 配置表数据。SkillAction 是 Action 的特殊类型，包含技能系统专属的配置数据（触发帧效果、碰撞盒、消耗等）。

### 1.2 核心目标

- **继承动作编辑器** - 复用所有动作编辑器的功能（时间轴、取消标签、动画预览等）
- **技能专属扩展** - 增加技能效果触发、碰撞盒配置等技能特有功能
- **可视化效果编辑** - 在时间轴上直观编辑技能效果的触发时机
- **关联效果表** - 与 SkillEffectTable 紧密集成，支持效果预览和快速配置

### 1.3 关键特性

- 🔗 **完整继承** - 动作编辑器的所有功能（取消标签、特效、音效、相机震动）
- 🎯 **技能效果轨道** - 新增"技能效果"轨道，可视化配置触发帧
- 💥 **效果预览** - 实时查看技能效果数据（伤害、范围、类型等）
- 🎨 **碰撞盒可视化** - 攻击碰撞盒的可视化配置和预览
- 🔄 **双向关联** - 与 SkillTable 和 SkillEffectTable 的双向关联

---

## 设计理念

### 2.1 继承优先

**设计原则**：最大化复用动作编辑器的架构和代码

```
技能动作编辑器 = 动作编辑器 + 技能专属扩展
```

**继承策略**：
- 继承所有模块类（ActionListModule → SkillActionListModule）
- 继承时间轴系统（完全复用）
- 继承数据持久化（扩展 SkillActionTable 的读写）
- 继承窗口布局（保持一致的用户体验）

### 2.2 技能特化

**核心原则**：在动作编辑器基础上，增强技能系统特有的编辑能力

**技能专属功能**：
1. **触发帧效果** - Frame:Type:EffectId 的可视化编辑（可选 HitBox/Condition）
2. **碰撞盒配置** - AttackBoxInfo 的编辑和预览
3. **效果关联** - 与 SkillEffectTable 的查询和展示
4. **技能成本** - ActualCost 和 ActualCooldown 的配置

### 2.3 表格关联

**数据关系**：
```
SkillActionTable (技能动作编辑器)
    ↓ ActionId
ActionTable (动作编辑器)
    → 动画、表现数据
    
SkillActionTable
    ↓ TriggerFrames: Frame:Type:EffectId（可选 HitBox/Condition）
SkillEffectTable (技能效果表)
    → 效果数据、数值、参数
    
SkillActionTable
    ↓ SkillId
SkillTable (技能编辑器)
    → 技能基本信息、动作列表
```

---

## 继承与扩展

### 3.1 完整继承的功能

从动作编辑器**完整继承**以下功能：

#### 3.1.1 核心功能模块
- ✅ **动作列表模块** - 动作的创建、删除、复制、排序
- ✅ **动作配置模块** - 基础信息、取消标签、命令绑定
- ✅ **动画预览模块** - 3D 模型和动画实时预览
- ✅ **时间轴模块** - 多轨道时间轴系统

#### 3.1.2 时间轴轨道
- ✅ **被取消标签轨道** - BeCancelledTag 配置
- ✅ **特效轨道** - Visual Effect 配置（预留）
- ✅ **音效轨道** - Sound Effect 配置（预留）
- ✅ **相机震动轨道** - Camera Shake 配置（预留）

#### 3.1.3 数据系统
- ✅ **CSV 读写** - 基于 Luban 框架的配置表读写
- ✅ **数据验证** - 完整性检查和错误提示
- ✅ **脏标记** - 修改跟踪和保存提示

### 3.2 扩展的功能

在继承基础上**新增**技能专属功能：

#### 3.2.1 新增轨道
- 🆕 **技能效果轨道** - 触发帧效果的可视化编辑
- 🆕 **碰撞盒轨道** - 攻击碰撞盒的时间轴展示（可选）

#### 3.2.2 新增配置区
- 🆕 **技能信息面板** - 显示所属技能ID、技能名称
- 🆕 **技能成本配置** - ActualCost 和 ActualCooldown
- 🆕 **碰撞盒编辑器** - AttackBoxInfo 的可视化编辑

#### 3.2.3 新增功能
- 🆕 **效果预览窗口** - 查看 SkillEffectTable 的详细数据
- 🆕 **效果快速选择** - 效果ID的下拉选择和搜索
- 🆕 **技能关联查看** - 查看该动作属于哪个技能

---

## 技能专属功能

### 4.1 触发帧效果编辑

#### 功能描述
在时间轴上可视化编辑技能效果的触发时机和类型。

#### 数据结构
```csharp
TriggerFrameEffect
├── Frame (int) - 触发帧号
├── Type (string) - 触发类型 (Collision/Direct/Condition)
├── HitBox (optional) - 即时检测用碰撞盒
├── Condition (optional) - 即时检测用条件参数
└── EffectId (int) - 技能效果ID
```

#### UI设计
```
时间轴轨道：
┌────────────────────────────────────────────┐
│ 技能效果 │  [+]                            │
├────────────────────────────────────────────┤
│ Frame 5   │ [Collision] 伤害:150          │ ← 效果事件
│ Frame 12  │ [Direct]    击退:3.0          │ ← 效果事件
└────────────────────────────────────────────┘
```

#### 交互方式
- **添加**: 右键时间轴 → "添加技能效果" → 选择效果类型和ID
- **编辑**: 双击效果事件 → 弹出效果编辑面板
- **删除**: 选中后按 Delete 键或右键菜单删除
- **拖动**: 拖拽效果事件可调整触发帧位置
- **预览**: 悬停显示效果详情（类型、数值、范围等）

### 4.2 技能效果选择器

#### 功能描述
提供友好的 SkillEffectTable 效果选择界面。

#### UI设计
```
┌─ 选择技能效果 ──────────────────────┐
│                                      │
│  搜索: [________________]  [🔍]     │
│                                      │
│  效果列表:                           │
│  ┌────────────────────────────────┐│
│  │ 4001 - 物理伤害 (150.0)        ││
│  │ 4002 - 击退效果 (3.0)          ││
│  │ 4003 - 物理伤害 (80.0)         ││
│  │ ...                             ││
│  └────────────────────────────────┘│
│                                      │
│  详细信息:                           │
│  ┌────────────────────────────────┐│
│  │ 效果ID: 4001                    ││
│  │ 效果类型: 伤害                  ││
│  │ 效果数值: 150.0                 ││
│  │ 目标类型: 敌人                  ││
│  │ 效果范围: 2.0                   ││
│  │ 视觉效果ID: 5001                ││
│  │ 音效ID: 6001                    ││
│  └────────────────────────────────┘│
│                                      │
│           [确定]    [取消]           │
└──────────────────────────────────────┘
```

#### 功能特性
- **搜索过滤**: 根据效果ID、类型、数值搜索
- **分类显示**: 按效果类型（伤害、治疗、buff等）分类
- **详细预览**: 显示效果的所有参数
- **快速创建**: 如果需要的效果不存在，可快速跳转到 SkillEffectTable 创建

### 4.3 碰撞盒编辑器

#### 功能描述
可视化编辑攻击碰撞盒信息（AttackBoxInfo）。

#### 数据格式
```
AttackBoxInfo 字符串格式:
"Box1:5x2x1,Box2:3x3x1"

解析为:
├── Box1: 5(长) x 2(宽) x 1(高)
└── Box2: 3(长) x 3(宽) x 1(高)
```

#### UI设计
```
┌─ 攻击碰撞盒配置 ────────────────────┐
│                                      │
│  碰撞盒列表:                         │
│  ┌────────────────────────────────┐│
│  │ Box1: 5.0 x 2.0 x 1.0    [编辑]││
│  │ Box2: 3.0 x 3.0 x 1.0    [删除]││
│  └────────────────────────────────┘│
│                                      │
│  [+ 添加新碰撞盒]                    │
│                                      │
│  预览 (3D):                          │
│  ┌────────────────────────────────┐│
│  │         ┌─────┐                 ││
│  │         │Box1 │                 ││
│  │     ┌───┴─────┴───┐             ││
│  │     │    Box2      │             ││
│  │     └──────────────┘             ││
│  └────────────────────────────────┘│
│                                      │
│         [应用]    [取消]             │
└──────────────────────────────────────┘
```

#### 编辑方式
- **列表编辑**: 在列表中添加/删除/修改碰撞盒参数
- **3D预览**: 在预览窗口中可视化显示碰撞盒
- **与角色对齐**: 碰撞盒相对于角色模型的位置和大小
- **实时更新**: 修改参数时实时更新预览

### 4.4 技能成本配置

#### 功能描述
配置技能的实际消耗和冷却时间。

#### UI设计
```
┌─ 技能成本 ──────────────────────────┐
│                                      │
│  实际法力消耗:  [____20____]         │
│  (SkillTable中的DisplayCost仅用于UI展示) │
│                                      │
│  实际冷却时间:  [____300___] 帧      │
│  (约 5.0 秒)                         │
│  (SkillTable中的DisplayCooldown仅用于UI展示) │
│                                      │
└──────────────────────────────────────┘
```

#### 说明
- **ActualCost**: 技能实际消耗的法力值（运行时使用）
- **ActualCooldown**: 技能实际冷却帧数（60帧 = 1秒）
- **与展示值区分**: 展示值在 SkillTable 中配置，实际值在 SkillActionTable 中配置

---

## 时间轴扩展

### 5.1 新增轨道：技能效果轨道

#### 轨道配置
```csharp
TimelineTrackConfig
{
    TrackId = "SkillEffects",
    TrackName = "技能效果",
    TrackColor = Color.red,
    EventType = TimelineEventType.Instant,
    CanHaveMultipleEvents = true,
    AllowOverlap = true
}
```

#### 事件渲染
```csharp
SkillEffectEventRenderer
├── 绘制菱形标记（触发点）
├── 显示效果类型图标（⚔️伤害 / 💚治疗 / 💥击退）
├── 显示效果ID和数值
└── 悬停显示详细tooltip
```

#### 事件数据
```csharp
TimelineEvent (技能效果)
├── EventId (string) - "SkillEffect_{Frame}"
├── StartFrame (int) - 触发帧号
├── EventType (TimelineEventType.Instant)
└── EventData (Dictionary<string, object>)
    ├── Type (string) - "Collision"/"Direct"/"Condition"
    ├── HitBox (object) - { shape,size/radius,height,offset }
    ├── Condition (object) - { EnergyMin, RequiredTag }
    ├── EffectId (int) - 技能效果ID
    └── EffectData (SkillEffectTable) - 缓存的效果数据
```

### 5.2 事件交互增强

#### 右键菜单扩展
```
右键技能效果事件:
├── 编辑效果...
├── 更改触发类型
│   ├── Collision (碰撞触发)
│   ├── Direct (直接触发)
│   └── Condition (条件触发)
├── 查看效果详情...
├── 跳转到效果表...
├── 删除
└── 复制到剪贴板
```

#### 快捷键支持
- `Ctrl + E` - 编辑选中的技能效果
- `Ctrl + D` - 复制选中的技能效果
- `Delete` - 删除选中的技能效果
- `F` - 聚焦到选中的效果

---

## 数据结构

### 6.1 SkillActionEditorData

```csharp
/// <summary>
/// 技能动作编辑器数据 - 继承自 ActionEditorData
/// </summary>
public class SkillActionEditorData : ActionEditorData
{
    // ===== 继承自 ActionEditorData 的字段 =====
    // public int ActionId;
    // public string ActionName;
    // public List<CancelTag> CancelTags;
    // public List<BeCancelledTag> BeCancelledTags;
    // public List<ActionCommand> Commands;
    // ... 等所有动作字段
    
    // ===== 技能专属字段 =====
    
    [TitleGroup("技能信息")]
    [LabelText("所属技能ID"), ReadOnly]
    [InfoBox("关联到 SkillTable", InfoMessageType.Info)]
    public int SkillId;
    
    [TitleGroup("技能信息")]
    [LabelText("技能名称"), ReadOnly]
    [ShowInInspector]
    private string SkillName => GetSkillName(SkillId);
    
    [TitleGroup("技能成本")]
    [LabelText("实际法力消耗"), Range(0, 1000)]
    [InfoBox("运行时实际消耗的法力值", InfoMessageType.None)]
    public int ActualCost = 0;
    
    [TitleGroup("技能成本")]
    [LabelText("实际冷却时间(帧)"), Range(0, 1800)]
    [InfoBox("1秒 = 60帧，300帧 = 5秒", InfoMessageType.None)]
    public int ActualCooldown = 0;
    
    [TitleGroup("攻击碰撞盒")]
    [LabelText("碰撞盒信息")]
    [InfoBox("格式: Box1:5x2x1,Box2:3x3x1", InfoMessageType.None)]
    [OnValueChanged("OnAttackBoxInfoChanged")]
    public string AttackBoxInfo = "";
    
    [TitleGroup("技能效果")]
    [LabelText("触发帧效果列表")]
    [InfoBox("在时间轴上可视化编辑", InfoMessageType.Warning)]
    [TableList(ShowIndexLabels = true)]
    public List<TriggerFrameData> TriggerFrames = new List<TriggerFrameData>();
    
    // ===== 辅助方法 =====
    
    /// <summary>
    /// 从时间轴事件同步触发帧数据
    /// </summary>
    public void SyncFromTimelineEvents(List<TimelineEvent> skillEffectEvents)
    {
        TriggerFrames.Clear();
        foreach (var evt in skillEffectEvents)
        {
            TriggerFrames.Add(new TriggerFrameData
            {
                Frame = evt.StartFrame,
                Type = (string)evt.EventData["Type"],
                EffectId = (int)evt.EventData["EffectId"],
                HitBox = (HitBoxData)evt.EventData.GetValueOrDefault("HitBox"),
                Condition = (TriggerCondition)evt.EventData.GetValueOrDefault("Condition")
            });
        }
    }
    
    /// <summary>
    /// 转换为时间轴事件
    /// </summary>
    public List<TimelineEvent> ConvertToTimelineEvents()
    {
        var events = new List<TimelineEvent>();
        foreach (var trigger in TriggerFrames)
        {
            events.Add(new TimelineEvent
            {
                EventId = $"SkillEffect_{trigger.Frame}",
                TrackId = "SkillEffects",
                StartFrame = trigger.Frame,
                EventType = TimelineEventType.Instant,
                EventData = new Dictionary<string, object>
                {
                    ["Type"] = trigger.Type,
                    ["EffectId"] = trigger.EffectId,
                    ["HitBox"] = trigger.HitBox,
                    ["Condition"] = trigger.Condition
                }
            });
        }
        return events;
    }
}
```

### 6.2 TriggerFrameData

```csharp
/// <summary>
/// 触发帧数据（编辑器数据结构）
/// </summary>
[Serializable]
public class TriggerFrameData
{
    [TableColumnWidth(80, Resizable = false)]
    [LabelText("帧号")]
    public int Frame;
    
    [TableColumnWidth(100, Resizable = false)]
    [LabelText("触发类型")]
    [ValueDropdown("GetTriggerTypes")]
    public string Type = "Direct";
    
    [TableColumnWidth(80, Resizable = false)]
    [LabelText("效果ID")]
    [Button("选择")]
    public int EffectId;
    
    [TableColumnWidth(200)]
    [LabelText("效果预览")]
    [ReadOnly, ShowInInspector]
    private string EffectPreview => GetEffectPreview(EffectId);
    
    private static IEnumerable<string> GetTriggerTypes()
    {
        return new[] { "Collision", "Direct", "Condition" };
    }
    
    private string GetEffectPreview(int effectId)
    {
        // 从 SkillEffectTable 查询效果数据
        var effect = SkillConfigManager.Instance.GetSkillEffect(effectId);
        if (effect == null) return "未找到效果";
        
        return $"{GetEffectTypeName(effect.EffectType)} - {effect.EffectValue}";
    }
}
```

---

## UI/UX设计

### 7.1 窗口布局

```
┌────────────────────────────────────────────────────────────────┐
│  技能动作编辑器                     [最小化] [最大化] [关闭]  │
├─────────────┬──────────────────────────┬────────────────────────┤
│             │                          │                        │
│  技能动作   │      3D 动画预览         │   技能动作配置         │
│  列表       │                          │                        │
│             │                          │  - 基础信息            │
│ [新建]      │    [模型和动画展示]      │  - 技能信息            │
│ [复制]      │                          │  - 技能成本            │
│ [删除]      │                          │  - 取消标签            │
│             │                          │  - 碰撞盒配置          │
│ SkillAction1│                          │  - 命令绑定            │
│ SkillAction2│                          │                        │
│ SkillAction3│                          │                        │
│ ...         │                          │                        │
│             │                          │                        │
├─────────────┴──────────────────────────┴────────────────────────┤
│                     通用时间轴系统                               │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 被取消标签 │ ===■===  ===■===                          │  │
│  │ 技能效果   │  ◆(Direct)  ◆(Collision) ◆(Direct)       │  │ ← 新增
│  │ 特效       │                                            │  │
│  │ 音效       │                                            │  │
│  │ 相机震动   │                                            │  │
│  └──────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────┘
```

### 7.2 关键差异对比

#### 动作编辑器 vs 技能动作编辑器

| 功能模块 | 动作编辑器 | 技能动作编辑器 |
|---------|-----------|---------------|
| 动作列表 | ✅ ActionTable | ✅ SkillActionTable |
| 基础配置 | ✅ 取消标签、命令 | ✅ 继承 + 技能信息 |
| 时间轴轨道 | ✅ 4种轨道 | ✅ 5种轨道（新增技能效果） |
| 动画预览 | ✅ 3D预览 | ✅ 完全相同 |
| 成本配置 | ❌ 无 | ✅ ActualCost/Cooldown |
| 碰撞盒编辑 | ❌ 无 | ✅ AttackBoxInfo |
| 效果关联 | ❌ 无 | ✅ SkillEffectTable |
| 技能关联 | ❌ 无 | ✅ SkillTable |

### 7.3 配置面板布局

```
┌─ 技能动作配置 ─────────────────────────┐
│                                         │
│  [基础信息] ▼                           │
│  ┌───────────────────────────────────┐ │
│  │ 动作ID: 3001      (只读)          │ │
│  │ 动作名称: [Knight_Skill1_Dash]   │ │
│  │ 动作时长: [____30____] 帧         │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [技能信息] ▼                           │
│  ┌───────────────────────────────────┐ │
│  │ 所属技能ID: 2001  (只读)          │ │
│  │ 技能名称: 冲刺斩  (只读)          │ │
│  │ [跳转到技能编辑器]                │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [技能成本] ▼                           │
│  ┌───────────────────────────────────┐ │
│  │ 实际法力消耗: [____20____]        │ │
│  │ 实际冷却时间: [____300___] 帧     │ │
│  │ (约 5.0 秒)                        │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [攻击碰撞盒] ▼                         │
│  ┌───────────────────────────────────┐ │
│  │ Box1: 5.0 x 2.0 x 1.0   [编辑]   │ │
│  │ Box2: 3.0 x 3.0 x 1.0   [删除]   │ │
│  │ [+ 添加新碰撞盒]                   │ │
│  │ [3D预览]                           │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [取消标签] ▼                           │
│  ┌───────────────────────────────────┐ │
│  │ (与动作编辑器相同)                 │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [命令绑定] ▼                           │
│  ┌───────────────────────────────────┐ │
│  │ (与动作编辑器相同)                 │ │
│  └───────────────────────────────────┘ │
│                                         │
└─────────────────────────────────────────┘
```

---

## 技术实现

### 8.1 继承架构

```csharp
// 窗口继承
SkillActionEditorWindow : ActionEditorWindow
{
    // 重写数据加载
    protected override LoadData() { /* 加载 SkillActionTable */ }
    
    // 重写保存
    protected override SaveData() { /* 保存 SkillActionTable */ }
    
    // 新增技能效果模块
    private SkillEffectModule _skillEffectModule;
}

// 模块继承
SkillActionListModule : ActionListModule
{
    // 重写列表项渲染
    protected override DrawListItem() { /* 显示技能ID */ }
}

SkillActionConfigModule : ActionConfigModule
{
    // 扩展配置面板
    protected override DrawConfig() 
    { 
        base.DrawConfig();  // 先绘制基类内容
        DrawSkillInfo();     // 再绘制技能信息
        DrawSkillCost();     // 技能成本
        DrawAttackBoxes();   // 碰撞盒
    }
}

// 数据继承
SkillActionEditorData : ActionEditorData
{
    // 新增技能专属字段
    public int SkillId;
    public int ActualCost;
    public int ActualCooldown;
    public string AttackBoxInfo;
    public List<TriggerFrameData> TriggerFrames;
}
```

### 8.2 时间轴扩展

```csharp
// 注册技能效果轨道
TimelineTrackRegistry.RegisterTrack(new TimelineTrackConfig
{
    TrackId = "SkillEffects",
    TrackName = "技能效果",
    TrackColor = new Color(1f, 0.3f, 0.3f),
    EventType = TimelineEventType.Instant,
    CanHaveMultipleEvents = true,
    AllowOverlap = true,
    EventRenderer = new SkillEffectEventRenderer()
});

// 技能效果事件渲染器
class SkillEffectEventRenderer : ITimelineEventRenderer
{
    public void DrawEvent(Rect rect, TimelineEvent evt)
    {
        // 绘制菱形标记
        DrawDiamond(rect);
        
        // 根据触发类型显示不同图标
        string icon = GetTriggerIcon(evt.EventData["Type"]);
        GUI.Label(rect, icon);
        
        // 显示效果ID
        int effectId = (int)evt.EventData["EffectId"];
        GUI.Label(rect, $"E{effectId}", SmallLabelStyle);
    }
    
    public void DrawTooltip(TimelineEvent evt)
    {
        int effectId = (int)evt.EventData["EffectId"];
        var effect = SkillConfigManager.Instance.GetSkillEffect(effectId);
        
        GUILayout.Label($"技能效果 {effectId}");
        GUILayout.Label($"类型: {effect.EffectType}");
        GUILayout.Label($"数值: {effect.EffectValue}");
        GUILayout.Label($"范围: {effect.EffectRange}");
    }
}
```

### 8.3 数据持久化

```csharp
// 读取器扩展
class SkillActionDataReader : ActionDataReader
{
    public override SkillActionEditorData ReadFromCSV(int actionId)
    {
        // 1. 先调用基类读取 ActionTable
        var baseData = base.ReadFromCSV(actionId);
        
        // 2. 读取 SkillActionTable
        var skillActionRow = SkillActionTable.Get(actionId);
        
        // 3. 组合成 SkillActionEditorData
        var skillActionData = CreateInstance<SkillActionEditorData>();
        CopyBaseData(baseData, skillActionData);
        
        skillActionData.SkillId = skillActionRow.SkillId;
        skillActionData.ActualCost = skillActionRow.ActualCost;
        skillActionData.ActualCooldown = skillActionRow.ActualCooldown;
        skillActionData.AttackBoxInfo = skillActionRow.AttackBoxInfo;
        skillActionData.TriggerFrames = ParseTriggerFrames(skillActionRow.TriggerFrames);
        
        return skillActionData;
    }
}

// 写入器扩展
class SkillActionDataWriter : ActionDataWriter
{
    public override void WriteToCSV(SkillActionEditorData data)
    {
        // 1. 先调用基类写入 ActionTable
        base.WriteToCSV(data);
        
        // 2. 写入 SkillActionTable
        var skillActionRow = new SkillActionTableData
        {
            ActionId = data.ActionId,
            SkillId = data.SkillId,
            ActualCost = data.ActualCost,
            ActualCooldown = data.ActualCooldown,
            AttackBoxInfo = data.AttackBoxInfo,
            TriggerFrames = SerializeTriggerFrames(data.TriggerFrames)
        };
        
        SkillActionTableWriter.Write(skillActionRow);
    }
}
```

---

## 开发优先级

### Phase 1: 基础继承 (1-2天)

**目标**: 搭建技能动作编辑器的基本框架

- ✅ 创建 SkillActionEditorWindow（继承 ActionEditorWindow）
- ✅ 创建 SkillActionEditorData（继承 ActionEditorData）
- ✅ 创建 SkillActionListModule（继承 ActionListModule）
- ✅ 创建 SkillActionConfigModule（继承 ActionConfigModule）
- ✅ 实现基本的窗口打开和数据加载
- ✅ 验证动作编辑器的所有功能正常工作

### Phase 2: 技能专属字段 (2-3天)

**目标**: 实现技能专属的数据编辑

- ✅ 在配置面板添加"技能信息"区域
  - 显示所属技能ID
  - 显示技能名称（从 SkillTable 查询）
  - 添加"跳转到技能编辑器"按钮
- ✅ 实现"技能成本"配置
  - ActualCost 输入框
  - ActualCooldown 输入框（带秒数换算提示）
- ✅ 实现"攻击碰撞盒"简单编辑
  - 字符串格式的文本框
  - 格式验证和提示
- ✅ 实现数据的读写
  - SkillActionDataReader
  - SkillActionDataWriter

### Phase 3: 技能效果轨道 (3-4天)

**目标**: 在时间轴上可视化技能效果触发

- ✅ 注册"技能效果"轨道
- ✅ 实现 SkillEffectEventRenderer
  - 绘制菱形标记
  - 显示触发类型图标
  - 显示效果ID
- ✅ 实现触发帧事件的交互
  - 添加：右键菜单 → 添加技能效果
  - 编辑：双击打开效果选择器
  - 删除：Delete键或右键菜单
  - 拖动：调整触发帧位置
- ✅ 实现技能效果选择器
  - 效果列表展示
  - 搜索过滤
  - 详细信息预览
- ✅ 数据同步
  - TriggerFrames ↔ TimelineEvents 双向同步

### Phase 4: 碰撞盒可视化 (2-3天，可选)

**目标**: 提供碰撞盒的可视化编辑和预览

- ✅ 实现碰撞盒编辑面板
  - 列表添加/删除碰撞盒
  - 参数编辑（长宽高）
- ✅ 实现碰撞盒3D预览
  - 在角色模型上绘制碰撞盒
  - 支持选中和高亮
- ✅ 实现碰撞盒轨道（可选）
  - 在时间轴上显示碰撞盒激活的时间段

### Phase 5: 效果关联增强 (1-2天)

**目标**: 增强与 SkillEffectTable 的集成

- ✅ 在技能效果事件上悬停显示详细tooltip
  - 效果类型、数值、范围
  - 视觉效果ID、音效ID
- ✅ 实现"跳转到效果表"功能
- ✅ 实现效果数据缓存（性能优化）
- ✅ 支持效果的快速创建（如果不存在）

---

## 后续规划

### 10.1 Phase 6: 高级功能 (未来)

- **技能连招预览** - 查看技能包含的所有动作的连续预览
- **技能树可视化** - 展示技能的分支和变种
- **批量编辑** - 批量修改多个技能动作的属性
- **模板系统** - 保存常用的技能动作配置为模板

### 10.2 与其他系统集成

- **与技能编辑器联动** - 在技能编辑器中可以快速跳转到技能动作编辑器
- **与战斗编辑器集成** - 实时测试技能效果和战斗表现
- **与特效编辑器集成** - 配置技能效果时可预览对应的视觉特效

### 10.3 性能优化

- **延迟加载** - 大量技能动作时分页加载
- **数据缓存** - 缓存 SkillEffectTable 数据
- **增量保存** - 只保存修改的字段

---

## 附录

### A. 触发类型说明

| 触发类型 | 英文 | 描述 | 使用场景 |
|---------|------|------|---------|
| 碰撞触发 | Collision | 当攻击碰撞盒与敌人碰撞时触发 | 近战攻击、冲刺技能 |
| 直接触发 | Direct | 到达指定帧时直接触发 | 远程攻击、buff技能 |
| 条件触发 | Condition | 满足特定条件时触发 | 连击加成、暴击效果 |

### B. 效果类型说明

| 效果类型ID | 名称 | 描述 |
|-----------|------|------|
| 1 | 伤害 | 造成伤害 |
| 2 | 治疗 | 恢复生命值 |
| 3 | 击退 | 击退目标 |
| 4 | Buff | 增益效果 |
| 5 | Debuff | 减益效果 |

### C. 数据流程图

```
技能动作编辑器数据流

1. 加载数据:
   ActionTable.csv ──┐
                     ├──> SkillActionEditorData (合并)
   SkillActionTable.csv ┘

2. 编辑:
   SkillActionEditorData ──> 时间轴事件 (TriggerFrames → TimelineEvents)

3. 保存:
   SkillActionEditorData ──┐
                           ├──> ActionTable.csv
   TimelineEvents ─────────┤
                           └──> SkillActionTable.csv
```

---

**文档版本**: v1.0  
**维护者**: Astrum Team  
**创建日期**: 2025-10-09

© Astrum Skill Action Editor Design Document


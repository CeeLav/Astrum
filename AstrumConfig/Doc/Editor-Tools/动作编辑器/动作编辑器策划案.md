# åŠ¨ä½œç¼–è¾‘å™¨ç­–åˆ’æ¡ˆ

**ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-09  
**æœ€åæ›´æ–°**: 2025-10-09  
**çŠ¶æ€**: Phase 2 å®Œæˆ - æ ¸å¿ƒåŠŸèƒ½å·²å®ç°  

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [æ ¸å¿ƒè®¾è®¡ç†å¿µ](#æ ¸å¿ƒè®¾è®¡ç†å¿µ)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [åŠŸèƒ½æ¨¡å—](#åŠŸèƒ½æ¨¡å—)
5. [é€šç”¨æ—¶é—´è½´ç³»ç»Ÿ](#é€šç”¨æ—¶é—´è½´ç³»ç»Ÿ)
6. [æ•°æ®æµè®¾è®¡](#æ•°æ®æµè®¾è®¡)
7. [UI/UXè®¾è®¡](#uiuxè®¾è®¡)
8. [æŠ€æœ¯å®ç°](#æŠ€æœ¯å®ç°)
9. [æ‰©å±•æ€§è®¾è®¡](#æ‰©å±•æ€§è®¾è®¡)
10. [åç»­è§„åˆ’](#åç»­è§„åˆ’)

---

## æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

åŠ¨ä½œç¼–è¾‘å™¨æ˜¯ Astrum é¡¹ç›®ä¸­ç”¨äºé…ç½®è§’è‰²åŠ¨ä½œç³»ç»Ÿçš„æ ¸å¿ƒå·¥å…·ï¼Œè´Ÿè´£ç®¡ç† ActionTable é…ç½®è¡¨æ•°æ®ï¼Œæä¾›å¯è§†åŒ–çš„åŠ¨ä½œé…ç½®å’Œæ—¶é—´è½´äº‹ä»¶ç¼–è¾‘åŠŸèƒ½ã€‚

### 1.2 æ ¸å¿ƒç›®æ ‡

- **å¯è§†åŒ–ç¼–è¾‘** - æä¾›ç›´è§‚çš„æ—¶é—´è½´ç•Œé¢ï¼Œæ‰€è§å³æ‰€å¾—
- **æ•°æ®å®Œæ•´æ€§** - ä¿è¯é…ç½®æ•°æ®ä¸CSVè¡¨çš„å®Œå…¨åŒæ­¥
- **é«˜æ•ˆå·¥ä½œæµ** - å‡å°‘ç­–åˆ’é…ç½®åŠ¨ä½œçš„æ—¶é—´æˆæœ¬
- **å¯å¤ç”¨æ¶æ„** - æ—¶é—´è½´æ¨¡å—å¯å¤ç”¨äºæŠ€èƒ½ç¼–è¾‘å™¨ç­‰å…¶ä»–å·¥å…·

### 1.3 å…³é”®ç‰¹æ€§

- ğŸ“Š **å¤šè½¨é“æ—¶é—´è½´** - æ”¯æŒè¢«å–æ¶ˆæ ‡ç­¾ã€ç‰¹æ•ˆã€éŸ³æ•ˆã€ç›¸æœºéœ‡åŠ¨ç­‰å¤šç§äº‹ä»¶
- ğŸ¬ **åŠ¨ç”»é¢„è§ˆ** - å®æ—¶é¢„è§ˆåŠ¨ä½œåŠ¨ç”»ï¼Œä¸æ—¶é—´è½´åŒæ­¥
- ğŸ¯ **ç²¾ç¡®æ§åˆ¶** - é€å¸§ç¼–è¾‘ï¼Œæ”¯æŒæ‹–æ‹½ã€è°ƒæ•´åŒºé—´
- ğŸ’¾ **æ•°æ®æŒä¹…åŒ–** - ç›´æ¥è¯»å†™ ActionTable.csvï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
- ğŸ”§ **å¯æ‰©å±•æ€§** - è½¨é“ç±»å‹åŠ¨æ€æ³¨å†Œï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½

---

## æ ¸å¿ƒè®¾è®¡ç†å¿µ

### 2.1 é€šç”¨æ—¶é—´è½´ä¼˜å…ˆ

**è®¾è®¡åŸåˆ™**ï¼šæ—¶é—´è½´æ¨¡å—å®Œå…¨è§£è€¦ï¼Œä¸ä¾èµ–å…·ä½“ä¸šåŠ¡é€»è¾‘

```
é€šç”¨æ—¶é—´è½´æ¨¡å— (Timeline/)
    â”œâ”€â”€ å¯ç”¨äºåŠ¨ä½œç¼–è¾‘å™¨
    â”œâ”€â”€ å¯ç”¨äºæŠ€èƒ½ç¼–è¾‘å™¨
    â”œâ”€â”€ å¯ç”¨äºå‰§æƒ…ç¼–è¾‘å™¨
    â””â”€â”€ å¯ç”¨äºä»»ä½•éœ€è¦æ—¶é—´è½´çš„ç¼–è¾‘å™¨
```

**ä¼˜åŠ¿**ï¼š
- ä¸€æ¬¡å¼€å‘ï¼Œå¤šå¤„å¤ç”¨
- é™ä½ç»´æŠ¤æˆæœ¬
- ç»Ÿä¸€ç”¨æˆ·ä½“éªŒ

### 2.2 æ•°æ®é©±åŠ¨

**æ ¸å¿ƒåŸåˆ™**ï¼šæ‰€æœ‰é…ç½®é€šè¿‡æ•°æ®é©±åŠ¨ï¼Œé¿å…ç¡¬ç¼–ç 

```
è½¨é“ç±»å‹åŠ¨æ€æ³¨å†Œ
    â†“
TimelineTrackRegistry
    â†“
è¿è¡Œæ—¶é…ç½®è½¨é“è¡Œä¸º
```

**ä¼˜åŠ¿**ï¼š
- æ˜“äºæ·»åŠ æ–°è½¨é“ç±»å‹
- æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç 
- æ”¯æŒæ’ä»¶åŒ–æ‰©å±•

### 2.3 å•ä¸€èŒè´£

**æ¶æ„åˆ†å±‚**ï¼š
```
Windows/     - çª—å£ç®¡ç†ï¼ˆUIå®¹å™¨ï¼‰
Modules/     - åŠŸèƒ½æ¨¡å—ï¼ˆåˆ—è¡¨ã€é…ç½®ã€é¢„è§ˆã€æ—¶é—´è½´ï¼‰
Layout/      - å¸ƒå±€è®¡ç®—ï¼ˆåŒºåŸŸåˆ’åˆ†ï¼‰
Data/        - æ•°æ®æ¨¡å‹ï¼ˆä¸šåŠ¡å¯¹è±¡ï¼‰
Persistence/ - æ•°æ®æŒä¹…åŒ–ï¼ˆCSVè¯»å†™ï¼‰
Timeline/    - é€šç”¨æ—¶é—´è½´ï¼ˆæ ¸å¿ƒå¼•æ“ï¼‰
```

æ¯ä¸ªç±»èŒè´£æ˜ç¡®ï¼Œæ§åˆ¶åœ¨ 300 è¡Œä»¥å†…ã€‚

### 2.4 äº‹ä»¶é©±åŠ¨

**äº¤äº’æ¨¡å¼**ï¼šæ¨¡å—é—´é€šè¿‡äº‹ä»¶é€šä¿¡ï¼Œé™ä½è€¦åˆ

```csharp
// å‘å¸ƒäº‹ä»¶
_listModule.OnActionSelected += OnActionSelected;

// è®¢é˜…äº‹ä»¶
private void OnActionSelected(ActionEditorData action)
{
    _configModule.SetAction(action);
    _timelineModule.SetEvents(action.TimelineEvents);
}
```

---

## æ¶æ„è®¾è®¡

### 3.1 æ€»ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ActionEditorWindow                         â”‚
â”‚                     (ä¸»çª—å£æ§åˆ¶å™¨)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚                             â”‚                â”‚
â”‚  åˆ—è¡¨æ¨¡å—     â”‚      é…ç½®æ¨¡å—                â”‚   é¢„è§ˆæ¨¡å—      â”‚
â”‚              â”‚                             â”‚                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ActionListâ”‚ â”‚ â”‚  ActionConfigModule     â”‚ â”‚ â”‚ Animation  â”‚ â”‚
â”‚ â”‚Module    â”‚ â”‚ â”‚                         â”‚ â”‚ â”‚ Preview    â”‚ â”‚
â”‚ â”‚          â”‚ â”‚ â”‚  - åŸºç¡€é…ç½®(Odin)        â”‚ â”‚ â”‚ Module     â”‚ â”‚
â”‚ â”‚ - æœç´¢   â”‚ â”‚ â”‚  - å–æ¶ˆæ ‡ç­¾ç»Ÿè®¡          â”‚ â”‚ â”‚            â”‚ â”‚
â”‚ â”‚ - ç­›é€‰   â”‚ â”‚ â”‚  - äº‹ä»¶ç»Ÿè®¡             â”‚ â”‚ â”‚ - æ¨¡å‹é¢„è§ˆ  â”‚ â”‚
â”‚ â”‚ - CRUD   â”‚ â”‚ â”‚  - äº‹ä»¶è¯¦æƒ…ç¼–è¾‘          â”‚ â”‚ â”‚ - æ’­æ”¾æ§åˆ¶  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â”‚                             â”‚                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚                   TimelineEditorModule                       â”‚
â”‚                     (é€šç”¨æ—¶é—´è½´æ¨¡å—)                          â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TimelineRenderer    TimelineInteraction             â”‚  â”‚
â”‚  â”‚  (æ¸²æŸ“å™¨)             (äº¤äº’å¤„ç†)                      â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  TimelineLayoutCalculator                            â”‚  â”‚
â”‚  â”‚  (å¸ƒå±€è®¡ç®—)                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TimelineTrackRegistry (è½¨é“æ³¨å†Œè¡¨)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ ğŸš« BeCancelTag Track                            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ âœ¨ VFX Track                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ ğŸ”Š SFX Track                                    â”‚  â”‚
â”‚  â”‚  â””â”€â”€ ğŸ“· CameraShake Track                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ¨¡å—ä¾èµ–å…³ç³»

```
ActionEditorWindow (ä¸»çª—å£)
    â”‚
    â”œâ”€â”€> ActionListModule (åŠ¨ä½œåˆ—è¡¨)
    â”‚       â””â”€â”€> ActionEditorData (æ•°æ®æ¨¡å‹)
    â”‚
    â”œâ”€â”€> ActionConfigModule (é…ç½®é¢æ¿)
    â”‚       â”œâ”€â”€> PropertyTree (Odin Inspector)
    â”‚       â””â”€â”€> TimelineTrackRegistry (è·å–äº‹ä»¶ç¼–è¾‘å™¨)
    â”‚
    â”œâ”€â”€> AnimationPreviewModule (åŠ¨ç”»é¢„è§ˆ)
    â”‚       â””â”€â”€> BasePreviewModule (åŸºç±»)
    â”‚
    â”œâ”€â”€> TimelineEditorModule (æ—¶é—´è½´)
    â”‚       â”œâ”€â”€> TimelineRenderer (æ¸²æŸ“)
    â”‚       â”œâ”€â”€> TimelineInteraction (äº¤äº’)
    â”‚       â”œâ”€â”€> TimelineLayoutCalculator (å¸ƒå±€)
    â”‚       â””â”€â”€> TimelineTrackRegistry (è½¨é“æ³¨å†Œè¡¨)
    â”‚
    â””â”€â”€> ActionEditorLayout (å¸ƒå±€ç®¡ç†)
```

### 3.3 æ•°æ®æ¨¡å‹å±‚æ¬¡

```
ActionTable.csv (CSVé…ç½®æ–‡ä»¶)
    â†“ ActionDataReader
ActionTableData (CSVæ˜ å°„ç±»)
    â†“ ConvertToEditorData
ActionEditorData (ç¼–è¾‘å™¨æ•°æ®æ¨¡å‹)
    â”œâ”€â”€ åŸºç¡€å­—æ®µ (ActionId, ActionName, Duration...)
    â”œâ”€â”€ CancelTags (ä¸»åŠ¨å–æ¶ˆæ ‡ç­¾ - åªè¯»)
    â””â”€â”€ TimelineEvents (æ—¶é—´è½´äº‹ä»¶åˆ—è¡¨)
            â”œâ”€â”€ BeCancelTag äº‹ä»¶
            â”œâ”€â”€ VFX äº‹ä»¶
            â”œâ”€â”€ SFX äº‹ä»¶
            â””â”€â”€ CameraShake äº‹ä»¶
```

---

## åŠŸèƒ½æ¨¡å—

### 4.1 åŠ¨ä½œåˆ—è¡¨æ¨¡å— (ActionListModule)

**èŒè´£**ï¼šåŠ¨ä½œçš„æµè§ˆã€æœç´¢ã€ç­›é€‰å’ŒCRUDæ“ä½œ

**åŠŸèƒ½æ¸…å•**ï¼š
- âœ… åŠ¨ä½œåˆ—è¡¨æ˜¾ç¤ºï¼ˆå¡ç‰‡å¼ï¼‰
- âœ… æœç´¢ï¼ˆæŒ‰IDæˆ–åç§°ï¼‰
- âœ… ç­›é€‰ï¼ˆæŒ‰ç±»å‹ï¼šidle/walk/skillç­‰ï¼‰
- âœ… é€‰ä¸­é«˜äº®
- âœ… åˆ›å»ºæ–°åŠ¨ä½œ
- âœ… å¤åˆ¶åŠ¨ä½œ
- âœ… åˆ é™¤åŠ¨ä½œï¼ˆå¸¦ç¡®è®¤ï¼‰

**äº¤äº’äº‹ä»¶**ï¼š
```csharp
public event Action<ActionEditorData> OnActionSelected;
public event Action OnCreateNew;
public event Action<ActionEditorData> OnDuplicate;
public event Action<ActionEditorData> OnDelete;
```

### 4.2 é…ç½®é¢æ¿æ¨¡å— (ActionConfigModule)

**èŒè´£**ï¼šåŠ¨ä½œåŸºç¡€é…ç½®å’Œäº‹ä»¶è¯¦æƒ…ç¼–è¾‘

**åŠŸèƒ½åŒºåŸŸ**ï¼š

#### 4.2.1 å®ä½“é€‰æ‹©åŒº
- é€‰æ‹©é¢„è§ˆç”¨çš„å®ä½“æ¨¡å‹
- è‡ªåŠ¨åŠ è½½å®ä½“çš„æ¨¡å‹å’ŒåŠ¨ç”»

#### 4.2.2 åŸºç¡€é…ç½®åŒºï¼ˆOdin Inspectorï¼‰
- åŠ¨ä½œIDï¼ˆåªè¯»ï¼‰
- åŠ¨ä½œåç§°
- åŠ¨ä½œç±»å‹ï¼ˆä¸‹æ‹‰é€‰æ‹©ï¼‰
- åŠ¨ç”»è·¯å¾„ï¼ˆæ–‡ä»¶é€‰æ‹©å™¨ï¼‰
- åŠ¨ç”»/åŠ¨ä½œæ€»å¸§æ•°
- ä¼˜å…ˆçº§
- è‡ªåŠ¨ä¸‹ä¸€åŠ¨ä½œID
- ä¿æŒæ’­æ”¾åŠ¨ç”»
- è‡ªåŠ¨ç»ˆæ­¢
- å‘½ä»¤

#### 4.2.3 å–æ¶ˆæ ‡ç­¾é…ç½®åŒº
- CancelTagsï¼ˆåªè¯»ï¼ŒJSONæ˜¾ç¤ºï¼‰
- BeCancelledTags ç»Ÿè®¡
- è·³è½¬åˆ°æ—¶é—´è½´æŒ‰é’®

#### 4.2.4 äº‹ä»¶ç»Ÿè®¡åŒº
- å„ç±»å‹äº‹ä»¶è®¡æ•°
- è·³è½¬åˆ°æ—¶é—´è½´æŒ‰é’®

#### 4.2.5 äº‹ä»¶è¯¦æƒ…ç¼–è¾‘åŒº â­
- æ˜¾ç¤ºé€‰ä¸­äº‹ä»¶ä¿¡æ¯
- åŠ¨æ€è°ƒç”¨å¯¹åº”è½¨é“çš„ç¼–è¾‘å™¨
- å®æ—¶æ›´æ–°äº‹ä»¶å±æ€§

### 4.3 åŠ¨ç”»é¢„è§ˆæ¨¡å— (AnimationPreviewModule)

**èŒè´£**ï¼š3Dæ¨¡å‹å’ŒåŠ¨ç”»çš„å®æ—¶é¢„è§ˆ

**åŠŸèƒ½æ¸…å•**ï¼š
- âœ… åŠ è½½å®ä½“æ¨¡å‹
- âœ… æ’­æ”¾åŠ¨ä½œåŠ¨ç”»
- âœ… é€å¸§æ§åˆ¶ï¼ˆå‰è¿›/åé€€ï¼‰
- âœ… æ’­æ”¾/æš‚åœ/åœæ­¢
- âœ… ä¸æ—¶é—´è½´åŒå‘åŒæ­¥
- âœ… ç›¸æœºè½¨é“çƒæ§åˆ¶

**å¸§ç‡é…ç½®**ï¼š
- æ¸¸æˆé€»è¾‘å¸§ç‡ï¼š20fps
- æ¯å¸§æ—¶é—´ï¼š50ms (0.05ç§’)

### 4.4 æ—¶é—´è½´æ¨¡å— (TimelineEditorModule)

è¯¦è§ [é€šç”¨æ—¶é—´è½´ç³»ç»Ÿ](#é€šç”¨æ—¶é—´è½´ç³»ç»Ÿ)

---

## é€šç”¨æ—¶é—´è½´ç³»ç»Ÿ

### 5.1 è®¾è®¡ç›®æ ‡

**æ ¸å¿ƒåŸåˆ™**ï¼šæ„å»ºä¸€ä¸ªå®Œå…¨è§£è€¦çš„ã€å¯å¤ç”¨çš„æ—¶é—´è½´ç¼–è¾‘å™¨å¼•æ“

```
ä»»ä½•ç¼–è¾‘å™¨åªéœ€ï¼š
1. åˆå§‹åŒ– TimelineEditorModule
2. æ³¨å†Œè½¨é“ç±»å‹
3. ä¼ å…¥äº‹ä»¶æ•°æ®
4. ç›‘å¬å›è°ƒäº‹ä»¶
```

### 5.2 æ ¸å¿ƒç»„ä»¶

#### 5.2.1 TimelineEditorModule (ä¸»æ§åˆ¶å™¨)

**èŒè´£**ï¼šæ•´åˆæ‰€æœ‰å­æ¨¡å—ï¼Œæä¾›ç»Ÿä¸€API

```csharp
public class TimelineEditorModule
{
    // å­æ¨¡å—
    private TimelineLayoutCalculator _layoutCalculator;
    private TimelineRenderer _renderer;
    private TimelineInteraction _interaction;
    
    // æ ¸å¿ƒæ•°æ®
    private List<TimelineEvent> _events;
    private List<TimelineTrackConfig> _tracks;
    
    // å¯¹å¤–äº‹ä»¶
    public event Action<TimelineEvent> OnEventSelected;
    public event Action<TimelineEvent> OnEventAdded;
    public event Action<TimelineEvent> OnEventRemoved;
    public event Action<TimelineEvent> OnEventModified;
    public event Action<int> OnCurrentFrameChanged;
}
```

**æ ¸å¿ƒæ–¹æ³•**ï¼š
- `Initialize(totalFrames)` - åˆå§‹åŒ–
- `DrawTimeline(rect)` - ç»˜åˆ¶æ—¶é—´è½´
- `SetEvents(events)` - è®¾ç½®äº‹ä»¶åˆ—è¡¨
- `SetTracks(tracks)` - è®¾ç½®è½¨é“åˆ—è¡¨
- `AddEvent(evt)` - æ·»åŠ äº‹ä»¶
- `RemoveEvent(evt)` - ç§»é™¤äº‹ä»¶

#### 5.2.2 TimelineRenderer (æ¸²æŸ“å™¨)

**èŒè´£**ï¼šç»˜åˆ¶æ—¶é—´è½´çš„æ‰€æœ‰å¯è§†å…ƒç´ 

**ç»˜åˆ¶å†…å®¹**ï¼š
- å¸§åˆ»åº¦ï¼ˆä¸»åˆ»åº¦+æ¬¡åˆ»åº¦ï¼‰
- æ’­æ”¾å¤´ï¼ˆçº¢è‰²ç«–çº¿+ä¸‰è§’æ ‡è®°ï¼‰
- è½¨é“èƒŒæ™¯ï¼ˆäº¤æ›¿è‰²ï¼‰
- è½¨é“æ ‡é¢˜
- äº‹ä»¶çŸ©å½¢
- é€‰ä¸­/æ‚¬åœé«˜äº®

**é¢œè‰²é…ç½®**ï¼š
```csharp
private static readonly Color COLOR_PLAYHEAD = new Color(1f, 0.2f, 0.2f);
private static readonly Color COLOR_TRACK_BG_EVEN = new Color(0.25f, 0.25f, 0.25f);
private static readonly Color COLOR_TRACK_BG_ODD = new Color(0.22f, 0.22f, 0.22f);
```

#### 5.2.3 TimelineInteraction (äº¤äº’å¤„ç†å™¨)

**èŒè´£**ï¼šå¤„ç†æ‰€æœ‰ç”¨æˆ·è¾“å…¥å’Œäº¤äº’

**æ”¯æŒçš„äº¤äº’**ï¼š

| äº¤äº’ç±»å‹ | æ“ä½œ | è§¦å‘æ¡ä»¶ |
|---------|------|---------|
| **æ’­æ”¾å¤´æ‹–æ‹½** | å·¦é”®æ‹–æ‹½åˆ»åº¦å°º/æ’­æ”¾å¤´ | ç‚¹å‡»Â±5pxèŒƒå›´ |
| **äº‹ä»¶é€‰ä¸­** | å·¦é”®ç‚¹å‡»äº‹ä»¶ | ç‚¹å‡»äº‹ä»¶çŸ©å½¢ |
| **äº‹ä»¶ç§»åŠ¨** | æ‹–æ‹½äº‹ä»¶ä¸­å¿ƒ | æ‹–åŠ¨é€‰ä¸­äº‹ä»¶ |
| **è¾¹ç¼˜è°ƒæ•´** | æ‹–æ‹½äº‹ä»¶è¾¹ç¼˜ | ç‚¹å‡»Â±4pxè¾¹ç¼˜ |
| **å³é”®èœå•** | å³é”®ç‚¹å‡»è½¨é“ | æ˜¾ç¤ºä¸Šä¸‹æ–‡èœå• |
| **å¿«æ·é”®** | Delete/æ–¹å‘é”® | åˆ é™¤/åˆ‡æ¢å¸§ |

**ç¢°æ’æ£€æµ‹ç®—æ³•**ï¼š

```csharp
HitTestPlayhead(mousePos, rect)
    â†’ æ£€æµ‹é¼ æ ‡æ˜¯å¦åœ¨æ’­æ”¾å¤´Â±5pxèŒƒå›´

HitTestEvents(mousePos, rect, tracks, events)
    â†’ éå†æ‰€æœ‰è½¨é“å’Œäº‹ä»¶
    â†’ è®¡ç®—äº‹ä»¶çŸ©å½¢
    â†’ åˆ¤æ–­é¼ æ ‡æ˜¯å¦åœ¨çŸ©å½¢å†…
    â†’ æ£€æµ‹æ˜¯å¦åœ¨è¾¹ç¼˜Â±4px

HitTestTrack(mousePos, rect, tracks)
    â†’ ç´¯åŠ è½¨é“é«˜åº¦
    â†’ åˆ¤æ–­é¼ æ ‡Yåæ ‡æ‰€åœ¨è½¨é“
```

#### 5.2.4 TimelineLayoutCalculator (å¸ƒå±€è®¡ç®—å™¨)

**èŒè´£**ï¼šè®¡ç®—æ—¶é—´è½´å„åŒºåŸŸçš„ä½ç½®å’Œå¤§å°

**æ ¸å¿ƒå‚æ•°**ï¼š
```csharp
private const float TRACK_HEADER_WIDTH = 120f;    // è½¨é“æ ‡é¢˜å®½åº¦
private const float FRAME_SCALE_HEIGHT = 30f;     // å¸§åˆ»åº¦é«˜åº¦
private const float PLAYHEAD_HEIGHT = 20f;        // æ’­æ”¾å¤´é«˜åº¦
private const float MIN_PIXELS_PER_FRAME = 2f;    // æœ€å°ç¼©æ”¾
private const float MAX_PIXELS_PER_FRAME = 20f;   // æœ€å¤§ç¼©æ”¾
private const float DEFAULT_PIXELS_PER_FRAME = 5f; // é»˜è®¤ç¼©æ”¾
```

**åæ ‡è½¬æ¢**ï¼š
```csharp
PixelToFrame(pixelX) â†’ frameNumber
FrameToPixel(frameNumber) â†’ pixelX
```

**åŒºåŸŸè®¡ç®—**ï¼š
- `GetFrameScaleRect()` - å¸§åˆ»åº¦åŒºåŸŸ
- `GetPlayheadRect()` - æ’­æ”¾å¤´åŒºåŸŸ
- `GetTrackAreaRect()` - è½¨é“åŒºåŸŸ
- `GetEventRect(evt, trackRect)` - äº‹ä»¶çŸ©å½¢

### 5.3 æ—¶é—´è½´æ•°æ®ç»“æ„

#### 5.3.1 TimelineEvent (ç»Ÿä¸€äº‹ä»¶æ•°æ®)

```csharp
[Serializable]
public class TimelineEvent
{
    // åŸºç¡€ä¿¡æ¯
    public string EventId;         // å”¯ä¸€æ ‡è¯†ç¬¦
    public string TrackType;       // è½¨é“ç±»å‹
    public int StartFrame;         // èµ·å§‹å¸§
    public int EndFrame;           // ç»“æŸå¸§
    public string DisplayName;     // æ˜¾ç¤ºåç§°
    public string Note;            // å¤‡æ³¨
    
    // äº‹ä»¶æ•°æ®ï¼ˆJSONåºåˆ—åŒ–ï¼‰
    private string _eventData;
    
    // æ³›å‹è®¿é—®
    public T GetEventData<T>() where T : class;
    public void SetEventData<T>(T data) where T : class;
}
```

**ä¼˜åŠ¿**ï¼š
- ç»Ÿä¸€çš„äº‹ä»¶å®¹å™¨
- æ”¯æŒä»»æ„ç±»å‹çš„äº‹ä»¶æ•°æ®
- JSONåºåˆ—åŒ–ï¼Œæ˜“äºæ‰©å±•

#### 5.3.2 TimelineTrackConfig (è½¨é“é…ç½®)

```csharp
[Serializable]
public class TimelineTrackConfig
{
    // åŸºç¡€é…ç½®
    public string TrackType;       // è½¨é“ç±»å‹ï¼ˆå”¯ä¸€ï¼‰
    public string TrackName;       // æ˜¾ç¤ºåç§°
    public string TrackIcon;       // å›¾æ ‡ï¼ˆemojiï¼‰
    public Color TrackColor;       // ä¸»é¢˜è‰²
    public float TrackHeight;      // é«˜åº¦
    public bool IsVisible;         // æ˜¯å¦å¯è§
    public bool IsLocked;          // æ˜¯å¦é”å®š
    public int SortOrder;          // æ’åºé¡ºåº
    public bool AllowOverlap;      // å…è®¸äº‹ä»¶é‡å 
    
    // å§”æ‰˜
    public Action<Rect, TimelineEvent> EventRenderer;  // æ¸²æŸ“å™¨
    public Func<TimelineEvent, bool> EventEditor;      // ç¼–è¾‘å™¨
}
```

**åŠ¨æ€æ³¨å†Œ**ï¼š
```csharp
TimelineTrackRegistry.RegisterTrack(new TimelineTrackConfig
{
    TrackType = "BeCancelTag",
    TrackName = "è¢«å–æ¶ˆæ ‡ç­¾",
    TrackIcon = "ğŸš«",
    TrackColor = new Color(0.8f, 0.3f, 0.3f),
    EventRenderer = BeCancelTagTrackRenderer.RenderEvent,
    EventEditor = BeCancelTagTrackRenderer.EditEvent
});
```

### 5.4 è½¨é“ç±»å‹è¯¦è§£

#### 5.4.1 è¢«å–æ¶ˆæ ‡ç­¾è½¨é“ (BeCancelTag)

**ç”¨é€”**ï¼šå®šä¹‰åŠ¨ä½œå¯è¢«å…¶ä»–åŠ¨ä½œå–æ¶ˆçš„æ—¶é—´èŒƒå›´

**æ•°æ®ç»“æ„**ï¼š
```csharp
public class BeCancelTagEventData
{
    public List<string> Tags;       // è¢«å–æ¶ˆæ ‡ç­¾åˆ—è¡¨ ["move", "skill"]
    public int BlendOutFrames;      // èåˆæ—¶é—´ï¼ˆå¸§ï¼‰
    public int Priority;            // ä¼˜å…ˆçº§å˜åŒ–
    public string Note;             // å¤‡æ³¨
}
```

**CSVæ ¼å¼**ï¼š
```json
[
  {"tags":["move","skill","jump"],"rangeFrames":[0,60],"blendOutFrames":3,"priority":0}
]
```

**å¯è§†åŒ–**ï¼š
- çº¢è‰²åŒºé—´æ¡
- æ˜¾ç¤ºæ ‡ç­¾åç§°
- ä¸å…è®¸é‡å ï¼ˆAllowOverlap = falseï¼‰

#### 5.4.2 ç‰¹æ•ˆè½¨é“ (VFX)

**ç”¨é€”**ï¼šåœ¨åŠ¨ä½œè¿‡ç¨‹ä¸­æ’­æ”¾è§†è§‰ç‰¹æ•ˆ

**æ•°æ®ç»“æ„**ï¼š
```csharp
public class VFXEventData
{
    public string ResourcePath;     // ç‰¹æ•ˆèµ„æºè·¯å¾„
    public Vector3 PositionOffset;  // ä½ç½®åç§»
    public Vector3 Rotation;        // æ—‹è½¬
    public float Scale;             // ç¼©æ”¾
    public float PlaybackSpeed;     // æ’­æ”¾é€Ÿåº¦
    public bool FollowCharacter;    // æ˜¯å¦è·Ÿéšè§’è‰²
    public bool Loop;               // æ˜¯å¦å¾ªç¯
    public string Note;
}
```

**å¯è§†åŒ–**ï¼š
- ç´«è‰²åŒºé—´æ¡
- æ˜¾ç¤ºç‰¹æ•ˆæ–‡ä»¶å
- å…è®¸é‡å 

#### 5.4.3 éŸ³æ•ˆè½¨é“ (SFX)

**ç”¨é€”**ï¼šåœ¨åŠ¨ä½œè¿‡ç¨‹ä¸­æ’­æ”¾éŸ³æ•ˆ

**æ•°æ®ç»“æ„**ï¼š
```csharp
public class SFXEventData
{
    public string ResourcePath;     // éŸ³æ•ˆèµ„æºè·¯å¾„
    public float Volume;            // éŸ³é‡ (0-1)
    public float Pitch;             // éŸ³è°ƒ (0.5-2)
    public float SpatialBlend;      // ç©ºé—´æ··éŸ³ (0=2D, 1=3D)
    public bool Loop;               // æ˜¯å¦å¾ªç¯
    public bool FollowCharacter;    // æ˜¯å¦è·Ÿéšè§’è‰²
    public float MaxDistance;       // æœ€å¤§å¬è·
    public string Note;
}
```

**å¯è§†åŒ–**ï¼š
- æ©™è‰²åŒºé—´æ¡
- æ˜¾ç¤ºéŸ³æ•ˆæ–‡ä»¶å
- å…è®¸é‡å 

#### 5.4.4 ç›¸æœºéœ‡åŠ¨è½¨é“ (CameraShake)

**ç”¨é€”**ï¼šåœ¨åŠ¨ä½œè¿‡ç¨‹ä¸­è§¦å‘ç›¸æœºéœ‡åŠ¨

**æ•°æ®ç»“æ„**ï¼š
```csharp
public class CameraShakeEventData
{
    public float Intensity;         // éœ‡åŠ¨å¼ºåº¦ (0-1)
    public float Frequency;         // éœ‡åŠ¨é¢‘ç‡ (Hz)
    public Vector3 Direction;       // éœ‡åŠ¨æ–¹å‘
    public string FalloffCurve;     // è¡°å‡æ›²çº¿ï¼ˆé¢„ç•™ï¼‰
    public string Note;
}
```

**å¯è§†åŒ–**ï¼š
- ç°è‰²åŒºé—´æ¡
- æ˜¾ç¤ºéœ‡åŠ¨å¼ºåº¦
- å…è®¸é‡å 

---

## æ•°æ®æµè®¾è®¡

### 6.1 è¯»å–æµç¨‹

```
#ActionTable.csv
    â†“ LubanCSVReader.ReadTable<ActionTableData>()
ActionTableData (12ä¸ªå­—æ®µ)
    â†“ ActionDataReader.ConvertToEditorData()
ActionEditorData
    â”œâ”€â”€ åŸºç¡€å­—æ®µ (ç›´æ¥å¤åˆ¶)
    â”œâ”€â”€ CancelTags (é€ä¼ )
    â””â”€â”€ TimelineEvents
            â†“ ActionCancelTagParser.ParseBeCancelledTags()
        List<TimelineEvent> (å¸¦ BeCancelTagEventData)
```

**JSONè§£æç¤ºä¾‹**ï¼š
```csharp
// CSVä¸­çš„JSONå­—ç¬¦ä¸²
string json = "[{\"tags\":[\"move\",\"skill\"],\"rangeFrames\":[0,60],\"blendOutFrames\":3,\"priority\":0}]";

// è§£æ
var jsonDataList = JsonConvert.DeserializeObject<List<BeCancelledTagJsonData>>(json);

// è½¬æ¢ä¸º TimelineEvent
foreach (var jsonData in jsonDataList)
{
    var eventData = new BeCancelTagEventData
    {
        Tags = jsonData.Tags,
        BlendOutFrames = jsonData.BlendOutFrames,
        Priority = jsonData.Priority
    };
    
    var evt = new TimelineEvent
    {
        TrackType = "BeCancelTag",
        StartFrame = jsonData.RangeFrames[0],
        EndFrame = jsonData.RangeFrames[1]
    };
    evt.SetEventData(eventData);
}
```

### 6.2 ä¿å­˜æµç¨‹

```
ActionEditorData
    â†“ ActionDataWriter.ConvertToTableData()
ActionTableData
    â”œâ”€â”€ åŸºç¡€å­—æ®µ (ç›´æ¥å¤åˆ¶)
    â”œâ”€â”€ CancelTags (é€ä¼ )
    â””â”€â”€ BeCancelledTags
            â†“ ActionCancelTagSerializer.SerializeBeCancelledTags()
        JSONå­—ç¬¦ä¸² (ä» TimelineEvents æå– BeCancelTag ç±»å‹)
    â†“ LubanCSVWriter.WriteTable<ActionTableData>()
#ActionTable.csv (æ›´æ–°)
```

**åºåˆ—åŒ–ç¤ºä¾‹**ï¼š
```csharp
// ä» TimelineEvents ç­›é€‰ BeCancelTag äº‹ä»¶
var beCancelEvents = events.Where(e => e.TrackType == "BeCancelTag").ToList();

// åºåˆ—åŒ–ä¸ºJSON
foreach (var evt in beCancelEvents)
{
    var data = evt.GetEventData<BeCancelTagEventData>();
    
    string jsonObj = $"{{\"tags\":{SerializeArray(data.Tags)}," +
                     $"\"rangeFrames\":[{evt.StartFrame},{evt.EndFrame}]," +
                     $"\"blendOutFrames\":{data.BlendOutFrames}," +
                     $"\"priority\":{data.Priority}}}";
}

// è¾“å‡ºï¼š[{...}, {...}]
```

### 6.3 æ•°æ®ä¸€è‡´æ€§ä¿è¯

**å…³é”®ç­–ç•¥**ï¼š

1. **è¯»å–æ—¶**ï¼š
   - ä½¿ç”¨ `LubanCSVReader` ç¡®ä¿ä¸Lubanç”Ÿæˆä»£ç ä¸€è‡´
   - è§£æJSONæ—¶æ•è·å¼‚å¸¸ï¼Œé¿å…æ•°æ®ä¸¢å¤±
   - æ¸…é™¤ IsDirty æ ‡è®°

2. **ä¿å­˜æ—¶**ï¼š
   - åºåˆ—åŒ–å®Œæ•´æ•°æ®ï¼ˆåŒ…å«æ‰€æœ‰æ—¶é—´è½´äº‹ä»¶ï¼‰
   - ä¿æŒ CancelTags åŸå€¼ï¼ˆé€ä¼ ï¼‰
   - éªŒè¯æ•°æ®æ ¼å¼

3. **ä¿®æ”¹æ—¶**ï¼š
   - ä»»ä½•ä¿®æ”¹ç«‹å³æ ‡è®° `IsDirty = true`
   - çª—å£å…³é—­æ—¶æ£€æµ‹æœªä¿å­˜ä¿®æ”¹
   - æç¤ºç”¨æˆ·ä¿å­˜

---

## UI/UXè®¾è®¡

### 7.1 ç•Œé¢å¸ƒå±€

#### 7.1.1 æ•´ä½“å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å·¥å…·æ : [ä¿å­˜] [åˆ·æ–°] [éªŒè¯]     å½“å‰åŠ¨ä½œä¿¡æ¯        [å¸®åŠ©]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚              â”‚  â”‚  é…ç½®é¢æ¿ (340px)  â”‚  åŠ¨ç”»é¢„è§ˆ (å æ»¡)         â”‚ â”‚
â”‚  åŠ¨ä½œåˆ—è¡¨     â”‚  â”‚                   â”‚                         â”‚ â”‚
â”‚  (240px)     â”‚  â”‚  - å®ä½“é€‰æ‹©        â”‚  - 3Dæ¨¡å‹é¢„è§ˆ           â”‚ â”‚
â”‚              â”‚  â”‚  - åŸºç¡€é…ç½®        â”‚  - æ’­æ”¾æ§åˆ¶             â”‚ â”‚
â”‚  - æœç´¢æ¡†     â”‚  â”‚  - å–æ¶ˆæ ‡ç­¾        â”‚  - å¸§ä¿¡æ¯æ˜¾ç¤º           â”‚ â”‚
â”‚  - ç±»å‹ç­›é€‰   â”‚  â”‚  - äº‹ä»¶ç»Ÿè®¡        â”‚                         â”‚ â”‚
â”‚  - åŠ¨ä½œå¡ç‰‡   â”‚  â”‚  - äº‹ä»¶è¯¦æƒ…ç¼–è¾‘    â”‚                         â”‚ â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â”‚                                                   â”‚
â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚              â”‚  â”‚  å¤šè½¨é“æ—¶é—´è½´ (280pxé«˜)                      â”‚ â”‚
â”‚              â”‚  â”‚                                             â”‚ â”‚
â”‚              â”‚  â”‚  [å¸§åˆ»åº¦] 0   5   10   15   20 ...           â”‚ â”‚
â”‚              â”‚  â”‚  [æ’­æ”¾å¤´]   |                                â”‚ â”‚
â”‚              â”‚  â”‚                                             â”‚ â”‚
â”‚              â”‚  â”‚  ğŸš« è¢«å–æ¶ˆæ ‡ç­¾  [â–ˆâ–ˆâ–ˆâ–ˆåŒºé—´â–ˆâ–ˆâ–ˆâ–ˆ]               â”‚ â”‚
â”‚              â”‚  â”‚  âœ¨ ç‰¹æ•ˆ        [â–ˆâ–ˆ]    [â–ˆâ–ˆ]                â”‚ â”‚
â”‚              â”‚  â”‚  ğŸ”Š éŸ³æ•ˆ           [â–ˆâ–ˆ]                      â”‚ â”‚
â”‚              â”‚  â”‚  ğŸ“· ç›¸æœºéœ‡åŠ¨                [â–ˆâ–ˆ]             â”‚ â”‚
â”‚              â”‚  â”‚                                             â”‚ â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 7.1.2 å°ºå¯¸è§„èŒƒ

| åŒºåŸŸ | å°ºå¯¸ | å¯è°ƒæ•´ |
|------|------|--------|
| **æœ€å°çª—å£** | 1200x800 | âŒ |
| **åŠ¨ä½œåˆ—è¡¨** | 240pxå®½ | âŒ |
| **é…ç½®é¢æ¿** | 340pxå®½ | âŒ |
| **åŠ¨ç”»é¢„è§ˆ** | å æ»¡å‰©ä½™ | âœ… |
| **æ—¶é—´è½´** | 280pxé«˜ | âŒ |
| **å·¥å…·æ ** | 30pxé«˜ | âŒ |

### 7.2 äº¤äº’è®¾è®¡

#### 7.2.1 æ‹–æ‹½æ“ä½œ

**æ’­æ”¾å¤´æ‹–æ‹½**ï¼š
```
1. ç‚¹å‡»å¸§åˆ»åº¦å°º â†’ è·³è½¬åˆ°ç‚¹å‡»å¸§
2. æ‹–æ‹½åˆ»åº¦å°º â†’ æŒç»­æ›´æ–°å½“å‰å¸§
3. ç‚¹å‡»æ’­æ”¾å¤´çº¿ï¼ˆÂ±5pxï¼‰ â†’ å¼€å§‹æ‹–æ‹½
4. é‡Šæ”¾é¼ æ ‡ â†’ ç»“æŸæ‹–æ‹½
```

**äº‹ä»¶æ‹–æ‹½**ï¼š
```
1. ç‚¹å‡»äº‹ä»¶ä¸­å¿ƒ â†’ é€‰ä¸­äº‹ä»¶
2. æ‹–åŠ¨é¼ æ ‡ â†’ ç§»åŠ¨äº‹ä»¶ï¼ˆä¿æŒæŒç»­æ—¶é—´ï¼‰
3. è¾¹ç•Œçº¦æŸï¼šStartFrame >= 0
4. é‡Šæ”¾é¼ æ ‡ â†’ ç¡®è®¤ä½ç½®
```

**è¾¹ç¼˜è°ƒæ•´**ï¼š
```
1. ç‚¹å‡»äº‹ä»¶å·¦è¾¹ç¼˜ï¼ˆÂ±4pxï¼‰ â†’ å¼€å§‹è°ƒæ•´èµ·å§‹å¸§
2. ç‚¹å‡»äº‹ä»¶å³è¾¹ç¼˜ï¼ˆÂ±4pxï¼‰ â†’ å¼€å§‹è°ƒæ•´ç»“æŸå¸§
3. æ‹–åŠ¨é¼ æ ‡ â†’ å®æ—¶è°ƒæ•´
4. çº¦æŸï¼šStartFrame <= EndFrame
5. é‡Šæ”¾é¼ æ ‡ â†’ ç¡®è®¤è°ƒæ•´
```

#### 7.2.2 å³é”®èœå•

**è½¨é“åŒºåŸŸå³é”®**ï¼š
```
â”œâ”€â”€ åœ¨å¸§ X æ·»åŠ äº‹ä»¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€â”€ å¤åˆ¶äº‹ä»¶ (é€‰ä¸­æ—¶å¯ç”¨)
â”œâ”€â”€ ç²˜è´´äº‹ä»¶ (å‰ªè´´æ¿éç©ºæ—¶å¯ç”¨)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â””â”€â”€ åˆ é™¤äº‹ä»¶ (é€‰ä¸­æ—¶å¯ç”¨)
```

**èœå•é€»è¾‘**ï¼š
- è‡ªåŠ¨æ£€æµ‹ç‚¹å‡»çš„è½¨é“ç±»å‹
- æ·»åŠ äº‹ä»¶æ—¶åˆ›å»ºå¯¹åº”ç±»å‹çš„é»˜è®¤æ•°æ®
- ç²˜è´´æ—¶ä¿æŒå‰ªè´´æ¿äº‹ä»¶çš„æ•°æ®ï¼Œæ›´æ–°å¸§ä½ç½®

#### 7.2.3 å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| Delete | åˆ é™¤é€‰ä¸­äº‹ä»¶ï¼ˆå¸¦ç¡®è®¤å¯¹è¯æ¡†ï¼‰ |
| â† | ä¸Šä¸€å¸§ |
| â†’ | ä¸‹ä¸€å¸§ |
| Home | è·³è½¬åˆ°ç¬¬0å¸§ |
| Ctrl+C | å¤åˆ¶é€‰ä¸­äº‹ä»¶ï¼ˆé¢„ç•™ï¼‰ |
| Ctrl+V | ç²˜è´´äº‹ä»¶ï¼ˆé¢„ç•™ï¼‰ |

### 7.3 è§†è§‰åé¦ˆ

#### 7.3.1 é«˜äº®ç³»ç»Ÿ

**é€‰ä¸­é«˜äº®**ï¼ˆé‡‘è‰²ï¼‰ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚  â† 2pxé‡‘è‰²è¾¹æ¡†
â”‚ â–ˆ äº‹ä»¶ â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Color: (1f, 0.8f, 0f, 1f)
```

**æ‚¬åœé«˜äº®**ï¼ˆç™½è‰²ï¼‰ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚  â† 1pxåŠé€æ˜ç™½è¾¹æ¡†
â”‚ â–ˆ äº‹ä»¶ â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Color: (1f, 1f, 1f, 0.5f)
```

#### 7.3.2 æ’­æ”¾å¤´æ ·å¼

```
å¸§åˆ»åº¦åŒºåŸŸ:
    â†“ çº¢è‰²ä¸‰è§’æ ‡è®°
â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    | çº¢è‰²ç«–çº¿ï¼ˆè´¯ç©¿æ‰€æœ‰è½¨é“ï¼‰
```

---

## æŠ€æœ¯å®ç°

### 8.1 æ ¸å¿ƒæŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç”¨é€” | ç‰ˆæœ¬ |
|------|------|------|
| **Unity** | ç¼–è¾‘å™¨æ¡†æ¶ | 6000.0+ |
| **Odin Inspector** | å±æ€§é¢æ¿ | 3.3.1.13 |
| **Animancer** | åŠ¨ç”»é¢„è§ˆ | 8.2.2 |
| **Newtonsoft.Json** | JSONè§£æ | - |
| **CsvHelper** | CSVè¯»å†™ | - |
| **Luban** | é…ç½®è¡¨ç”Ÿæˆ | - |

### 8.2 ä¾èµ–å…³ç³»

```
åŠ¨ä½œç¼–è¾‘å™¨
    â”œâ”€â”€ Odin Inspector (é…ç½®é¢æ¿)
    â”œâ”€â”€ Animancer (åŠ¨ç”»é¢„è§ˆ)
    â”œâ”€â”€ Newtonsoft.Json (JSONè§£æ)
    â”œâ”€â”€ CsvHelper (CSVè¯»å†™)
    â””â”€â”€ ConfigTableHelper (é…ç½®è¡¨è¾…åŠ©ç±»)
```

### 8.3 ä»£ç ç»„ç»‡

#### 8.3.1 å‘½åç©ºé—´

```csharp
Astrum.Editor.RoleEditor.Windows      // çª—å£
Astrum.Editor.RoleEditor.Modules      // æ¨¡å—
Astrum.Editor.RoleEditor.Layout       // å¸ƒå±€
Astrum.Editor.RoleEditor.Data         // æ•°æ®
Astrum.Editor.RoleEditor.Persistence  // æŒä¹…åŒ–
Astrum.Editor.RoleEditor.Timeline     // æ—¶é—´è½´
    â”œâ”€â”€ .EventData                     // äº‹ä»¶æ•°æ®
    â””â”€â”€ .Renderers                     // æ¸²æŸ“å™¨
```

#### 8.3.2 æ–‡ä»¶å¤§å°æ§åˆ¶

**è®¾è®¡åŸåˆ™**ï¼šå•ä¸ªç±»æ§åˆ¶åœ¨ 300 è¡Œä»¥å†…

**å®é™…ç»Ÿè®¡**ï¼š
```
æœ€å¤§æ–‡ä»¶: TimelineRenderer.cs (~300è¡Œ)
æœ€å°æ–‡ä»¶: TimelineTrackConfig.cs (~120è¡Œ)
å¹³å‡å¤§å°: ~180è¡Œ
```

æ‰€æœ‰ç±»éƒ½ç¬¦åˆè§„èŒƒ âœ…

### 8.4 æ€§èƒ½ä¼˜åŒ–

#### 8.4.1 å¸ƒå±€ç¼“å­˜

```csharp
// é¿å…æ¯å¸§é‡æ–°è®¡ç®—
private Rect _frameScaleRect;
private Rect _playheadRect;
private Rect _trackAreaRect;

// åªåœ¨å¸ƒå±€å˜åŒ–æ—¶é‡æ–°è®¡ç®—
public void CalculateLayout(Rect totalRect, int totalFrames, int trackCount)
{
    _frameScaleRect = ...;
    _playheadRect = ...;
    _trackAreaRect = ...;
}
```

#### 8.4.2 äº‹ä»¶åˆ†ç»„

```csharp
// æŒ‰è½¨é“ç±»å‹åˆ†ç»„ï¼Œé¿å…çº¿æ€§æŸ¥æ‰¾
private Dictionary<string, List<TimelineEvent>> _eventsByTrack;

// æ¯æ¬¡æ•°æ®å˜åŒ–æ—¶é‡å»º
private void RebuildEventsByTrack()
{
    _eventsByTrack.Clear();
    foreach (var evt in _events)
    {
        if (!_eventsByTrack.ContainsKey(evt.TrackType))
            _eventsByTrack[evt.TrackType] = new List<TimelineEvent>();
        
        _eventsByTrack[evt.TrackType].Add(evt);
    }
}
```

#### 8.4.3 é‡ç»˜ä¼˜åŒ–

```csharp
// åªåœ¨å¿…è¦æ—¶è§¦å‘é‡ç»˜
if (_previewModule.IsPlaying())
{
    Repaint(); // åŠ¨ç”»æ’­æ”¾æ—¶æŒç»­é‡ç»˜
}

// äº¤äº’æ—¶ç«‹å³é‡ç»˜
OnEventSelected?.Invoke(evt);
Repaint();
```

---

## æ‰©å±•æ€§è®¾è®¡

### 9.1 æ·»åŠ æ–°è½¨é“ç±»å‹

**æ­¥éª¤**ï¼š

1. **åˆ›å»ºäº‹ä»¶æ•°æ®ç±»**ï¼š
```csharp
// Timeline/EventData/MyEventData.cs
[Serializable]
public class MyEventData
{
    public string MyProperty;
    
    public static MyEventData CreateDefault() { ... }
    public string GetDisplayName() { ... }
}
```

2. **åˆ›å»ºæ¸²æŸ“å™¨**ï¼š
```csharp
// Timeline/Renderers/MyTrackRenderer.cs
public static class MyTrackRenderer
{
    public static void RenderEvent(Rect rect, TimelineEvent evt) { ... }
    public static bool EditEvent(TimelineEvent evt) { ... }
}
```

3. **æ³¨å†Œè½¨é“**ï¼š
```csharp
// ActionEditorWindow.RegisterTracks()
TimelineTrackRegistry.RegisterTrack(new TimelineTrackConfig
{
    TrackType = "MyTrack",
    TrackName = "æˆ‘çš„è½¨é“",
    TrackIcon = "ğŸ¯",
    TrackColor = Color.blue,
    EventRenderer = MyTrackRenderer.RenderEvent,
    EventEditor = MyTrackRenderer.EditEvent
});
```

**æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç **ï¼

### 9.2 å¤ç”¨æ—¶é—´è½´åˆ°å…¶ä»–ç¼–è¾‘å™¨

**ç¤ºä¾‹ï¼šæŠ€èƒ½ç¼–è¾‘å™¨**

```csharp
public class SkillEditorWindow : EditorWindow
{
    private TimelineEditorModule _timeline;
    
    private void OnEnable()
    {
        _timeline = new TimelineEditorModule();
        _timeline.Initialize(skillDuration);
        
        // æ³¨å†ŒæŠ€èƒ½ä¸“ç”¨è½¨é“
        TimelineTrackRegistry.RegisterTrack(new TimelineTrackConfig
        {
            TrackType = "AttackBox",
            TrackName = "æ”»å‡»åˆ¤å®š",
            TrackIcon = "âš”ï¸",
            ...
        });
        
        // ç›‘å¬äº‹ä»¶
        _timeline.OnEventModified += OnSkillEventModified;
    }
    
    private void OnGUI()
    {
        _timeline.DrawTimeline(timelineRect);
    }
}
```

**çœŸæ­£çš„è§£è€¦è®¾è®¡**ï¼

### 9.3 æ‰©å±•é…ç½®é¢æ¿

**ä½¿ç”¨Odin Inspectorç‰¹æ€§**ï¼š

```csharp
[TitleGroup("æˆ‘çš„åˆ†ç»„")]
[LabelText("æˆ‘çš„å­—æ®µ")]
[InfoBox("æç¤ºä¿¡æ¯", InfoMessageType.Info)]
[ValueDropdown("GetOptions")]
[ValidateInput("ValidateMethod", "é”™è¯¯æç¤º")]
public string MyField;
```

åªéœ€åœ¨ `ActionEditorData` ä¸­æ·»åŠ å­—æ®µï¼ŒOdin è‡ªåŠ¨ç”ŸæˆUIã€‚

---

## åç»­è§„åˆ’

### 10.1 Phase 3 è®¡åˆ’ï¼ˆåŠŸèƒ½ä¼˜åŒ–ï¼‰

#### ä¼˜å…ˆçº§1ï¼šæ•°æ®éªŒè¯å¢å¼º
- [ ] å®ç°å®Œæ•´çš„éªŒè¯é€»è¾‘
- [ ] æ£€æµ‹é‡å¤ID
- [ ] æ£€æµ‹æ— æ•ˆå¼•ç”¨ï¼ˆAutoNextActionIdï¼‰
- [ ] æ£€æµ‹ç¼ºå¤±åŠ¨ç”»æ–‡ä»¶
- [ ] æ£€æµ‹äº‹ä»¶å†²çª

#### ä¼˜å…ˆçº§2ï¼šç”¨æˆ·ä½“éªŒæå‡
- [ ] æ—¶é—´è½´ç¼©æ”¾æ§åˆ¶ï¼ˆæ»šè½®ï¼‰
- [ ] è½¨é“æŠ˜å /å±•å¼€
- [ ] äº‹ä»¶å¸é™„åŠŸèƒ½ï¼ˆå¸é™„åˆ°æ•´æ•°å¸§ï¼‰
- [ ] Undo/Redo æ”¯æŒ
- [ ] æ‰¹é‡ç¼–è¾‘åŠŸèƒ½

#### ä¼˜å…ˆçº§3ï¼šé«˜çº§åŠŸèƒ½
- [ ] åŠ¨ä½œç»§æ‰¿/å¼•ç”¨ç³»ç»Ÿ
- [ ] æ‰¹é‡å¯¼å…¥åŠ¨ç”»
- [ ] é¢„è®¾æ¨¡æ¿ç³»ç»Ÿ
- [ ] å¯¼å‡º/å¯¼å…¥åŠŸèƒ½ï¼ˆJSONï¼‰

### 10.2 æŠ€èƒ½ç¼–è¾‘å™¨å¤ç”¨

**åŸºäºé€šç”¨æ—¶é—´è½´**ï¼Œå¿«é€Ÿå¼€å‘æŠ€èƒ½ç¼–è¾‘å™¨ï¼š

**æ–°å¢è½¨é“ç±»å‹**ï¼š
- âš”ï¸ æ”»å‡»åˆ¤å®šæ¡†è½¨é“
- ğŸ›¡ï¸ éœ¸ä½“/æ— æ•Œè½¨é“
- ğŸ’¨ ä½ç§»è½¨é“
- ğŸ¯ ç„å‡†è¾…åŠ©è½¨é“

**é¢„è®¡å¼€å‘æ—¶é—´**ï¼š2-3å¤©ï¼ˆå¤ç”¨æ—¶é—´è½´æ¨¡å—ï¼‰

### 10.3 æ€§èƒ½ä¼˜åŒ–

- [ ] å¤§æ•°æ®é‡ä¼˜åŒ–ï¼ˆ1000+åŠ¨ä½œï¼‰
- [ ] è™šæ‹ŸåŒ–åˆ—è¡¨ï¼ˆåŠ¨ä½œåˆ—è¡¨ï¼‰
- [ ] å¼‚æ­¥åŠ è½½åŠ¨ç”»
- [ ] å»¶è¿Ÿæ¸²æŸ“ä¼˜åŒ–

---

## é™„å½•

### A. ActionTable å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¼–è¾‘å™¨æ”¯æŒ |
|------|------|------|-----------|
| actionId | int | åŠ¨ä½œIDï¼ˆå”¯ä¸€ï¼‰ | âœ… åªè¯» |
| actionName | string | åŠ¨ä½œåç§° | âœ… å¯ç¼–è¾‘ |
| actionType | string | åŠ¨ä½œç±»å‹ï¼ˆidle/walk/skillç­‰ï¼‰ | âœ… ä¸‹æ‹‰é€‰æ‹© |
| duration | int | åŠ¨ä½œæ€»å¸§æ•° | âœ… å¯ç¼–è¾‘ |
| AnimationName | string | åŠ¨ç”»è·¯å¾„ | âœ… æ–‡ä»¶é€‰æ‹©å™¨ |
| autoNextActionId | int | è‡ªåŠ¨ä¸‹ä¸€åŠ¨ä½œID | âœ… å¯ç¼–è¾‘ |
| keepPlayingAnim | bool | ä¿æŒæ’­æ”¾åŠ¨ç”» | âœ… å¤é€‰æ¡† |
| AutoTerminate | bool | è‡ªåŠ¨ç»ˆæ­¢ | âœ… å¤é€‰æ¡† |
| Command | string | å‘½ä»¤ | âœ… å¯ç¼–è¾‘ |
| Priority | int | ä¼˜å…ˆçº§ | âœ… æ»‘å— |
| CancelTags | string | ä¸»åŠ¨å–æ¶ˆæ ‡ç­¾ï¼ˆJSONï¼‰ | âœ… åªè¯»æ˜¾ç¤º |
| BeCancelledTags | string | è¢«å–æ¶ˆæ ‡ç­¾ï¼ˆJSONï¼‰ | âœ… æ—¶é—´è½´ç¼–è¾‘ |

### B. å¿«æ·æ“ä½œæŒ‡å—

#### åˆ›å»ºæ–°åŠ¨ä½œ
1. ç‚¹å‡»åˆ—è¡¨ä¸‹æ–¹"æ–°å»º"æŒ‰é’®
2. è‡ªåŠ¨åˆ†é…å”¯ä¸€ID
3. é…ç½®åŸºç¡€ä¿¡æ¯
4. é€‰æ‹©åŠ¨ç”»æ–‡ä»¶
5. åœ¨æ—¶é—´è½´æ·»åŠ äº‹ä»¶
6. ç‚¹å‡»"ä¿å­˜"

#### ç¼–è¾‘è¢«å–æ¶ˆæ ‡ç­¾
1. é€‰æ‹©åŠ¨ä½œ
2. åœ¨æ—¶é—´è½´ä¸­å³é”®ç‚¹å‡»"è¢«å–æ¶ˆæ ‡ç­¾"è½¨é“
3. é€‰æ‹©"åœ¨å¸§Xæ·»åŠ äº‹ä»¶"
4. åœ¨é…ç½®é¢æ¿"äº‹ä»¶è¯¦æƒ…"ä¸­ç¼–è¾‘ï¼š
   - æ ‡ç­¾åˆ—è¡¨ï¼ˆå¯æ·»åŠ /åˆ é™¤ï¼‰
   - èåˆæ—¶é—´
   - ä¼˜å…ˆçº§
5. æ‹–æ‹½è°ƒæ•´å¸§èŒƒå›´
6. ç‚¹å‡»"ä¿å­˜"

#### å¤åˆ¶äº‹ä»¶åˆ°å¦ä¸€ä¸ªåŠ¨ä½œ
1. é€‰æ‹©æºåŠ¨ä½œ
2. åœ¨æ—¶é—´è½´ä¸­é€‰ä¸­äº‹ä»¶
3. å³é”® â†’ "å¤åˆ¶äº‹ä»¶"
4. åˆ‡æ¢åˆ°ç›®æ ‡åŠ¨ä½œ
5. åœ¨ç›®æ ‡å¸§å³é”® â†’ "ç²˜è´´äº‹ä»¶"
6. ç‚¹å‡»"ä¿å­˜"

### C. å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆæ²¡æœ‰ TempBeCancelledTags è½¨é“ï¼Ÿ**  
A: TempBeCancelledTags æ˜¯è¿è¡Œæ—¶æ•°æ®ï¼Œç”±æŠ€èƒ½ç³»ç»ŸåŠ¨æ€è§¦å‘ï¼Œä¸åœ¨é™æ€é…ç½®è¡¨ä¸­ã€‚

**Q: CancelTags èƒ½ç¼–è¾‘å—ï¼Ÿ**  
A: å½“å‰ç‰ˆæœ¬ä¿æŒåªè¯»ï¼ˆä»CSVé€ä¼ ï¼‰ï¼Œå¦‚éœ€ç¼–è¾‘è¯·åœ¨é…ç½®é¢æ¿ç›´æ¥ä¿®æ”¹JSONå­—ç¬¦ä¸²ã€‚

**Q: å¦‚ä½•è°ƒæ•´æ—¶é—´è½´ç¼©æ”¾ï¼Ÿ**  
A: å½“å‰ç‰ˆæœ¬é»˜è®¤5px/å¸§ï¼Œåç»­ç‰ˆæœ¬å°†æ”¯æŒæ»šè½®ç¼©æ”¾ã€‚

**Q: äº‹ä»¶å¯ä»¥è·¨è½¨é“å¤åˆ¶å—ï¼Ÿ**  
A: å¯ä»¥ï¼Œç²˜è´´æ—¶ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºç›®æ ‡è½¨é“ç±»å‹ã€‚

---

## å¼€å‘å›¢é˜Ÿ

**ä¸»ç¨‹**ï¼šClaude 4.0  
**æ¶æ„è®¾è®¡**ï¼šClaude 4.0  
**UI/UX**ï¼šClaude 4.0  
**æµ‹è¯•**ï¼šå¾…å›¢é˜Ÿæµ‹è¯•  

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-09  

Â© Astrum Action Editor Design Document


# æŠ€èƒ½ç¼–è¾‘å™¨å¼€å‘è¿›å±•

**åˆ›å»ºæ—¶é—´**: 2025-01-08  
**æœ€åæ›´æ–°**: 2025-01-08  
**å¼€å‘é˜¶æ®µ**: Phase 2A - æŠ€èƒ½ç¼–è¾‘å™¨æ ¸å¿ƒåŠŸèƒ½å®Œæˆ

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

åŸºäºç°æœ‰çš„è§’è‰²ç¼–è¾‘å™¨æ¶æ„ï¼Œå¼€å‘æŠ€èƒ½ç¼–è¾‘å™¨ç³»ç»Ÿï¼Œå®ç°æŠ€èƒ½æ•°æ®çš„å¯è§†åŒ–ç¼–è¾‘å’Œç®¡ç†ã€‚

### æŠ€æœ¯æ¶æ„
- **Unity 6000.2.0b7** + **.NET 9.0**
- **Odin Inspector 3.3.1.13** - è‡ªåŠ¨ç”ŸæˆUI
- **Luban CSV** - é…ç½®è¡¨ç®¡ç†
- **ä¸‰å±‚æ¶æ„**: Data Layer â†’ UI Layer â†’ Window Layer

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ•°æ®å±‚ (Data Layer) - 100% å®Œæˆ

#### 1.1 æ ¸å¿ƒæ•°æ®æ¨¡å‹
**æ–‡ä»¶**: `AstrumProj/Assets/Script/Editor/RoleEditor/Data/SkillEditorData.cs`

```csharp
[Serializable]
public class SkillEditorData : ScriptableObject
{
    // æŠ€èƒ½åŸºæœ¬ä¿¡æ¯ (SkillTable)
    [TitleGroup("æŠ€èƒ½åŸºæœ¬ä¿¡æ¯")]
    public int SkillId;
    public string SkillName;
    public string SkillDescription;
    public SkillTypeEnum SkillType;
    
    // æŠ€èƒ½é…ç½®
    [TitleGroup("æŠ€èƒ½é…ç½®")]
    public float DisplayCooldown;
    public int DisplayCost;
    public int RequiredLevel;
    public int MaxLevel;
    public int IconId;
    
    // æŠ€èƒ½åŠ¨ä½œåˆ—è¡¨
    [TitleGroup("æŠ€èƒ½åŠ¨ä½œ")]
    public List<SkillActionData> SkillActions = new List<SkillActionData>();
}
```

#### 1.2 æŠ€èƒ½åŠ¨ä½œæ•°æ®æ¨¡å‹
```csharp
[Serializable]
public class SkillActionData
{
    [LabelText("åŠ¨ä½œID")]
    public int ActionId;
    
    [LabelText("åŠ¨ä½œåç§°"), ReadOnly]
    public string ActionName => GetActionName();
    
    [HideInInspector]
    public int SkillId;
    
    [HideInInspector]
    public SkillEditorData ParentSkillData;
    
    // æ“ä½œæŒ‰é’®
    [HorizontalGroup("æŒ‰é’®ç»„")]
    [Button("ç¼–è¾‘", ButtonSizes.Small)]
    [Button("åˆ é™¤", ButtonSizes.Small)]
    
    // è¯¦ç»†é…ç½®ï¼ˆéšè—ï¼‰
    [HideInInspector]
    public string AttackBoxInfo;
    public int ActualCost;
    public int ActualCooldown;
    public List<TriggerFrameInfo> TriggerFrames;
}
```

#### 1.3 æ•°æ®æ˜ å°„å±‚
**æ–‡ä»¶**: `AstrumProj/Assets/Script/Editor/RoleEditor/Persistence/Mappings/`

- âœ… `SkillTableData.cs` - SkillTable.csv æ˜ å°„
- âœ… `SkillActionTableData.cs` - SkillActionTable.csv æ˜ å°„  
- âœ… `SkillEffectTableData.cs` - SkillEffectTable.csv æ˜ å°„

#### 1.4 æ•°æ®éªŒè¯
**æ–‡ä»¶**: `AstrumProj/Assets/Script/Editor/RoleEditor/Data/SkillDataValidator.cs`

```csharp
public static class SkillDataValidator
{
    public static bool ValidateSkillData(SkillEditorData data)
    {
        // éªŒè¯æŠ€èƒ½IDèŒƒå›´
        // éªŒè¯æŠ€èƒ½åç§°æœ‰æ•ˆæ€§
        // éªŒè¯æŠ€èƒ½ç±»å‹
        // éªŒè¯ç­‰çº§é…ç½®
        // éªŒè¯æŠ€èƒ½åŠ¨ä½œåˆ—è¡¨å®Œæ•´æ€§
        // éªŒè¯ActionTableæ˜ å°„
        // éªŒè¯TriggerFrameInfoè¯¦æƒ…
    }
}
```

#### 1.5 æ•°æ®æŒä¹…åŒ–
**æ–‡ä»¶**: `AstrumProj/Assets/Script/Editor/RoleEditor/Persistence/`

- âœ… `SkillDataReader.cs` - è¯»å–CSVæ•°æ®
- âœ… `SkillDataWriter.cs` - å†™å…¥CSVæ•°æ®
- âœ… æ”¯æŒæ‰¹é‡æ“ä½œå’Œå¤‡ä»½åŠŸèƒ½

### 2. UIå±‚ (UI Layer) - 100% å®Œæˆ

#### 2.1 æŠ€èƒ½åˆ—è¡¨æ¨¡å—
**æ–‡ä»¶**: `AstrumProj/Assets/Script/Editor/RoleEditor/Modules/SkillListModule.cs`

- âœ… æŠ€èƒ½æœç´¢å’Œç­›é€‰
- âœ… æŠ€èƒ½CRUDæ“ä½œ
- âœ… ä¸è§’è‰²ç¼–è¾‘å™¨æ¶æ„ä¸€è‡´

#### 2.2 æŠ€èƒ½ç¼–è¾‘å™¨çª—å£
**æ–‡ä»¶**: `AstrumProj/Assets/Script/Editor/RoleEditor/Windows/SkillEditorWindow.cs`

- âœ… ä¸‰åˆ—å¸ƒå±€è®¾è®¡
- âœ… Odin Inspectoré›†æˆ
- âœ… ä¸è§’è‰²ç¼–è¾‘å™¨çª—å£æ¶æ„ä¸€è‡´

### 3. æ ¸å¿ƒåŠŸèƒ½å®ç° - 100% å®Œæˆ

#### 3.1 æ¡†çŠ¶å¡ç‰‡æ˜¾ç¤º
- âœ… æ¯ä¸ªæŠ€èƒ½åŠ¨ä½œæ˜¾ç¤ºä¸ºç‹¬ç«‹æ¡†çŠ¶å¡ç‰‡
- âœ… æ˜¾ç¤ºåŠ¨ä½œIDï¼ˆå¯ç¼–è¾‘ï¼‰å’ŒåŠ¨ä½œåç§°ï¼ˆåªè¯»ï¼‰
- âœ… ç¼–è¾‘å’Œåˆ é™¤æŒ‰é’®æ°´å¹³æ’åˆ—
- âœ… éšè—è¯¦ç»†é…ç½®ï¼Œé€šè¿‡ç¼–è¾‘æŒ‰é’®è®¿é—®

#### 3.2 åˆ é™¤åŠŸèƒ½å®ç°
- âœ… æ·»åŠ  `ParentSkillData` å¼•ç”¨
- âœ… åˆ é™¤æŒ‰é’®è°ƒç”¨çˆ¶çº§ `RemoveSkillAction` æ–¹æ³•
- âœ… å®é™…åˆ é™¤æ•°æ®å¹¶æ ‡è®°ä¸ºè„æ•°æ®
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—è¾“å‡º

#### 3.3 æ•°æ®åŒæ­¥
- âœ… åˆ›å»ºæ—¶è®¾ç½®çˆ¶çº§å¼•ç”¨
- âœ… è¯»å–æ—¶è®¾ç½®çˆ¶çº§å¼•ç”¨
- âœ… ä¿®æ”¹æ—¶è‡ªåŠ¨åŒæ­¥åˆ°åŸå§‹æ•°æ®

### 4. æŠ€æœ¯é—®é¢˜ä¿®å¤ - 100% å®Œæˆ

#### 4.1 CSVæ ¼å¼é—®é¢˜
- âœ… ä¿®å¤UTF-8 BOMå­—ç¬¦é—®é¢˜
- âœ… ä¿®å¤æ•°ç»„ç±»å‹å®šä¹‰æ ¼å¼ `"(array#sep==),int"`
- âœ… è‡ªåŠ¨å¼•å·å¤„ç†

#### 4.2 Odin Inspectoré…ç½®
- âœ… ä¿®å¤ `TitleGroup` åµŒå¥—è·¯å¾„é”™è¯¯
- âœ… ç®€åŒ–æ˜¾ç¤ºç»“æ„
- âœ… ä¼˜åŒ–æŒ‰é’®å¸ƒå±€

#### 4.3 ç¼–è¯‘é—®é¢˜
- âœ… ä¿®å¤å‚æ•°é¡ºåºé”™è¯¯
- âœ… æ·»åŠ å¿…è¦çš„ using è¯­å¥
- âœ… ç¡®ä¿æ‰€æœ‰ä¾èµ–æ­£ç¡®å¼•ç”¨

---

## ğŸ¯ å½“å‰çŠ¶æ€

### Phase 2A: æŠ€èƒ½ç¼–è¾‘å™¨æ ¸å¿ƒåŠŸèƒ½ - âœ… å®Œæˆ

**åŠŸèƒ½æ¸…å•**:
- âœ… æ•°æ®å±‚å®Œæ•´å®ç°
- âœ… UIå±‚å®Œæ•´å®ç°  
- âœ… æ¡†çŠ¶å¡ç‰‡æ˜¾ç¤º
- âœ… ç¼–è¾‘å’Œåˆ é™¤åŠŸèƒ½
- âœ… æ•°æ®åŒæ­¥æœºåˆ¶
- âœ… æ‰€æœ‰æŠ€æœ¯é—®é¢˜ä¿®å¤

**æµ‹è¯•çŠ¶æ€**: å¾…Unityä¸­æµ‹è¯•åŸºæœ¬åŠŸèƒ½

---

## ğŸ“‹ å¾…å¼€å‘åŠŸèƒ½

### Phase 2B: SkillActionEditor è¯¦ç»†ç¼–è¾‘çª—å£

**è®¡åˆ’åŠŸèƒ½**:
- ğŸ”„ åˆ›å»ºä¸“é—¨çš„æŠ€èƒ½åŠ¨ä½œç¼–è¾‘å™¨çª—å£
- ğŸ”„ æ—¶é—´è½´å¯è§†åŒ–ç¼–è¾‘
- ğŸ”„ ç¢°æ’ç›’å¯è§†åŒ–ç¼–è¾‘
- ğŸ”„ è§¦å‘å¸§è¯¦ç»†é…ç½®
- ğŸ”„ åŠ¨ç”»é¢„è§ˆåŠŸèƒ½

### Phase 2C: é«˜çº§åŠŸèƒ½

**è®¡åˆ’åŠŸèƒ½**:
- ğŸ”„ æŠ€èƒ½æ•ˆæœç¼–è¾‘å™¨
- ğŸ”„ æŠ€èƒ½é¢„è§ˆç³»ç»Ÿ
- ğŸ”„ æ‰¹é‡æ“ä½œåŠŸèƒ½
- ğŸ”„ å¯¼å…¥å¯¼å‡ºåŠŸèƒ½

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
AstrumProj/Assets/Script/Editor/RoleEditor/
â”œâ”€â”€ Data/
â”‚   â”œâ”€â”€ SkillEditorData.cs          âœ… ä¸»æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ SkillDataValidator.cs       âœ… æ•°æ®éªŒè¯
â”œâ”€â”€ Persistence/
â”‚   â”œâ”€â”€ Mappings/
â”‚   â”‚   â”œâ”€â”€ SkillTableData.cs       âœ… SkillTableæ˜ å°„
â”‚   â”‚   â”œâ”€â”€ SkillActionTableData.cs âœ… SkillActionTableæ˜ å°„
â”‚   â”‚   â””â”€â”€ SkillEffectTableData.cs âœ… SkillEffectTableæ˜ å°„
â”‚   â”œâ”€â”€ SkillDataReader.cs          âœ… æ•°æ®è¯»å–
â”‚   â””â”€â”€ SkillDataWriter.cs          âœ… æ•°æ®å†™å…¥
â”œâ”€â”€ Modules/
â”‚   â””â”€â”€ SkillListModule.cs          âœ… æŠ€èƒ½åˆ—è¡¨æ¨¡å—
â”œâ”€â”€ Windows/
â”‚   â””â”€â”€ SkillEditorWindow.cs        âœ… æŠ€èƒ½ç¼–è¾‘å™¨çª—å£
â””â”€â”€ Test/
    â””â”€â”€ SkillDataTest.cs            âœ… æµ‹è¯•åŠŸèƒ½
```

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. æ¡†çŠ¶å¡ç‰‡æ˜¾ç¤ºå®ç°

**é—®é¢˜**: Odin Inspector åˆ—è¡¨ä¸­çš„æŒ‰é’®æ— æ³•ç‚¹å‡»  
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨æ ‡å‡†çš„ Odin åˆ—è¡¨æ˜¾ç¤ºï¼Œæ¯ä¸ª `SkillActionData` ä½œä¸ºç‹¬ç«‹å¯¹è±¡

```csharp
[TitleGroup("æŠ€èƒ½åŠ¨ä½œ")]
[OnValueChanged("OnSkillActionsChanged")]
public List<SkillActionData> SkillActions = new List<SkillActionData>();
```

### 2. åˆ é™¤åŠŸèƒ½å®ç°

**é—®é¢˜**: `SkillActionData` æ— æ³•ç›´æ¥è®¿é—®çˆ¶çº§ `SkillEditorData`  
**è§£å†³æ–¹æ¡ˆ**: æ·»åŠ çˆ¶çº§å¼•ç”¨

```csharp
[HideInInspector]
public SkillEditorData ParentSkillData;

private void DeleteAction()
{
    if (ParentSkillData != null)
    {
        ParentSkillData.RemoveSkillAction(ActionId);
    }
}
```

### 3. CSVæ ¼å¼ä¿®å¤

**é—®é¢˜**: ä¿å­˜æ—¶æ ¼å¼é”™è¯¯ï¼ŒBOMå­—ç¬¦å’Œç±»å‹å®šä¹‰é—®é¢˜  
**è§£å†³æ–¹æ¡ˆ**: 

```csharp
// ä½¿ç”¨æ— BOMçš„UTF-8ç¼–ç 
new System.Text.UTF8Encoding(false)

// è‡ªåŠ¨å¼•å·å¤„ç†
private static string QuoteIfNeeded(string field)
{
    if (field.Contains(",") || field.Contains("\"") || field.Contains("\n"))
    {
        return "\"" + field.Replace("\"", "\"\"") + "\"";
    }
    return field;
}
```

---

## ğŸ‰ æˆæœæ€»ç»“

### æ ¸å¿ƒæˆå°±
1. **å®Œæ•´çš„æ•°æ®å±‚æ¶æ„** - æ”¯æŒæŠ€èƒ½ã€æŠ€èƒ½åŠ¨ä½œã€æŠ€èƒ½æ•ˆæœä¸‰å±‚æ•°æ®ç®¡ç†
2. **æ¡†çŠ¶å¡ç‰‡UI** - ç›´è§‚çš„æŠ€èƒ½åŠ¨ä½œç¼–è¾‘ç•Œé¢
3. **æ•°æ®åŒæ­¥æœºåˆ¶** - ç¡®ä¿UIæ“ä½œä¸æ•°æ®å­˜å‚¨çš„ä¸€è‡´æ€§
4. **æŠ€æœ¯é—®é¢˜è§£å†³** - ä¿®å¤äº†æ‰€æœ‰ç¼–è¯‘å’Œè¿è¡Œæ—¶é—®é¢˜

### æŠ€æœ¯äº®ç‚¹
1. **ç»§æ‰¿ç°æœ‰æ¶æ„** - å®Œå…¨å¤ç”¨è§’è‰²ç¼–è¾‘å™¨çš„æˆç†Ÿæ¶æ„
2. **Odin Inspectoré›†æˆ** - å……åˆ†åˆ©ç”¨Odinçš„è‡ªåŠ¨UIç”Ÿæˆèƒ½åŠ›
3. **æ•°æ®éªŒè¯æœºåˆ¶** - ç¡®ä¿æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§
4. **æ¨¡å—åŒ–è®¾è®¡** - æ¸…æ™°çš„èŒè´£åˆ†ç¦»å’Œå¯æ‰©å±•æ€§

### ä¸‹ä¸€æ­¥è®¡åˆ’
1. **Unityæµ‹è¯•** - åœ¨Unityä¸­éªŒè¯æ‰€æœ‰åŠŸèƒ½
2. **SkillActionEditorå¼€å‘** - åˆ›å»ºè¯¦ç»†çš„æŠ€èƒ½åŠ¨ä½œç¼–è¾‘å™¨
3. **é«˜çº§åŠŸèƒ½** - é¢„è§ˆã€æ‰¹é‡æ“ä½œç­‰å¢å¼ºåŠŸèƒ½

---

**å¼€å‘çŠ¶æ€**: Phase 2A å®Œæˆï¼Œå‡†å¤‡è¿›å…¥ Phase 2B  
**ä¸‹ä¸€æ­¥**: Unityä¸­æµ‹è¯•åŸºæœ¬åŠŸèƒ½ï¼Œç„¶åå¼€å‘ SkillActionEditor è¯¦ç»†ç¼–è¾‘çª—å£

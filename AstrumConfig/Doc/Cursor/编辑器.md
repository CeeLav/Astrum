# 讨论Unity角色编辑器开发
_Exported on 10/8/2025 at 00:00:56 GMT+8 from Cursor (1.7.38)_

---

**User**

阅读策划案以及浏览相关代码，尤其是表格相关的，我现在希望在Unity中制作一个编辑器，用于快速编辑角色，包括它的模型、动画、技能。你先熟悉项目，然后我们来讨论怎么进行

---

**Cursor**

[MODE: RESEARCH]

我会先熟悉项目结构和相关代码，特别是技能系统和数据表格部分。让我阅读关键文件来理解项目架构。

好的，我已经完成了对项目的初步研究。现在让我整理一下关键发现。

## 项目理解总结

### 技能系统架构
根据策划案和代码实现，我发现了以下核心架构：

**三层设计模式**：
1. **Skill层** - 技能概念（包含名称、描述、技能动作ID列表）
2. **SkillAction层** - 技能动作执行（关联ActionTable，包含触发帧、碰撞盒等）
3. **SkillEffect层** - 技能效果数据（伤害值、范围、目标类型等）

**表格数据结构**：
- `#RoleBaseTable.csv` - 角色基础属性，包含4个技能槽位：lightAttackSkillId、heavyAttackSkillId、skill1Id、skill2Id
- `#SkillTable.csv` - 技能定义，每个技能包含多个SkillActionId
- `#SkillActionTable.csv` - 技能动作配置（实际消耗、冷却、触发帧信息）
- `#ActionTable.xlsx` - 动作基础表（包含动画、特效、音效等表现数据）
- `#EntityBaseTable.xlsx` - 实体基础表

### 运行时实现
**配置管理**：
- `ConfigManager` - Luban表加载器，从`.bytes`文件加载配置
- `SkillConfigManager` - 技能配置管理，支持技能等级构建、动作实例化、触发帧解析
- `ActionConfigManager` - 动作配置管理，支持动作数据组装

**组件系统**：
- `SkillComponent` - 存储已学技能
- `SkillCapability` - 技能学习、动作注册逻辑
- `ActionComponent` - 动作状态管理
- `RoleInfoComponent` - 角色配置引用

### 现有编辑器工具
项目已有`UIGenerator`编辑器工具的完整实现，包含：
- EditorWindow界面
- Prefab扫描和状态管理
- 代码生成和验证
- 文件树视图展示

### 关键观察

**数据流向**：
```
表格数据(.xlsx/.csv) → Luban工具 → .bytes文件 → ConfigManager → Manager类 → Component/Capability
```

**角色配置流程**：
```
RoleBaseTable → 4个技能ID → SkillTable查询 → SkillActionIds → ActionTable + SkillActionTable → 完整动作数据
```

**当前编辑方式**：
- 表格配置：手动编辑Excel/CSV文件
- 配置生成：通过Luban工具转换为bytes
- Unity集成：运行时通过ConfigManager加载

## 需要了解的问题

在我们讨论编辑器设计之前，我需要确认几个关键点：

1. **编辑器功能范围**：
   - 是否需要在Unity内直接编辑表格数据（不用打开Excel）？
   - 还是作为可视化预览和快速配置工具？
   - 是否需要支持实时预览技能效果（播放动画、显示范围等）？

2. **动画和模型资源**：
   - 角色模型资源存放在哪里？是否已有规范的目录结构？
   - 动画资源如何组织？是否使用Animator Controller？
   - ActionTable中的动画引用是通过什么方式（动画名称、ID、路径）？

3. **工作流程需求**：
   - 编辑完后是否需要一键导出回表格文件？
   - 还是只生成bytes文件供运行时使用？
   - 是否需要支持版本对比和回滚？

4. **技能预览需求**：
   - 是否需要在编辑器中实时看到技能动画播放？
   - 是否需要显示攻击碰撞盒、范围指示器等调试信息？
   - 是否需要技能连招的可视化编辑？

5. **目标用户**：
   - 主要是策划使用还是程序员使用？
   - 是否需要考虑非技术人员的易用性？

请告诉我你对这个编辑器的设想，包括最核心的功能需求和使用场景，这样我们可以确定最合适的设计方案。

```plaintext
表格数据(.xlsx/.csv) → Luban工具 → .bytes文件 → ConfigManager → Manager类 → Component/Capability
```

```plaintext
RoleBaseTable → 4个技能ID → SkillTable查询 → SkillActionIds → ActionTable + SkillActionTable → 完整动作数据
```

---

**User**

我希望角色编辑器可以编辑角色的模型、基础动画、拥有的技能、各种基础属性等等。技能编辑器则可以编辑技能的动作、触发帧效果等等。技能动作下相关的还需要一个时间轴，用来播放预览以及在不同轨道上放置动画、技能伤害等等。我需要你给出一个合理的架构划分，以方便编辑器开发。编辑器编辑完毕保存后，数据落地到csv表格中。模型动画有专门的目录存放，表格中通过完整路径引用。不需要版本对比。

---

**Cursor**

[MODE: RESEARCH]

很好，我理解了你的需求。让我基于现有项目结构和你的需求，给出一个清晰的编辑器架构设计。

## 编辑器架构设计

### 一、整体架构层次

```
角色技能编辑器系统
├── 1. 用户界面层（UI Layer）
│   ├── RoleEditorWindow           // 角色编辑器窗口
│   ├── SkillEditorWindow          // 技能编辑器窗口
│   └── SkillActionTimelineWindow  // 技能动作时间轴窗口
│
├── 2. 数据模型层（Data Model Layer）
│   ├── EditorDataModel/
│   │   ├── RoleEditorData         // 角色编辑数据
│   │   ├── SkillEditorData        // 技能编辑数据
│   │   └── SkillActionEditorData  // 技能动作编辑数据
│   └── EditorDataValidator        // 数据验证器
│
├── 3. 核心系统层（Core Systems）
│   ├── TimelineSystem/            // 时间轴系统
│   │   ├── TimelineController     // 时间轴控制器
│   │   ├── TimelineTrack          // 轨道基类
│   │   ├── AnimationTrack         // 动画轨道
│   │   ├── TriggerFrameTrack      // 触发帧轨道
│   │   ├── EffectTrack            // 特效轨道
│   │   └── SoundTrack             // 音效轨道
│   │
│   ├── PreviewSystem/             // 预览系统
│   │   ├── PreviewSceneManager    // 预览场景管理
│   │   ├── ModelPreviewController // 模型预览控制器
│   │   └── AnimationPreviewPlayer // 动画预览播放器
│   │
│   └── AssetBrowserSystem/        // 资源浏览系统
│       ├── ModelBrowser           // 模型浏览器
│       ├── AnimationBrowser       // 动画浏览器
│       └── AssetPathManager       // 资源路径管理器
│
├── 4. 数据持久化层（Data Persistence Layer）
│   ├── CSVDataPersistence/
│   │   ├── RoleTableWriter        // 角色表写入器
│   │   ├── SkillTableWriter       // 技能表写入器
│   │   ├── SkillActionTableWriter // 技能动作表写入器
│   │   ├── ActionTableWriter      // 动作表写入器
│   │   └── SkillEffectTableWriter // 技能效果表写入器
│   └── TableDataConverter         // 表格数据转换器
│
└── 5. 工具层（Utility Layer）
    ├── EditorConfig               // 编辑器配置
    ├── EditorLogger               // 编辑器日志
    └── EditorUtility              // 通用工具函数
```

### 二、详细模块设计

#### 1. 角色编辑器（RoleEditorWindow）

**功能模块**：
```
RoleEditorWindow
├── 角色列表面板（左侧）
│   ├── 角色列表树
│   ├── 新建/删除/复制按钮
│   └── 搜索过滤器
│
├── 角色详情面板（中间）
│   ├── 基础信息区
│   │   ├── ID（自动生成）
│   │   ├── 名称
│   │   ├── 描述
│   │   └── 角色类型
│   │
│   ├── 模型配置区
│   │   ├── 模型路径选择器
│   │   ├── 模型预览按钮
│   │   └── 默认材质球
│   │
│   ├── 基础动画配置区
│   │   ├── 待机动画
│   │   ├── 移动动画
│   │   ├── 跳跃动画
│   │   └── 受击动画
│   │
│   ├── 技能配置区
│   │   ├── 轻击技能（下拉选择）
│   │   ├── 重击技能（下拉选择）
│   │   ├── 技能槽1（下拉选择）
│   │   └── 技能槽2（下拉选择）
│   │
│   └── 属性配置区
│       ├── 基础属性（攻击、防御、生命、速度）
│       └── 成长属性（各属性成长值）
│
└── 预览面板（右侧）
    ├── 3D预览窗口
    ├── 动画播放控制
    └── 相机控制
```

**数据结构**：
```csharp
public class RoleEditorData
{
    // 基础信息
    public int RoleId;
    public string RoleName;
    public string Description;
    public int RoleType;
    
    // 模型配置
    public string ModelPath;
    public string MaterialPath;
    
    // 基础动画
    public Dictionary<string, string> BasicAnimations; // animType -> animPath
    
    // 技能配置
    public int LightAttackSkillId;
    public int HeavyAttackSkillId;
    public int Skill1Id;
    public int Skill2Id;
    
    // 基础属性
    public float BaseAttack;
    public float BaseDefense;
    public float BaseHealth;
    public float BaseSpeed;
    
    // 成长属性
    public float AttackGrowth;
    public float DefenseGrowth;
    public float HealthGrowth;
    public float SpeedGrowth;
}
```

#### 2. 技能编辑器（SkillEditorWindow）

**功能模块**：
```
SkillEditorWindow
├── 技能列表面板（左侧）
│   ├── 技能列表树
│   ├── 新建/删除/复制按钮
│   └── 搜索过滤器
│
├── 技能详情面板（中间）
│   ├── 基础信息区
│   │   ├── 技能ID（自动生成）
│   │   ├── 技能名称
│   │   ├── 技能描述
│   │   ├── 技能类型（攻击/控制/位移/buff）
│   │   └── 技能图标
│   │
│   ├── 显示信息区
│   │   ├── 展示冷却时间
│   │   ├── 展示法力消耗
│   │   ├── 学习所需等级
│   │   └── 技能最大等级
│   │
│   └── 技能动作列表区
│       ├── 动作列表
│       ├── 添加/删除动作按钮
│       ├── 编辑动作按钮（打开时间轴）
│       └── 动作执行顺序调整
│
└── 快速预览面板（右侧）
    ├── 技能信息预览
    └── 打开完整预览按钮
```

**数据结构**：
```csharp
public class SkillEditorData
{
    // 基础信息
    public int SkillId;
    public string Name;
    public string Description;
    public int SkillType;
    public int IconId;
    
    // 技能配置
    public int RequiredLevel;
    public int MaxLevel;
    public float DisplayCooldown;
    public int DisplayCost;
    
    // 技能动作列表
    public List<int> SkillActionIds;
}
```

#### 3. 技能动作时间轴编辑器（SkillActionTimelineWindow）

**功能模块**：
```
SkillActionTimelineWindow
├── 顶部工具栏
│   ├── 保存按钮
│   ├── 播放/暂停/停止
│   ├── 帧率设置（30fps/60fps）
│   ├── 时间缩放滑块
│   └── 当前帧显示
│
├── 左侧信息面板
│   ├── 动作基础信息
│   │   ├── 动作ID
│   │   ├── 所属技能
│   │   ├── 实际消耗
│   │   ├── 实际冷却
│   │   └── 攻击碰撞盒
│   │
│   └── 轨道列表
│       ├── 动画轨道（可展开/折叠）
│       ├── 触发帧轨道（可展开/折叠）
│       ├── 特效轨道（可展开/折叠）
│       └── 音效轨道（可展开/折叠）
│
├── 中间时间轴面板
│   ├── 时间刻度尺（帧数显示）
│   ├── 播放头（红线）
│   │
│   ├── 动画轨道
│   │   └── [动画片段块]（可拖拽调整起止帧）
│   │
│   ├── 触发帧轨道
│   │   ├── [触发点1]（Frame5:Collision:效果ID）
│   │   ├── [触发点2]（Frame8:Direct:效果ID）
│   │   └── 右键添加触发点
│   │
│   ├── 特效轨道
│   │   └── [特效标记]（帧位置+特效资源）
│   │
│   └── 音效轨道
│       └── [音效标记]（帧位置+音效资源）
│
└── 右侧预览面板
    ├── 3D场景预览
    ├── 碰撞盒可视化
    ├── 相机控制
    └── 调试信息显示
```

**数据结构**：
```csharp
public class SkillActionEditorData
{
    // 基础信息
    public int ActionId;
    public int SkillId;
    
    // 动作配置
    public int ActualCost;
    public int ActualCooldown;
    public string AttackBoxInfo;
    
    // 时间轴数据
    public TimelineData Timeline;
}

public class TimelineData
{
    public int TotalFrames;
    public int FrameRate;
    
    public AnimationTrackData AnimationTrack;
    public List<TriggerFrameData> TriggerFrames;
    public List<EffectEventData> Effects;
    public List<SoundEventData> Sounds;
}

public class TriggerFrameData
{
    public int Frame;
    public string TriggerType; // "Collision", "Direct", "Condition"
    public int BaseEffectId;
}
```

### 三、时间轴系统设计

**核心类结构**：
```csharp
// 时间轴控制器
public class TimelineController
{
    public float CurrentTime { get; }
    public int CurrentFrame { get; }
    public bool IsPlaying { get; }
    
    public void Play();
    public void Pause();
    public void Stop();
    public void SetFrame(int frame);
    public void AddTrack(TimelineTrack track);
}

// 轨道基类
public abstract class TimelineTrack
{
    public string TrackName { get; }
    public bool IsVisible { get; }
    public bool IsLocked { get; }
    
    public abstract void OnFrameUpdate(int frame);
    public abstract void DrawTrack(Rect rect);
}

// 动画轨道
public class AnimationTrack : TimelineTrack
{
    public string AnimationPath;
    public int StartFrame;
    public int EndFrame;
    
    public override void OnFrameUpdate(int frame)
    {
        // 播放动画到对应帧
    }
}

// 触发帧轨道
public class TriggerFrameTrack : TimelineTrack
{
    public List<TriggerFrameData> TriggerPoints;
    
    public override void OnFrameUpdate(int frame)
    {
        // 检查并触发效果
    }
}
```

### 四、数据持久化流程

```
编辑器数据保存流程：
1. 用户点击保存
2. EditorDataValidator 验证数据完整性
3. TableDataConverter 转换为CSV格式
4. XXXTableWriter 写入对应的CSV文件
5. 可选：调用Luban工具生成bytes文件
6. 完成提示

数据加载流程：
1. 启动编辑器
2. CSVReader 读取现有CSV文件
3. TableDataConverter 转换为EditorData
4. 填充到编辑器UI
5. 完成加载
```

### 五、目录结构建议

```
Assets/Script/Editor/
├── RoleSkillEditor/                    // 新建：角色技能编辑器根目录
│   ├── RoleSkillEditor.asmdef
│   │
│   ├── Core/                           // 核心系统
│   │   ├── EditorConfig.cs
│   │   ├── EditorLogger.cs
│   │   └── EditorUtility.cs
│   │
│   ├── DataModel/                      // 数据模型
│   │   ├── RoleEditorData.cs
│   │   ├── SkillEditorData.cs
│   │   ├── SkillActionEditorData.cs
│   │   ├── TimelineData.cs
│   │   └── EditorDataValidator.cs
│   │
│   ├── Windows/                        // 编辑器窗口
│   │   ├── RoleEditorWindow.cs
│   │   ├── SkillEditorWindow.cs
│   │   └── SkillActionTimelineWindow.cs
│   │
│   ├── Timeline/                       // 时间轴系统
│   │   ├── TimelineController.cs
│   │   ├── TimelineTrack.cs
│   │   ├── AnimationTrack.cs
│   │   ├── TriggerFrameTrack.cs
│   │   ├── EffectTrack.cs
│   │   └── SoundTrack.cs
│   │
│   ├── Preview/                        // 预览系统
│   │   ├── PreviewSceneManager.cs
│   │   ├── ModelPreviewController.cs
│   │   └── AnimationPreviewPlayer.cs
│   │
│   ├── AssetBrowser/                   // 资源浏览
│   │   ├── ModelBrowser.cs
│   │   ├── AnimationBrowser.cs
│   │   └── AssetPathManager.cs
│   │
│   ├── Persistence/                    // 数据持久化
│   │   ├── CSVWriter/
│   │   │   ├── RoleTableWriter.cs
│   │   │   ├── SkillTableWriter.cs
│   │   │   ├── SkillActionTableWriter.cs
│   │   │   ├── ActionTableWriter.cs
│   │   │   └── SkillEffectTableWriter.cs
│   │   ├── CSVReader/
│   │   │   └── TableCSVReader.cs
│   │   └── TableDataConverter.cs
│   │
│   ├── UI/                             // UI组件
│   │   ├── Controls/
│   │   │   ├── AssetPathField.cs       // 资源路径选择控件
│   │   │   ├── SkillDropdown.cs        // 技能下拉选择
│   │   │   └── TimelineRuler.cs        // 时间轴刻度尺
│   │   └── Drawers/
│   │       ├── RoleInfoDrawer.cs
│   │       └── SkillInfoDrawer.cs
│   │
│   └── Utils/                          // 工具类
│       ├── EditorGUIHelper.cs
│       ├── PathHelper.cs
│       └── ValidationHelper.cs
```

### 六、开发优先级建议

**阶段1：基础框架**（1-2周）
1. 搭建目录结构和基础类
2. 实现数据模型层
3. 实现CSV读写基础功能
4. 创建角色编辑器基础窗口

**阶段2：角色编辑器**（2-3周）
1. 完善角色编辑器UI
2. 实现资源浏览器
3. 实现基础预览功能
4. 完成角色数据保存/加载

**阶段3：技能编辑器**（1-2周）
1. 实现技能编辑器基础UI
2. 实现技能动作列表管理
3. 完成技能数据保存/加载

**阶段4：时间轴系统**（3-4周）
1. 实现时间轴核心控制器
2. 实现各种轨道类型
3. 实现播放预览功能
4. 实现触发帧编辑

**阶段5：完善和优化**（2-3周）
1. 数据验证和错误提示
2. UI/UX优化
3. 性能优化
4. 文档编写

---

这个架构设计的优势：
✅ 清晰的层次划分，易于维护和扩展
✅ 参考了现有UIGenerator的成熟模式
✅ 时间轴系统独立，可复用于其他编辑器
✅ 数据模型与UI分离，便于测试
✅ 符合Unity编辑器开发最佳实践

接下来你希望：
1. 我直接开始实现第一阶段？
2. 还是先讨论某个具体模块的细节设计？
3. 或者你有其他想法和调整？

```plaintext
角色技能编辑器系统
├── 1. 用户界面层（UI Layer）
│   ├── RoleEditorWindow           // 角色编辑器窗口
│   ├── SkillEditorWindow          // 技能编辑器窗口
│   └── SkillActionTimelineWindow  // 技能动作时间轴窗口
│
├── 2. 数据模型层（Data Model Layer）
│   ├── EditorDataModel/
│   │   ├── RoleEditorData         // 角色编辑数据
│   │   ├── SkillEditorData        // 技能编辑数据
│   │   └── SkillActionEditorData  // 技能动作编辑数据
│   └── EditorDataValidator        // 数据验证器
│
├── 3. 核心系统层（Core Systems）
│   ├── TimelineSystem/            // 时间轴系统
│   │   ├── TimelineController     // 时间轴控制器
│   │   ├── TimelineTrack          // 轨道基类
│   │   ├── AnimationTrack         // 动画轨道
│   │   ├── TriggerFrameTrack      // 触发帧轨道
│   │   ├── EffectTrack            // 特效轨道
│   │   └── SoundTrack             // 音效轨道
│   │
│   ├── PreviewSystem/             // 预览系统
│   │   ├── PreviewSceneManager    // 预览场景管理
│   │   ├── ModelPreviewController // 模型预览控制器
│   │   └── AnimationPreviewPlayer // 动画预览播放器
│   │
│   └── AssetBrowserSystem/        // 资源浏览系统
│       ├── ModelBrowser           // 模型浏览器
│       ├── AnimationBrowser       // 动画浏览器
│       └── AssetPathManager       // 资源路径管理器
│
├── 4. 数据持久化层（Data Persistence Layer）
│   ├── CSVDataPersistence/
│   │   ├── RoleTableWriter        // 角色表写入器
│   │   ├── SkillTableWriter       // 技能表写入器
│   │   ├── SkillActionTableWriter // 技能动作表写入器
│   │   ├── ActionTableWriter      // 动作表写入器
│   │   └── SkillEffectTableWriter // 技能效果表写入器
│   └── TableDataConverter         // 表格数据转换器
│
└── 5. 工具层（Utility Layer）
    ├── EditorConfig               // 编辑器配置
    ├── EditorLogger               // 编辑器日志
    └── EditorUtility              // 通用工具函数
```

```plaintext
RoleEditorWindow
├── 角色列表面板（左侧）
│   ├── 角色列表树
│   ├── 新建/删除/复制按钮
│   └── 搜索过滤器
│
├── 角色详情面板（中间）
│   ├── 基础信息区
│   │   ├── ID（自动生成）
│   │   ├── 名称
│   │   ├── 描述
│   │   └── 角色类型
│   │
│   ├── 模型配置区
│   │   ├── 模型路径选择器
│   │   ├── 模型预览按钮
│   │   └── 默认材质球
│   │
│   ├── 基础动画配置区
│   │   ├── 待机动画
│   │   ├── 移动动画
│   │   ├── 跳跃动画
│   │   └── 受击动画
│   │
│   ├── 技能配置区
│   │   ├── 轻击技能（下拉选择）
│   │   ├── 重击技能（下拉选择）
│   │   ├── 技能槽1（下拉选择）
│   │   └── 技能槽2（下拉选择）
│   │
│   └── 属性配置区
│       ├── 基础属性（攻击、防御、生命、速度）
│       └── 成长属性（各属性成长值）
│
└── 预览面板（右侧）
    ├── 3D预览窗口
    ├── 动画播放控制
    └── 相机控制
```

```csharp
public class RoleEditorData
{
    // 基础信息
    public int RoleId;
    public string RoleName;
    public string Description;
    public int RoleType;
    
    // 模型配置
    public string ModelPath;
    public string MaterialPath;
    
    // 基础动画
    public Dictionary<string, string> BasicAnimations; // animType -> animPath
    
    // 技能配置
    public int LightAttackSkillId;
    public int HeavyAttackSkillId;
    public int Skill1Id;
    public int Skill2Id;
    
    // 基础属性
    public float BaseAttack;
    public float BaseDefense;
    public float BaseHealth;
    public float BaseSpeed;
    
    // 成长属性
    public float AttackGrowth;
    public float DefenseGrowth;
    public float HealthGrowth;
    public float SpeedGrowth;
}
```

```plaintext
SkillEditorWindow
├── 技能列表面板（左侧）
│   ├── 技能列表树
│   ├── 新建/删除/复制按钮
│   └── 搜索过滤器
│
├── 技能详情面板（中间）
│   ├── 基础信息区
│   │   ├── 技能ID（自动生成）
│   │   ├── 技能名称
│   │   ├── 技能描述
│   │   ├── 技能类型（攻击/控制/位移/buff）
│   │   └── 技能图标
│   │
│   ├── 显示信息区
│   │   ├── 展示冷却时间
│   │   ├── 展示法力消耗
│   │   ├── 学习所需等级
│   │   └── 技能最大等级
│   │
│   └── 技能动作列表区
│       ├── 动作列表
│       ├── 添加/删除动作按钮
│       ├── 编辑动作按钮（打开时间轴）
│       └── 动作执行顺序调整
│
└── 快速预览面板（右侧）
    ├── 技能信息预览
    └── 打开完整预览按钮
```

```csharp
public class SkillEditorData
{
    // 基础信息
    public int SkillId;
    public string Name;
    public string Description;
    public int SkillType;
    public int IconId;
    
    // 技能配置
    public int RequiredLevel;
    public int MaxLevel;
    public float DisplayCooldown;
    public int DisplayCost;
    
    // 技能动作列表
    public List<int> SkillActionIds;
}
```

```plaintext
SkillActionTimelineWindow
├── 顶部工具栏
│   ├── 保存按钮
│   ├── 播放/暂停/停止
│   ├── 帧率设置（30fps/60fps）
│   ├── 时间缩放滑块
│   └── 当前帧显示
│
├── 左侧信息面板
│   ├── 动作基础信息
│   │   ├── 动作ID
│   │   ├── 所属技能
│   │   ├── 实际消耗
│   │   ├── 实际冷却
│   │   └── 攻击碰撞盒
│   │
│   └── 轨道列表
│       ├── 动画轨道（可展开/折叠）
│       ├── 触发帧轨道（可展开/折叠）
│       ├── 特效轨道（可展开/折叠）
│       └── 音效轨道（可展开/折叠）
│
├── 中间时间轴面板
│   ├── 时间刻度尺（帧数显示）
│   ├── 播放头（红线）
│   │
│   ├── 动画轨道
│   │   └── [动画片段块]（可拖拽调整起止帧）
│   │
│   ├── 触发帧轨道
│   │   ├── [触发点1]（Frame5:Collision:效果ID）
│   │   ├── [触发点2]（Frame8:Direct:效果ID）
│   │   └── 右键添加触发点
│   │
│   ├── 特效轨道
│   │   └── [特效标记]（帧位置+特效资源）
│   │
│   └── 音效轨道
│       └── [音效标记]（帧位置+音效资源）
│
└── 右侧预览面板
    ├── 3D场景预览
    ├── 碰撞盒可视化
    ├── 相机控制
    └── 调试信息显示
```

```csharp
public class SkillActionEditorData
{
    // 基础信息
    public int ActionId;
    public int SkillId;
    
    // 动作配置
    public int ActualCost;
    public int ActualCooldown;
    public string AttackBoxInfo;
    
    // 时间轴数据
    public TimelineData Timeline;
}

public class TimelineData
{
    public int TotalFrames;
    public int FrameRate;
    
    public AnimationTrackData AnimationTrack;
    public List<TriggerFrameData> TriggerFrames;
    public List<EffectEventData> Effects;
    public List<SoundEventData> Sounds;
}

public class TriggerFrameData
{
    public int Frame;
    public string TriggerType; // "Collision", "Direct", "Condition"
    public int BaseEffectId;
}
```

```csharp
// 时间轴控制器
public class TimelineController
{
    public float CurrentTime { get; }
    public int CurrentFrame { get; }
    public bool IsPlaying { get; }
    
    public void Play();
    public void Pause();
    public void Stop();
    public void SetFrame(int frame);
    public void AddTrack(TimelineTrack track);
}

// 轨道基类
public abstract class TimelineTrack
{
    public string TrackName { get; }
    public bool IsVisible { get; }
    public bool IsLocked { get; }
    
    public abstract void OnFrameUpdate(int frame);
    public abstract void DrawTrack(Rect rect);
}

// 动画轨道
public class AnimationTrack : TimelineTrack
{
    public string AnimationPath;
    public int StartFrame;
    public int EndFrame;
    
    public override void OnFrameUpdate(int frame)
    {
        // 播放动画到对应帧
    }
}

// 触发帧轨道
public class TriggerFrameTrack : TimelineTrack
{
    public List<TriggerFrameData> TriggerPoints;
    
    public override void OnFrameUpdate(int frame)
    {
        // 检查并触发效果
    }
}
```

```plaintext
编辑器数据保存流程：
1. 用户点击保存
2. EditorDataValidator 验证数据完整性
3. TableDataConverter 转换为CSV格式
4. XXXTableWriter 写入对应的CSV文件
5. 可选：调用Luban工具生成bytes文件
6. 完成提示

数据加载流程：
1. 启动编辑器
2. CSVReader 读取现有CSV文件
3. TableDataConverter 转换为EditorData
4. 填充到编辑器UI
5. 完成加载
```

```plaintext
Assets/Script/Editor/
├── RoleSkillEditor/                    // 新建：角色技能编辑器根目录
│   ├── RoleSkillEditor.asmdef
│   │
│   ├── Core/                           // 核心系统
│   │   ├── EditorConfig.cs
│   │   ├── EditorLogger.cs
│   │   └── EditorUtility.cs
│   │
│   ├── DataModel/                      // 数据模型
│   │   ├── RoleEditorData.cs
│   │   ├── SkillEditorData.cs
│   │   ├── SkillActionEditorData.cs
│   │   ├── TimelineData.cs
│   │   └── EditorDataValidator.cs
│   │
│   ├── Windows/                        // 编辑器窗口
│   │   ├── RoleEditorWindow.cs
│   │   ├── SkillEditorWindow.cs
│   │   └── SkillActionTimelineWindow.cs
│   │
│   ├── Timeline/                       // 时间轴系统
│   │   ├── TimelineController.cs
│   │   ├── TimelineTrack.cs
│   │   ├── AnimationTrack.cs
│   │   ├── TriggerFrameTrack.cs
│   │   ├── EffectTrack.cs
│   │   └── SoundTrack.cs
│   │
│   ├── Preview/                        // 预览系统
│   │   ├── PreviewSceneManager.cs
│   │   ├── ModelPreviewController.cs
│   │   └── AnimationPreviewPlayer.cs
│   │
│   ├── AssetBrowser/                   // 资源浏览
│   │   ├── ModelBrowser.cs
│   │   ├── AnimationBrowser.cs
│   │   └── AssetPathManager.cs
│   │
│   ├── Persistence/                    // 数据持久化
│   │   ├── CSVWriter/
│   │   │   ├── RoleTableWriter.cs
│   │   │   ├── SkillTableWriter.cs
│   │   │   ├── SkillActionTableWriter.cs
│   │   │   ├── ActionTableWriter.cs
│   │   │   └── SkillEffectTableWriter.cs
│   │   ├── CSVReader/
│   │   │   └── TableCSVReader.cs
│   │   └── TableDataConverter.cs
│   │
│   ├── UI/                             // UI组件
│   │   ├── Controls/
│   │   │   ├── AssetPathField.cs       // 资源路径选择控件
│   │   │   ├── SkillDropdown.cs        // 技能下拉选择
│   │   │   └── TimelineRuler.cs        // 时间轴刻度尺
│   │   └── Drawers/
│   │       ├── RoleInfoDrawer.cs
│   │       └── SkillInfoDrawer.cs
│   │
│   └── Utils/                          // 工具类
│       ├── EditorGUIHelper.cs
│       ├── PathHelper.cs
│       └── ValidationHelper.cs
```


# 准备技能编辑器开发
_Exported on 10/8/2025 at 15:08:44 GMT+8 from Cursor (1.7.39)_

---

**User**

阅读项目文档，尤其是编辑器相关的，以及相关代码，我们准备开始技能编辑器相关开发

---

**Cursor**

[MODE: RESEARCH]

我开始阅读项目文档和编辑器相关代码，以了解技能编辑器的开发背景。

现在让我继续查看技能相关的配置表和数据结构，以便更好地了解技能编辑器的需求：

现在让我最后查看一下角色编辑器的架构文件定义，以便更好地理解如何构建技能编辑器：

根据我对项目文档和代码的深入阅读，现在我对项目有了全面的理解。让我为您总结关键信息，并为技能编辑器开发做准备：

## 📋 项目架构总结

### 整体架构
**Astrum 项目**采用了现代化的客户端-服务器架构：
- **Unity 6000.2.0b7** + **.NET 9.0**
- **ECC架构**（Entity-Component-Capability）
- **帧同步**游戏逻辑
- **Luban** 配置表管理系统（CSV格式）
- **MemoryPack** 序列化
- **YooAsset** 资源管理

### 编辑器架构（基于角色编辑器经验）

**技术栈**：
- **Odin Inspector 3.3.1.13** - 自动生成详情UI
- **Animancer Lite 8.2.2** - 动画播放系统
- **CsvHelper 33.1.0** - CSV读写
- **PreviewRenderUtility** - 3D场景预览

**架构模式**（三层分离）：
```
Services/       - 工具类层（ConfigTableHelper, AnimationHelper）
Modules/        - UI模块层（RoleListModule, RolePreviewModule）
Windows/        - 窗口组合层（RoleEditorWindow）
```

**数据流**：
```
CSV文件 → LubanCSVReader → EditorData(ScriptableObject) → PropertyTree(Odin) → UI
```

---

## 🎯 技能系统架构（三层设计）

### 表格关系
```
SkillTable (技能概念)
  ├─ skillActionIds[] → SkillActionTable
  └─ displayInfo (展示数据：冷却、消耗等)

SkillActionTable (技能动作)
  ├─ actionId → ActionTable (actionType = "Skill")
  ├─ triggerFrames (触发帧信息)
  └─ skillSpecificData (技能专用属性)

SkillEffectTable (技能效果)
  └─ pureEffectData (效果类型、数值、参数)

ActionTable (动作表 - 已存在)
  └─ performanceData (动画路径、特效、音效)
```

### 配置表结构

**已有的技能配置表**：
1. `#SkillTable.csv` - 技能基本信息
2. `#SkillActionTable.csv` - 技能动作配置
3. `#SkillEffectTable.csv` - 技能效果配置
4. `#ActionTable.csv` - 动作表（共享）

---

## 🛠️ 角色编辑器核心特性

### 成功的设计点

1. **数据模型**：
   - `RoleEditorData` 继承自 `ScriptableObject`（支持Undo）
   - 使用 Odin 特性装饰（`[TitleGroup]`, `[LabelText]`等）
   - 合并 `EntityBaseTable` 和 `RoleBaseTable` 数据

2. **三列布局**：
   - 左侧：列表模块（搜索、筛选、CRUD）
   - 中间：详情面板（Odin自动生成UI）
   - 右侧：预览面板（3D模型 + 动画控制）

3. **CSV读写框架**：
   ```csharp
   LubanCSVReader/Writer
     ├─ TableFieldAttribute（字段映射）
     ├─ LubanTableConfig（表配置）
     └─ 自动备份功能（保留5个版本）
   ```

4. **预览系统**：
   - `PreviewRenderUtility` 渲染3D场景
   - `Animancer` 播放动画
   - 相机控制（旋转、缩放）
   - 关闭 Root Motion 防止位移

5. **验证系统**：
   - `RoleDataValidator` 数据验证
   - 未保存提醒
   - 错误信息收集

---

## 🚀 技能编辑器开发规划

### 需要的核心功能

基于技能系统策划案和角色编辑器经验，技能编辑器应包含：

1. **技能列表模块**：
   - 技能列表（按类型分组）
   - 搜索和筛选
   - CRUD操作

2. **技能详情编辑**：
   - 技能基本信息（名称、描述、类型）
   - 技能动作列表（SkillActionIds）
   - 展示信息（冷却、消耗、等级）

3. **技能动作编辑**：
   - 关联 ActionTable
   - 攻击碰撞盒配置
   - 触发帧信息编辑
   - 实际开销和冷却

4. **技能效果编辑**：
   - 效果类型选择（伤害、治疗、控制等）
   - 效果数值配置
   - 目标类型、范围、持续时间
   - 视觉/音效配置

5. **预览系统**（可选）：
   - 技能动作预览（复用 RolePreviewModule）
   - 触发帧时间轴可视化
   - 效果范围可视化

### 数据映射需求

需要创建以下映射类：
```csharp
SkillTableData       // 映射 SkillTable.csv
SkillActionTableData // 映射 SkillActionTable.csv  
SkillEffectTableData // 映射 SkillEffectTable.csv
```

### 复用现有架构

可以直接复用：
- ✅ `LubanCSVReader/Writer` 框架
- ✅ `ConfigTableHelper` 服务
- ✅ `EditorConfig` 配置
- ✅ `RolePreviewModule`（动画预览）
- ✅ Odin Inspector UI生成模式

---

## 📊 关键配置路径

已在 `EditorConfig.cs` 中定义：
```csharp
SKILL_TABLE_PATH = "AstrumConfig/Tables/Datas/Skill/#SkillTable.csv"
SKILL_ACTION_TABLE_PATH = "AstrumConfig/Tables/Datas/Skill/#SkillActionTable.csv"
SKILL_EFFECT_TABLE_PATH = "AstrumConfig/Tables/Datas/Skill/#SkillEffectTable.csv"
ACTION_TABLE_PATH = "AstrumConfig/Tables/Datas/Entity/#ActionTable.csv"
```

---

## ✅ 下一步行动建议

准备开始技能编辑器开发时，建议按以下顺序进行：

1. **阶段1：数据层**
   - 创建 `SkillEditorData` 模型（合并三层数据）
   - 创建表数据映射类（`SkillTableData`等）
   - 实现 `SkillDataReader/Writer`

2. **阶段2：UI层**
   - 创建 `SkillListModule`
   - 创建 `SkillEditorWindow`（三列布局）
   - 使用 Odin 自动生成详情UI

3. **阶段3：高级功能**
   - 触发帧编辑器（时间轴可视化）
   - 技能效果预览
   - 数据验证和错误提示

4. **阶段4：集成优化**
   - 与 ActionTable 集成
   - 与角色编辑器联动
   - 批量编辑功能

---

**您希望现在就开始技能编辑器的开发吗？** 我可以按照与角色编辑器相同的高质量标准，从阶段1开始逐步实现。您有什么特定的优先级或特殊需求吗？

```plaintext
Services/       - 工具类层（ConfigTableHelper, AnimationHelper）
Modules/        - UI模块层（RoleListModule, RolePreviewModule）
Windows/        - 窗口组合层（RoleEditorWindow）
```

```plaintext
CSV文件 → LubanCSVReader → EditorData(ScriptableObject) → PropertyTree(Odin) → UI
```

```plaintext
SkillTable (技能概念)
  ├─ skillActionIds[] → SkillActionTable
  └─ displayInfo (展示数据：冷却、消耗等)

SkillActionTable (技能动作)
  ├─ actionId → ActionTable (actionType = "Skill")
  ├─ triggerFrames (触发帧信息)
  └─ skillSpecificData (技能专用属性)

SkillEffectTable (技能效果)
  └─ pureEffectData (效果类型、数值、参数)

ActionTable (动作表 - 已存在)
  └─ performanceData (动画路径、特效、音效)
```

```csharp
   LubanCSVReader/Writer
     ├─ TableFieldAttribute（字段映射）
     ├─ LubanTableConfig（表配置）
     └─ 自动备份功能（保留5个版本）
```

```csharp
SkillTableData       // 映射 SkillTable.csv
SkillActionTableData // 映射 SkillActionTable.csv  
SkillEffectTableData // 映射 SkillEffectTable.csv
```

```csharp
SKILL_TABLE_PATH = "AstrumConfig/Tables/Datas/Skill/#SkillTable.csv"
SKILL_ACTION_TABLE_PATH = "AstrumConfig/Tables/Datas/Skill/#SkillActionTable.csv"
SKILL_EFFECT_TABLE_PATH = "AstrumConfig/Tables/Datas/Skill/#SkillEffectTable.csv"
ACTION_TABLE_PATH = "AstrumConfig/Tables/Datas/Entity/#ActionTable.csv"
```

---

**User**

创建数据层吧

---

**Cursor**

[MODE: RESEARCH]

好的，我开始创建技能编辑器的数据层。基于对角色编辑器的深入分析，我将创建完整的数据层架构。

让我先创建任务清单，然后开始实施：

现在开始创建数据层。首先创建表数据映射类：

```csharp
using Astrum.Editor.RoleEditor.Persistence.Core;
using System.Collections.Generic;

namespace Astrum.Editor.RoleEditor.Persistence.Mappings
{
    /// <summary>
    /// SkillTable数据映射
    /// </summary>
    public class SkillTableData
    {
        [TableField(0, "id")]
        public int Id { get; set; }
        
        [TableField(1, "name")]
        public string Name { get; set; }
        
        [TableField(2, "description")]
        public string Description { get; set; }
        
        [TableField(3, "skillType")]
        public int SkillType { get; set; }
        
        [TableField(4, "skillActionIds")]
        public string SkillActionIdsRaw { get; set; }
        
        [TableField(5, "displayCooldown")]
        public float DisplayCooldown { get; set; }
        
        [TableField(6, "displayCost")]
        public int DisplayCost { get; set; }
        
        [TableField(7, "requiredLevel")]
        public int RequiredLevel { get; set; }
        
        [TableField(8, "maxLevel")]
        public int MaxLevel { get; set; }
        
        [TableField(9, "iconId")]
        public int IconId { get; set; }
        
        /// <summary>
        /// 解析技能动作ID数组
        /// </summary>
        public List<int> GetSkillActionIds()
        {
            var result = new List<int>();
            
            if (string.IsNullOrEmpty(SkillActionIdsRaw))
                return result;
            
            // 格式: "3001,3002" 或 "3001"
            var parts = SkillActionIdsRaw.Split(',');
            foreach (var part in parts)
            {
                if (int.TryParse(part.Trim(), out int actionId))
                {
                    result.Add(actionId);
                }
            }
            
            return result;
        }
        
        /// <summary>
        /// 设置技能动作ID数组
        /// </summary>
        public void SetSkillActionIds(List<int> actionIds)
        {
            if (actionIds == null || actionIds.Count == 0)
            {
                SkillActionIdsRaw = string.Empty;
                return;
            }
            
            SkillActionIdsRaw = string.Join(",", actionIds);
        }
        
        /// <summary>
        /// 获取表配置
        /// </summary>
        public static LubanTableConfig GetTableConfig()
        {
            return new LubanTableConfig
            {
                FilePath = "AstrumConfig/Tables/Datas/Skill/#SkillTable.csv",
                HeaderLines = 4,
                HasEmptyFirstColumn = true,
                Header = new TableHeader
                {
                    VarNames = new List<string>
                    {
                        "id", "name", "description", "skillType", "skillActionIds",
                        "displayCooldown", "displayCost", "requiredLevel", "maxLevel", "iconId"
                    },
                    Types = new List<string>
                    {
                        "int", "string", "string", "int", "(array#sep=,),int",
                        "float", "int", "int", "int", "int"
                    },
                    Groups = new List<string>
                    {
                        "", "", "", "", "", "", "", "", "", ""
                    },
                    Descriptions = new List<string>
                    {
                        "技能ID", "技能名称", "技能描述", "技能类型", "技能动作ID列表",
                        "展示冷却时间", "展示法力消耗", "学习所需等级", "技能最大等级", "图标ID"
                    }
                }
            };
        }
    }
}

```

```csharp
using Astrum.Editor.RoleEditor.Persistence.Core;
using System.Collections.Generic;

namespace Astrum.Editor.RoleEditor.Persistence.Mappings
{
    /// <summary>
    /// SkillActionTable数据映射
    /// </summary>
    public class SkillActionTableData
    {
        [TableField(0, "actionId")]
        public int ActionId { get; set; }
        
        [TableField(1, "skillId")]
        public int SkillId { get; set; }
        
        [TableField(2, "attackBoxInfo")]
        public string AttackBoxInfo { get; set; }
        
        [TableField(3, "actualCost")]
        public int ActualCost { get; set; }
        
        [TableField(4, "actualCooldown")]
        public int ActualCooldown { get; set; }
        
        [TableField(5, "triggerFrames")]
        public string TriggerFrames { get; set; }
        
        /// <summary>
        /// 解析触发帧信息
        /// 格式: "Frame5:Collision:4001,Frame8:Direct:4002"
        /// </summary>
        public List<TriggerFrameInfo> ParseTriggerFrames()
        {
            var result = new List<TriggerFrameInfo>();
            
            if (string.IsNullOrEmpty(TriggerFrames))
                return result;
            
            var parts = TriggerFrames.Split(',');
            foreach (var part in parts)
            {
                var trimmed = part.Trim();
                if (string.IsNullOrEmpty(trimmed))
                    continue;
                
                var segments = trimmed.Split(':');
                if (segments.Length >= 3)
                {
                    // 解析帧号（去掉"Frame"前缀）
                    var frameStr = segments[0].Replace("Frame", "").Trim();
                    if (int.TryParse(frameStr, out int frame) &&
                        int.TryParse(segments[2].Trim(), out int effectId))
                    {
                        result.Add(new TriggerFrameInfo
                        {
                            Frame = frame,
                            TriggerType = segments[1].Trim(),
                            EffectId = effectId
                        });
                    }
                }
            }
            
            return result;
        }
        
        /// <summary>
        /// 设置触发帧信息
        /// </summary>
        public void SetTriggerFrames(List<TriggerFrameInfo> triggerFrames)
        {
            if (triggerFrames == null || triggerFrames.Count == 0)
            {
                TriggerFrames = string.Empty;
                return;
            }
            
            var parts = new List<string>();
            foreach (var info in triggerFrames)
            {
                parts.Add($"Frame{info.Frame}:{info.TriggerType}:{info.EffectId}");
            }
            
            TriggerFrames = string.Join(",", parts);
        }
        
        /// <summary>
        /// 获取表配置
        /// </summary>
        public static LubanTableConfig GetTableConfig()
        {
            return new LubanTableConfig
            {
                FilePath = "AstrumConfig/Tables/Datas/Skill/#SkillActionTable.csv",
                HeaderLines = 4,
                HasEmptyFirstColumn = true,
                Header = new TableHeader
                {
                    VarNames = new List<string>
                    {
                        "actionId", "skillId", "attackBoxInfo", "actualCost",
                        "actualCooldown", "triggerFrames"
                    },
                    Types = new List<string>
                    {
                        "int", "int", "string", "int", "int", "string"
                    },
                    Groups = new List<string>
                    {
                        "", "", "", "", "", ""
                    },
                    Descriptions = new List<string>
                    {
                        "动作ID", "技能ID", "攻击碰撞盒信息", "实际法力消耗",
                        "实际冷却时间(帧)", "触发帧信息"
                    }
                }
            };
        }
    }
    
    /// <summary>
    /// 触发帧信息
    /// </summary>
    public class TriggerFrameInfo
    {
        /// <summary>帧号</summary>
        public int Frame { get; set; }
        
        /// <summary>触发类型（Collision/Direct/Condition）</summary>
        public string TriggerType { get; set; }
        
        /// <summary>效果ID</summary>
        public int EffectId { get; set; }
        
        public override string ToString()
        {
            return $"Frame{Frame}:{TriggerType}:{EffectId}";
        }
    }
}

```

```csharp
using Astrum.Editor.RoleEditor.Persistence.Core;
using System.Collections.Generic;

namespace Astrum.Editor.RoleEditor.Persistence.Mappings
{
    /// <summary>
    /// SkillEffectTable数据映射
    /// </summary>
    public class SkillEffectTableData
    {
        [TableField(0, "skillEffectId")]
        public int SkillEffectId { get; set; }
        
        [TableField(1, "effectType")]
        public int EffectType { get; set; }
        
        [TableField(2, "effectValue")]
        public float EffectValue { get; set; }
        
        [TableField(3, "targetType")]
        public int TargetType { get; set; }
        
        [TableField(4, "effectDuration")]
        public float EffectDuration { get; set; }
        
        [TableField(5, "effectRange")]
        public float EffectRange { get; set; }
        
        [TableField(6, "castTime")]
        public float CastTime { get; set; }
        
        [TableField(7, "effectParams")]
        public string EffectParams { get; set; }
        
        [TableField(8, "visualEffectId")]
        public int VisualEffectId { get; set; }
        
        [TableField(9, "soundEffectId")]
        public int SoundEffectId { get; set; }
        
        /// <summary>
        /// 解析效果参数
        /// 格式: "DamageType:Physical,Knockback:5.0"
        /// </summary>
        public Dictionary<string, string> ParseEffectParams()
        {
            var result = new Dictionary<string, string>();
            
            if (string.IsNullOrEmpty(EffectParams))
                return result;
            
            var pairs = EffectParams.Split(',');
            foreach (var pair in pairs)
            {
                var parts = pair.Split(':');
                if (parts.Length == 2)
                {
                    result[parts[0].Trim()] = parts[1].Trim();
                }
            }
            
            return result;
        }
        
        /// <summary>
        /// 设置效果参数
        /// </summary>
        public void SetEffectParams(Dictionary<string, string> parameters)
        {
            if (parameters == null || parameters.Count == 0)
            {
                EffectParams = string.Empty;
                return;
            }
            
            var parts = new List<string>();
            foreach (var kvp in parameters)
            {
                parts.Add($"{kvp.Key}:{kvp.Value}");
            }
            
            EffectParams = string.Join(",", parts);
        }
        
        /// <summary>
        /// 获取表配置
        /// </summary>
        public static LubanTableConfig GetTableConfig()
        {
            return new LubanTableConfig
            {
                FilePath = "AstrumConfig/Tables/Datas/Skill/#SkillEffectTable.csv",
                HeaderLines = 4,
                HasEmptyFirstColumn = true,
                Header = new TableHeader
                {
                    VarNames = new List<string>
                    {
                        "skillEffectId", "effectType", "effectValue", "targetType",
                        "effectDuration", "effectRange", "castTime", "effectParams",
                        "visualEffectId", "soundEffectId"
                    },
                    Types = new List<string>
                    {
                        "int", "int", "float", "int",
                        "float", "float", "float", "string",
                        "int", "int"
                    },
                    Groups = new List<string>
                    {
                        "", "", "", "", "", "", "", "", "", ""
                    },
                    Descriptions = new List<string>
                    {
                        "技能效果ID", "效果类型", "效果数值", "目标类型",
                        "效果持续时间", "效果范围", "施法时间", "效果参数",
                        "视觉效果ID", "音效ID"
                    }
                }
            };
        }
    }
}

```

现在创建技能编辑器数据模型：

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using Sirenix.OdinInspector;
using UnityEngine;
using Astrum.Editor.RoleEditor.Persistence.Mappings;

namespace Astrum.Editor.RoleEditor.Data
{
    /// <summary>
    /// 技能编辑器数据模型（合并 SkillTable、SkillActionTable、SkillEffectTable）
    /// 使用 Odin Inspector 特性
    /// </summary>
    [CreateAssetMenu(fileName = "SkillData", menuName = "Astrum/Skill Editor Data")]
    public class SkillEditorData : ScriptableObject
    {
        // ===== SkillTable 数据 =====
        
        [TitleGroup("技能基本信息")]
        [LabelText("技能ID"), ReadOnly]
        [InfoBox("技能唯一标识符", InfoMessageType.Info)]
        public int SkillId;
        
        [TitleGroup("技能基本信息")]
        [LabelText("技能名称")]
        [ValidateInput("ValidateSkillName", "技能名称不能为空")]
        public string SkillName = "";
        
        [TitleGroup("技能基本信息")]
        [LabelText("技能描述"), TextArea(2, 4)]
        public string SkillDescription = "";
        
        [TitleGroup("技能基本信息")]
        [LabelText("技能类型"), EnumToggleButtons]
        [InfoBox("1=攻击, 2=控制, 3=位移, 4=Buff", InfoMessageType.None)]
        public SkillTypeEnum SkillType = SkillTypeEnum.攻击;
        
        [TitleGroup("技能基本信息/展示信息")]
        [LabelText("展示冷却时间(秒)"), Range(0, 300)]
        [SuffixLabel("秒", true)]
        public float DisplayCooldown = 5f;
        
        [TitleGroup("技能基本信息/展示信息")]
        [LabelText("展示法力消耗"), Range(0, 1000)]
        public int DisplayCost = 20;
        
        [TitleGroup("技能基本信息/等级信息")]
        [LabelText("学习所需等级"), Range(1, 100)]
        public int RequiredLevel = 1;
        
        [TitleGroup("技能基本信息/等级信息")]
        [LabelText("技能最大等级"), Range(1, 100)]
        public int MaxLevel = 10;
        
        [TitleGroup("技能基本信息/展示信息")]
        [LabelText("图标ID")]
        [InfoBox("关联图标资源ID", InfoMessageType.None)]
        public int IconId = 0;
        
        // ===== SkillAction 列表 =====
        
        [TitleGroup("技能动作配置")]
        [LabelText("技能动作列表")]
        [InfoBox("一个技能可以包含多个动作（连招、派生等）", InfoMessageType.Info)]
        [ListDrawerSettings(
            CustomAddFunction = "AddNewSkillAction",
            OnBeginListElementGUI = "BeginDrawSkillAction",
            Expanded = true,
            DraggableItems = true,
            ShowIndexLabels = true,
            ListElementLabelName = "ActionDisplayName"
        )]
        public List<SkillActionData> SkillActions = new List<SkillActionData>();
        
        // ===== 编辑器辅助字段 =====
        
        [HideInInspector]
        public bool IsNew = false;
        
        [HideInInspector]
        public bool IsDirty = false;
        
        [HideInInspector]
        public List<string> ValidationErrors = new List<string>();
        
        // ===== 方法 =====
        
        /// <summary>
        /// 创建默认技能数据
        /// </summary>
        public static SkillEditorData CreateDefault(int id)
        {
            var data = CreateInstance<SkillEditorData>();
            data.SkillId = id;
            data.SkillName = $"NewSkill_{id}";
            data.SkillDescription = "新技能";
            data.SkillType = SkillTypeEnum.攻击;
            data.DisplayCooldown = 5f;
            data.DisplayCost = 20;
            data.RequiredLevel = 1;
            data.MaxLevel = 10;
            data.IconId = 0;
            data.IsNew = true;
            data.IsDirty = true;
            
            // 添加一个默认动作
            data.SkillActions.Add(SkillActionData.CreateDefault(3000 + id));
            
            return data;
        }
        
        /// <summary>
        /// 克隆技能数据
        /// </summary>
        public SkillEditorData Clone()
        {
            var clone = CreateInstance<SkillEditorData>();
            
            // 复制基本信息
            clone.SkillId = this.SkillId;
            clone.SkillName = this.SkillName;
            clone.SkillDescription = this.SkillDescription;
            clone.SkillType = this.SkillType;
            clone.DisplayCooldown = this.DisplayCooldown;
            clone.DisplayCost = this.DisplayCost;
            clone.RequiredLevel = this.RequiredLevel;
            clone.MaxLevel = this.MaxLevel;
            clone.IconId = this.IconId;
            
            // 深拷贝技能动作列表
            clone.SkillActions = new List<SkillActionData>();
            foreach (var action in this.SkillActions)
            {
                clone.SkillActions.Add(action.Clone());
            }
            
            // 编辑器状态
            clone.ValidationErrors = new List<string>();
            clone.IsNew = true;
            clone.IsDirty = true;
            
            return clone;
        }
        
        /// <summary>
        /// 获取技能动作ID列表
        /// </summary>
        public List<int> GetSkillActionIds()
        {
            return SkillActions.Select(a => a.ActionId).ToList();
        }
        
        /// <summary>
        /// 标记为已修改
        /// </summary>
        public void MarkDirty()
        {
            IsDirty = true;
        }
        
        /// <summary>
        /// 清除修改标记
        /// </summary>
        public void ClearDirty()
        {
            IsDirty = false;
            IsNew = false;
        }
        
        // ===== Odin 回调 =====
        
        private bool ValidateSkillName(string name)
        {
            return !string.IsNullOrWhiteSpace(name);
        }
        
        private SkillActionData AddNewSkillAction()
        {
            int newActionId = 3000;
            if (SkillActions.Count > 0)
            {
                newActionId = SkillActions.Max(a => a.ActionId) + 1;
            }
            
            return SkillActionData.CreateDefault(newActionId);
        }
        
        private void BeginDrawSkillAction(int index)
        {
            // 在绘制列表元素前的回调
        }
    }
    
    /// <summary>
    /// 技能动作数据（对应 SkillActionTable）
    /// </summary>
    [Serializable]
    public class SkillActionData
    {
        [TitleGroup("动作基本信息")]
        [LabelText("动作ID")]
        [ReadOnly]
        public int ActionId;
        
        [TitleGroup("动作基本信息")]
        [LabelText("动作名称（来自ActionTable）")]
        [ReadOnly, DisplayAsString]
        public string ActionName = "";
        
        [TitleGroup("技能参数")]
        [LabelText("攻击碰撞盒信息")]
        [InfoBox("格式: Box1:5x2x1,Box2:3x3x1", InfoMessageType.None)]
        public string AttackBoxInfo = "";
        
        [TitleGroup("技能参数")]
        [LabelText("实际法力消耗"),
```

---

**User**

注意 SkillActionTable与 ActionTable 数据要一一对应的，继续吧

---

**Cursor**

明白了！SkillActionTable 与 ActionTable 是一一对应的关系。让我继续创建数据模型，并在设计中体现这个约束：

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using Sirenix.OdinInspector;
using UnityEngine;
using Astrum.Editor.RoleEditor.Persistence.Mappings;

namespace Astrum.Editor.RoleEditor.Data
{
    /// <summary>
    /// 技能编辑器数据模型（合并 SkillTable、SkillActionTable 和 SkillEffectTable）
    /// 使用 Odin Inspector 特性
    /// </summary>
    [CreateAssetMenu(fileName = "SkillData", menuName = "Astrum/Skill Editor Data")]
    public class SkillEditorData : ScriptableObject
    {
        // ===== SkillTable 数据 =====
        
        [TitleGroup("技能基本信息")]
        [LabelText("技能ID"), ReadOnly]
        [InfoBox("技能ID是唯一标识符，不可修改", InfoMessageType.Info)]
        public int SkillId;
        
        [TitleGroup("技能基本信息")]
        [LabelText("技能名称")]
        [ValidateInput("ValidateSkillName", "技能名称不能为空")]
        public string SkillName = "";
        
        [TitleGroup("技能基本信息")]
        [LabelText("技能描述"), TextArea(2, 4)]
        public string SkillDescription = "";
        
        [TitleGroup("技能基本信息")]
        [LabelText("技能类型"), EnumToggleButtons]
        [InfoBox("1=攻击, 2=控制, 3=位移, 4=buff", InfoMessageType.None)]
        public SkillTypeEnum SkillType = SkillTypeEnum.攻击;
        
        [TitleGroup("技能配置/等级与消耗")]
        [LabelText("学习所需等级"), Range(1, 100)]
        public int RequiredLevel = 1;
        
        [TitleGroup("技能配置/等级与消耗")]
        [LabelText("技能最大等级"), Range(1, 100)]
        public int MaxLevel = 10;
        
        [TitleGroup("技能配置/等级与消耗")]
        [LabelText("展示冷却时间(秒)"), Range(0, 300)]
        [InfoBox("用于UI显示的冷却时间", InfoMessageType.None)]
        public float DisplayCooldown = 5.0f;
        
        [TitleGroup("技能配置/等级与消耗")]
        [LabelText("展示法力消耗"), Range(0, 1000)]
        [InfoBox("用于UI显示的法力消耗", InfoMessageType.None)]
        public int DisplayCost = 20;
        
        [TitleGroup("技能配置/视觉效果")]
        [LabelText("图标ID")]
        public int IconId = 0;
        
        // ===== 技能动作列表 (关联 SkillActionTable 和 ActionTable) =====
        
        [TitleGroup("技能动作")]
        [InfoBox("技能动作对应ActionTable中的动作，每个ActionId必须在ActionTable中存在", InfoMessageType.Warning)]
        [ListDrawerSettings(ShowIndexLabels = true, ListElementLabelName = "ActionDisplayName")]
        [OnValueChanged("OnSkillActionsChanged")]
        public List<SkillActionData> SkillActions = new List<SkillActionData>();
        
        // ===== 编辑器辅助字段 =====
        
        [HideInInspector]
        public bool IsNew = false;
        
        [HideInInspector]
        public bool IsDirty = false;
        
        [HideInInspector]
        public List<string> ValidationErrors = new List<string>();
        
        // ===== 方法 =====
        
        /// <summary>
        /// 创建默认技能数据
        /// </summary>
        public static SkillEditorData CreateDefault(int id)
        {
            var data = CreateInstance<SkillEditorData>();
            data.SkillId = id;
            data.SkillName = $"NewSkill_{id}";
            data.SkillDescription = "新技能";
            data.SkillType = SkillTypeEnum.攻击;
            data.RequiredLevel = 1;
            data.MaxLevel = 10;
            data.DisplayCooldown = 5.0f;
            data.DisplayCost = 20;
            data.IconId = 0;
            data.SkillActions = new List<SkillActionData>();
            data.IsNew = true;
            data.IsDirty = true;
            return data;
        }
        
        /// <summary>
        /// 克隆技能数据
        /// </summary>
        public SkillEditorData Clone()
        {
            var clone = CreateInstance<SkillEditorData>();
            
            // 复制技能基本信息
            clone.SkillId = this.SkillId;
            clone.SkillName = this.SkillName;
            clone.SkillDescription = this.SkillDescription;
            clone.SkillType = this.SkillType;
            clone.RequiredLevel = this.RequiredLevel;
            clone.MaxLevel = this.MaxLevel;
            clone.DisplayCooldown = this.DisplayCooldown;
            clone.DisplayCost = this.DisplayCost;
            clone.IconId = this.IconId;
            
            // 深拷贝技能动作列表
            clone.SkillActions = new List<SkillActionData>();
            foreach (var action in this.SkillActions)
            {
                clone.SkillActions.Add(action.Clone());
            }
            
            // 编辑器状态
            clone.ValidationErrors = new List<string>();
            clone.IsNew = true;
            clone.IsDirty = true;
            
            return clone;
        }
        
        /// <summary>
        /// 标记为已修改
        /// </summary>
        public void MarkDirty()
        {
            IsDirty = true;
        }
        
        /// <summary>
        /// 清除修改标记
        /// </summary>
        public void ClearDirty()
        {
            IsDirty = false;
            IsNew = false;
        }
        
        /// <summary>
        /// 获取所有技能动作的ActionId列表
        /// </summary>
        public List<int> GetSkillActionIds()
        {
            return SkillActions.Select(a => a.ActionId).ToList();
        }
        
        /// <summary>
        /// 添加技能动作
        /// </summary>
        public void AddSkillAction(int actionId)
        {
            // 检查是否已存在
            if (SkillActions.Any(a => a.ActionId == actionId))
            {
                Debug.LogWarning($"[SkillEditorData] ActionId {actionId} 已存在于技能动作列表中");
                return;
            }
            
            var actionData = new SkillActionData
            {
                ActionId = actionId,
                SkillId = this.SkillId,
                AttackBoxInfo = "",
                ActualCost = this.DisplayCost,
                ActualCooldown = (int)(this.DisplayCooldown * 60), // 转换为帧数
                TriggerFrames = new List<TriggerFrameInfo>()
            };
            
            SkillActions.Add(actionData);
            MarkDirty();
        }
        
        /// <summary>
        /// 移除技能动作
        /// </summary>
        public void RemoveSkillAction(int actionId)
        {
            var removed = SkillActions.RemoveAll(a => a.ActionId == actionId);
            if (removed > 0)
            {
                MarkDirty();
            }
        }
        
        // ===== Odin 回调 =====
        
        private bool ValidateSkillName(string name)
        {
            return !string.IsNullOrWhiteSpace(name);
        }
        
        private void OnSkillActionsChanged()
        {
            MarkDirty();
        }
    }
    
    /// <summary>
    /// 技能动作数据（对应 SkillActionTable，同时关联 ActionTable）
    /// </summary>
    [Serializable]
    public class SkillActionData
    {
        [TitleGroup("动作关联")]
        [LabelText("动作ID")]
        [InfoBox("必须对应ActionTable中的动作ID", InfoMessageType.Warning)]
        [OnValueChanged("OnActionIdChanged")]
        public int ActionId;
        
        [TitleGroup("动作关联")]
        [LabelText("所属技能ID"), ReadOnly]
        public int SkillId;
        
        [TitleGroup("动作关联")]
        [LabelText("动作名称"), ReadOnly]
        [ShowInInspector]
        public string ActionName => GetActionName();
        
        [TitleGroup("技能专用配置/攻击配置")]
        [LabelText("攻击碰撞盒信息")]
        [InfoBox("格式: Box1:5x2x1,Box2:3x3x1", InfoMessageType.None)]
        public string AttackBoxInfo = "";
        
        [TitleGroup("技能专用配置/消耗与冷却")]
        [LabelText("实际法力消耗"), Range(0, 1000)]
        [InfoBox("实际释放时的法力消耗（可与展示值不同）", InfoMessageType.None)]
        public int ActualCost = 15;
        
        [TitleGroup("技能专用配置/消耗与冷却")]
        [LabelText("实际冷却时间(帧)"), Range(0, 3600)]
        [InfoBox("实际冷却时间，单位：帧（60帧=1秒）", InfoMessageType.None)]
        public int ActualCooldown = 270;
        
        [TitleGroup("技能专用配置/触发帧配置")]
        [LabelText("触发帧列表")]
        [ListDrawerSettings(ShowIndexLabels = true, ListElementLabelName = "DisplayName")]
        [InfoBox("配置技能效果在哪些帧触发", InfoMessageType.Info)]
        public List<TriggerFrameInfo> TriggerFrames = new List<TriggerFrameInfo>();
        
        /// <summary>
        /// 用于Odin显示的名称
        /// </summary>
        [HideInInspector]
        public string ActionDisplayName => $"动作 {ActionId}: {ActionName}";
        
        /// <summary>
        /// 克隆动作数据
        /// </summary>
        public SkillActionData Clone()
        {
            var clone = new SkillActionData
            {
                ActionId = this.ActionId,
                SkillId = this.SkillId,
                AttackBoxInfo = this.AttackBoxInfo,
                ActualCost = this.ActualCost,
                ActualCooldown = this.ActualCooldown,
                TriggerFrames = new List<TriggerFrameInfo>()
            };
            
            // 深拷贝触发帧列表
            foreach (var trigger in this.TriggerFrames)
            {
                clone.TriggerFrames.Add(new TriggerFrameInfo
                {
                    Frame = trigger.Frame,
                    TriggerType = trigger.TriggerType,
                    EffectId = trigger.EffectId
                });
            }
            
            return clone;
        }
        
        /// <summary>
        /// 获取动作名称（从ActionTable查询）
        /// </summary>
        private string GetActionName()
        {
            // TODO: 从ConfigTableHelper查询ActionTable获取动作名称
            // 这里先返回占位符，后续在集成时实现
            return $"Action_{ActionId}";
        }
        
        private void OnActionIdChanged()
        {
            // 当ActionId改变时，可以自动更新关联信息
        }
    }
    
    /// <summary>
    /// 技能类型枚举
    /// </summary>
    public enum SkillTypeEnum
    {
        攻击 = 1,
        控制 = 2,
        位移 = 3,
        Buff = 4
    }
}

```

现在创建数据验证器：

```csharp
using System.Collections.Generic;
using System.Linq;
using Astrum.Editor.RoleEditor.Services;

namespace Astrum.Editor.RoleEditor.Data
{
    /// <summary>
    /// 技能数据验证器
    /// </summary>
    public static class SkillDataValidator
    {
        private const int MIN_SKILL_ID = 2000;
        private const int MAX_SKILL_ID = 9999;
        
        /// <summary>
        /// 验证技能数据
        /// </summary>
        public static bool Validate(SkillEditorData data, out List<string> errors)
        {
            errors = new List<string>();
            
            if (data == null)
            {
                errors.Add("技能数据为空");
                return false;
            }
            
            // 验证技能ID
            ValidateSkillId(data, errors);
            
            // 验证技能名称
            ValidateSkillName(data, errors);
            
            // 验证技能类型
            ValidateSkillType(data, errors);
            
            // 验证等级配置
            ValidateLevelConfig(data, errors);
            
            // 验证技能动作列表
            ValidateSkillActions(data, errors);
            
            // 验证技能动作与ActionTable的对应关系
            ValidateActionTableMapping(data, errors);
            
            // 验证触发帧配置
            ValidateTriggerFrames(data, errors);
            
            return errors.Count == 0;
        }
        
        /// <summary>
        /// 验证技能ID
        /// </summary>
        private static void ValidateSkillId(SkillEditorData data, List<string> errors)
        {
            if (data.SkillId < MIN_SKILL_ID || data.SkillId > MAX_SKILL_ID)
            {
                errors.Add($"技能ID {data.SkillId} 不在有效范围 [{MIN_SKILL_ID}, {MAX_SKILL_ID}] 内");
            }
        }
        
        /// <summary>
        /// 验证技能名称
        /// </summary>
        private static void ValidateSkillName(SkillEditorData data, List<string> errors)
        {
            if (string.IsNullOrWhiteSpace(data.SkillName))
            {
                errors.Add("技能名称不能为空");
            }
            else if (data.SkillName.Length > 50)
            {
                errors.Add($"技能名称过长（{data.SkillName.Length} > 50）");
            }
        }
        
        /// <summary>
        /// 验证技能类型
        /// </summary>
        private static void ValidateSkillType(SkillEditorData data, List<string> errors)
        {
            if ((int)data.SkillType < 1 || (int)data.SkillType > 4)
            {
                errors.Add($"技能类型 {data.SkillType} 无效（有效值: 1-4）");
            }
        }
        
        /// <summary>
        /// 验证等级配置
        /// </summary>
        private static void ValidateLevelConfig(SkillEditorData data, List<string> errors)
        {
            if (data.RequiredLevel < 1)
            {
                errors.Add($"学习所需等级 {data.RequiredLevel} 无效（最小值: 1）");
            }
            
            if (data.MaxLevel < 1)
            {
                errors.Add($"技能最大等级 {data.MaxLevel} 无效（最小值: 1）");
            }
            
            if (data.MaxLevel < data.RequiredLevel)
            {
                errors.Add($"技能最大等级 {data.MaxLevel} 不能小于学习所需等级 {data.RequiredLevel}");
            }
            
            if (data.DisplayCooldown < 0)
            {
                errors.Add($"展示冷却时间 {data.DisplayCooldown} 不能为负数");
            }
            
            if (data.DisplayCost < 0)
            {
                errors.Add($"展示法力消耗 {data.DisplayCost} 不能为负数");
            }
        }
        
        /// <summary>
        /// 验证技能动作列表
        /// </summary>
        private static void ValidateSkillActions(SkillEditorData data, List<string> errors)
        {
            if (data.SkillActions == null || data.SkillActions.Count == 0)
            {
                errors.Add("技能必须至少包含一个技能动作");
                return;
            }
            
            // 检查是否有重复的ActionId
            var actionIds = data.SkillActions.Select(a => a.ActionId).ToList();
            var duplicates = actionIds.GroupBy(x => x)
                .Where(g => g.Count() > 1)
                .Select(g => g.Key)
                .ToList();
            
            if (duplicates.Count > 0)
            {
                errors.Add($"技能动作列表中存在重复的ActionId: {string.Join(", ", duplicates)}");
            }
            
            // 验证每个技能动作
            for (int i = 0; i < data.SkillActions.Count; i++)
            {
                var action = data.SkillActions[i];
                
                if (action.ActionId <= 0)
                {
                    errors.Add($"技能动作 #{i+1}: ActionId {action.ActionId} 无效");
                }
                
                if (action.SkillId != data.SkillId)
                {
                    errors.Add($"技能动作 #{i+1}: SkillId {action.SkillId} 与当前技能ID {data.SkillId} 不匹配");
                }
                
                if (action.ActualCost < 0)
                {
                    errors.Add($"技能动作 #{i+1}: 实际法力消耗 {action.ActualCost} 不能为负数");
                }
                
                if (action.ActualCooldown < 0)
                {
                    errors.Add($"技能动作 #{i+1}: 实际冷却时间 {action.ActualCooldown} 不能为负数");
                }
            }
        }
        
        /// <summary>
        /// 验证技能动作与ActionTable的对应关系（关键验证）
        /// </summary>
        private static void ValidateActionTableMapping(SkillEditorData data, List<string> errors)
        {
            if (data.SkillActions == null || data.SkillActions.Count == 0)
                return;
            
            foreach (var action in data.SkillActions)
            {
                // 检查ActionId是否在ActionTable中存在
                var actionTable = ConfigTableHelper.GetActionTable(action.ActionId);
                if (actionTable == null)
                {
                    errors.Add($"技能动作 ActionId {action.ActionId} 在 ActionTable 中不存在，必须一一对应");
                }
                else
                {
                    // 验证ActionType是否为"skill"
                    if (!string.IsNullOrEmpty(actionTable.ActionType) && 
                        !actionTable.ActionType.Equals("skill", System.StringComparison.OrdinalIgnoreCase))
                    {
                        errors.Add($"技能动作 ActionId {action.ActionId} 的 ActionType 不是 'skill'（当前: '{actionTable.ActionType}'）");
                    }
                }
            }
        }
        
        /// <summary>
        /// 验证触发帧配置
        /// </summary>
        private static void ValidateTriggerFrames(SkillEditorData data, List<string> errors)
        {
            if (data.SkillActions == null)
                return;
            
            foreach (var action in data.SkillActions)
            {
                if (action.TriggerFrames == null || action.TriggerFrames.Count == 0)
                    continue;
                
                foreach (var trigger in action.TriggerFrames)
                {
                    if (trigger.Frame < 0)
                    {
                        errors.Add($"技能动作 {action.ActionId}: 触发帧 {trigger.Frame} 不能为负数");
                    }
                    
                    if (string.IsNullOrWhiteSpace(trigger.TriggerType))
                    {
                        errors.Add($"技能动作 {action.ActionId}: 触发帧 {trigger.Frame} 的触发类型不能为空");
                    }
                    else
                    {
                        // 验证触发类型是否有效
                        var validTypes = new[] { "Collision", "Direct", "Condition" };
                        if (!validTypes.Contains(trigger.TriggerType))
                        {
                            errors.Add($"技能动作 {action.ActionId}: 触发帧 {trigger.Frame} 的触发类型 '{trigger.TriggerType}' 无效（有效值: {string.Join(", ", validTypes)}）");
                        }
                    }
                    
                    if (trigger.EffectId <= 0)
                    {
                        errors.Add($"技能动作 {action.ActionId}: 触发帧 {trigger.Frame} 的效果ID {trigger.EffectId} 无效");
                    }
                }
                
                // 检查触发帧是否按顺序排列
                var frames = action.TriggerFrames.Select(t => t.Frame).ToList();
                var sortedFrames = frames.OrderBy(f => f).ToList();
                if (!frames.SequenceEqual(sortedFrames))
                {
                    errors.Add($"技能动作 {action.ActionId}: 触发帧应按帧号从小到大排列");
                }
            }
        }
        
        /// <summary>
        /// 快速验证（只验证关键字段）
        /// </summary>
        public static bool QuickValidate(SkillEditorData data)
        {
            if (data == null)
                return false;
            
            if (string.IsNullOrWhiteSpace(data.SkillName))
                return false;
            
            if (data.SkillActions == null || data.SkillActions.Count == 0)
                return false;
            
            if (data.SkillActions.Any(a => a.ActionId <= 0))
                return false;
            
            return true;
        }
    }
}

```

现在创建数据读取器：

```csharp
using System.Collections.Generic;
using System.Linq;
using UnityEngine;
using Astrum.Editor.RoleEditor.Data;
using Astrum.Editor.RoleEditor.Persistence.Core;
using Astrum.Editor.RoleEditor.Persistence.Mappings;

namespace Astrum.Editor.RoleEditor.Persistence
{
    /// <summary>
    /// 技能数据读取器 - 从CSV文件读取技能数据
    /// </summary>
    public static class SkillDataReader
    {
        private const string LOG_PREFIX = "[SkillDataReader]";
        
        /// <summary>
        /// 读取所有技能数据
        /// </summary>
        public static List<SkillEditorData> ReadSkillData()
        {
            var result = new List<SkillEditorData>();
            
            try
            {
                // 1. 读取 SkillTable
                var skillTableConfig = SkillTableData.GetTableConfig();
                var skillTableList = LubanCSVReader.ReadTable<SkillTableData>(skillTableConfig);
                
                Debug.Log($"{LOG_PREFIX} 读取到 {skillTableList.Count} 条 SkillTable 记录");
                
                // 2. 读取 SkillActionTable
                var skillActionTableConfig = SkillActionTableData.GetTableConfig();
                var skillActionTableList = LubanCSVReader.ReadTable<SkillActionTableData>(skillActionTableConfig);
                
                Debug.Log($"{LOG_PREFIX} 读取到 {skillActionTableList.Count} 条 SkillActionTable 记录");
                
                // 3. 按SkillId分组SkillActionTable
                var actionsBySkillId = skillActionTableList
                    .GroupBy(a => a.SkillId)
                    .ToDictionary(g => g.Key, g => g.ToList());
                
                // 4. 组装 SkillEditorData
                foreach (var skillTable in skillTableList)
                {
                    var editorData = ConvertToEditorData(skillTable, actionsBySkillId);
                    if (editorData != null)
                    {
                        result.Add(editorData);
                    }
                }
                
                Debug.Log($"{LOG_PREFIX} 成功读取 {result.Count} 个技能数据");
            }
            catch (System.Exception ex)
            {
                Debug.LogError($"{LOG_PREFIX} 读取技能数据失败: {ex.Message}\n{ex.StackTrace}");
            }
            
            return result;
        }
        
        /// <summary>
        /// 读取单个技能数据
        /// </summary>
        public static SkillEditorData ReadSkillById(int skillId)
        {
            var allSkills = ReadSkillData();
            return allSkills.FirstOrDefault(s => s.SkillId == skillId);
        }
        
        /// <summary>
        /// 转换为编辑器数据
        /// </summary>
        private static SkillEditorData ConvertToEditorData(
            SkillTableData skillTable, 
            Dictionary<int, List<SkillActionTableData>> actionsBySkillId)
        {
            var data = SkillEditorData.CreateInstance<SkillEditorData>();
            
            // 映射 SkillTable 字段
            data.SkillId = skillTable.Id;
            data.SkillName = skillTable.Name ?? "";
            data.SkillDescription = skillTable.Description ?? "";
            data.SkillType = (SkillTypeEnum)skillTable.SkillType;
            data.DisplayCooldown = skillTable.DisplayCooldown;
            data.DisplayCost = skillTable.DisplayCost;
            data.RequiredLevel = skillTable.RequiredLevel;
            data.MaxLevel = skillTable.MaxLevel;
            data.IconId = skillTable.IconId;
            
            // 映射 SkillActionTable 数据
            data.SkillActions = new List<SkillActionData>();
            
            if (actionsBySkillId.TryGetValue(skillTable.Id, out var actions))
            {
                foreach (var actionTable in actions)
                {
                    var actionData = new SkillActionData
                    {
                        ActionId = actionTable.ActionId,
                        SkillId = actionTable.SkillId,
                        AttackBoxInfo = actionTable.AttackBoxInfo ?? "",
                        ActualCost = actionTable.ActualCost,
                        ActualCooldown = actionTable.ActualCooldown,
                        TriggerFrames = actionTable.ParseTriggerFrames()
                    };
                    
                    data.SkillActions.Add(actionData);
                }
                
                Debug.Log($"{LOG_PREFIX} 技能 [{skillTable.Id}] {skillTable.Name} 包含 {actions.Count} 个动作");
            }
            else
            {
                // 技能没有动作，使用SkillTable中的skillActionIds
                var actionIds = skillTable.GetSkillActionIds();
                if (actionIds.Count > 0)
                {
                    Debug.LogWarning($"{LOG_PREFIX} 技能 [{skillTable.Id}] {skillTable.Name} 在 SkillActionTable 中没有记录，" +
                                   $"但在 SkillTable 中配置了 {actionIds.Count} 个动作ID");
                    
                    // 创建占位符动作数据
                    foreach (var actionId in actionIds)
                    {
                        var actionData = new SkillActionData
                        {
                            ActionId = actionId,
                            SkillId = skillTable.Id,
                            AttackBoxInfo = "",
                            ActualCost = skillTable.DisplayCost,
                            ActualCooldown = (int)(skillTable.DisplayCooldown * 60), // 转换为帧数
                            TriggerFrames = new List<TriggerFrameInfo>()
                        };
                        
                        data.SkillActions.Add(actionData);
                    }
                }
                else
                {
                    Debug.LogWarning($"{LOG_PREFIX} 技能 [{skillTable.Id}] {skillTable.Name} 没有配置任何技能动作");
                }
            }
            
            // 初始化编辑器状态
            data.IsNew = false;
            data.IsDirty = false;
            data.ValidationErrors = new List<string>();
            
            return data;
        }
        
        /// <summary>
        /// 验证数据完整性
        /// </summary>
        public static bool ValidateDataIntegrity(out List<string> errors)
        {
            errors = new List<string>();
            
            try
            {
                // 读取所有技能数据
                var skills = ReadSkillData();
                
                // 检查是否有重复的技能ID
                var duplicateIds = skills.GroupBy(s => s.SkillId)
                    .Where(g => g.Count() > 1)
                    .Select(g => g.Key)
                    .ToList();
                
                if (duplicateIds.Count > 0)
                {
                    errors.Add($"发现重复的技能ID: {string.Join(", ", duplicateIds)}");
                }
                
                // 检查每个技能的数据有效性
                foreach (var skill in skills)
                {
                    if (!SkillDataValidator.Validate(skill, out var skillErrors))
                    {
                        errors.AddRange(skillErrors.Select(e => $"技能 [{skill.SkillId}] {skill.SkillName}: {e}"));
                    }
                }
                
                Debug.Log($"{LOG_PREFIX} 数据完整性验证完成，发现 {errors.Count} 个问题");
            }
            catch (System.Exception ex)
            {
                errors.Add($"验证数据完整性时发生异常: {ex.Message}");
                Debug.LogError($"{LOG_PREFIX} {errors[errors.Count - 1]}");
            }
            
            return errors.Count == 0;
        }
        
        /// <summary>
        /// 获取所有技能ID列表
        /// </summary>
        public static List<int> GetAllSkillIds()
        {
            try
            {
                var skillTableConfig = SkillTableData.GetTableConfig();
                var skillTableList = LubanCSVReader.ReadTable<SkillTableData>(skillTableConfig);
                return skillTableList.Select(s => s.Id).ToList();
            }
            catch (System.Exception ex)
            {
                Debug.LogError($"{LOG_PREFIX} 获取技能ID列表失败: {ex.Message}");
                return new List<int>();
            }
        }
        
        /// <summary>
        /// 检查技能ID是否存在
        /// </summary>
        public static bool SkillIdExists(int skillId)
        {
            var allIds = GetAllSkillIds();
            return allIds.Contains(skillId);
        }
    }
}

```

现在创建数据写入器：

```csharp
using System.Collections.Generic;
using System.Linq;
using UnityEngine;
using Astrum.Editor.RoleEditor.Data;
using Astrum.Editor.RoleEditor.Persistence.Core;
using Astrum.Editor.RoleEditor.Persistence.Mappings;

namespace Astrum.Editor.RoleEditor.Persistence
{
    /// <summary>
    /// 技能数据写入器 - 将技能数据写入CSV文件
    /// </summary>
    public static class SkillDataWriter
    {
        private const string LOG_PREFIX = "[SkillDataWriter]";
        
        /// <summary>
        /// 写入所有技能数据
        /// </summary>
        public static bool WriteSkillData(List<SkillEditorData> skills)
        {
            if (skills == null || skills.Count == 0)
            {
                Debug.LogWarning($"{LOG_PREFIX} 技能数据列表为空，无需写入");
                return false;
            }
            
            try
            {
                // 1. 转换为表格数据
                var skillTableList = new List<SkillTableData>();
                var skillActionTableList = new List<SkillActionTableData>();
                
                foreach (var skill in skills)
                {
                    // 转换 SkillTable 数据
                    var skillTable = ConvertToSkillTableData(skill);
                    skillTableList.Add(skillTable);
                    
                    // 转换 SkillActionTable 数据
                    foreach (var action in skill.SkillActions)
                    {
                        var actionTable = ConvertToSkillActionTableData(action);
                        skillActionTableList.Add(actionTable);
                    }
                }
                
                // 2. 写入 SkillTable
                var skillTableConfig = SkillTableData.GetTableConfig();
                bool skillTableSuccess = LubanCSVWriter.WriteTable(skillTableList, skillTableConfig);
                
                if (!skillTableSuccess)
                {
                    Debug.LogError($"{LOG_PREFIX} 写入 SkillTable 失败");
                    return false;
                }
                
                Debug.Log($"{LOG_PREFIX} 成功写入 {skillTableList.Count} 条 SkillTable 记录");
                
                // 3. 写入 SkillActionTable
                var skillActionTableConfig = SkillActionTableData.GetTableConfig();
                bool skillActionTableSuccess = LubanCSVWriter.WriteTable(skillActionTableList, skillActionTableConfig);
                
                if (!skillActionTableSuccess)
                {
                    Debug.LogError($"{LOG_PREFIX} 写入 SkillActionTable 失败");
                    return false;
                }
                
                Debug.Log($"{LOG_PREFIX} 成功写入 {skillActionTableList.Count} 条 SkillActionTable 记录");
                
                Debug.Log($"{LOG_PREFIX} 成功写入 {skills.Count} 个技能数据");
                return true;
            }
            catch (System.Exception ex)
            {
                Debug.LogError($"{LOG_PREFIX} 写入技能数据失败: {ex.Message}\n{ex.StackTrace}");
                return false;
            }
        }
        
        /// <summary>
        /// 写入单个技能数据
        /// </summary>
        public static bool WriteSkill(SkillEditorData skill)
        {
            // 读取现有数据
            var allSkills = SkillDataReader.ReadSkillData();
            
            // 查找并替换
            var existing = allSkills.FirstOrDefault(s => s.SkillId == skill.SkillId);
            if (existing != null)
            {
                allSkills.Remove(existing);
            }
            
            allSkills.Add(skill);
            
            // 写入所有数据
            return WriteSkillData(allSkills);
        }
        
        /// <summary>
        /// 删除技能数据
        /// </summary>
        public static bool DeleteSkill(int skillId)
        {
            // 读取现有数据
            var allSkills = SkillDataReader.ReadSkillData();
            
            // 移除指定技能
            var removed = allSkills.RemoveAll(s => s.SkillId == skillId);
            
            if (removed == 0)
            {
                Debug.LogWarning($"{LOG_PREFIX} 未找到技能ID {skillId}，无需删除");
                return false;
            }
            
            Debug.Log($"{LOG_PREFIX} 删除技能 {skillId}");
            
            // 写入所有数据
            return WriteSkillData(allSkills);
        }
        
        /// <summary>
        /// 转换为 SkillTableData
        /// </summary>
        private static SkillTableData ConvertToSkillTableData(SkillEditorData skill)
        {
            var data = new SkillTableData
            {
                Id = skill.SkillId,
                Name = skill.SkillName,
                Description = skill.SkillDescription,
                SkillType = (int)skill.SkillType,
                DisplayCooldown = skill.DisplayCooldown,
                DisplayCost = skill.DisplayCost,
                RequiredLevel = skill.RequiredLevel,
                MaxLevel = skill.MaxLevel,
                IconId = skill.IconId
            };
            
            // 设置技能动作ID列表
            var actionIds = skill.SkillActions.Select(a => a.ActionId).ToList();
            data.SetSkillActionIds(actionIds);
            
            return data;
        }
        
        /// <summary>
        /// 转换为 SkillActionTableData
        /// </summary>
        private static SkillActionTableData ConvertToSkillActionTableData(SkillActionData action)
        {
            var data = new SkillActionTableData
            {
                ActionId = action.ActionId,
                SkillId = action.SkillId,
                AttackBoxInfo = action.AttackBoxInfo ?? "",
                ActualCost = action.ActualCost,
                ActualCooldown = action.ActualCooldown
            };
            
            // 设置触发帧信息
            data.SetTriggerFrames(action.TriggerFrames);
            
            return data;
        }
        
        /// <summary>
        /// 验证写入前的数据
        /// </summary>
        public static bool ValidateBeforeWrite(List<SkillEditorData> skills, out List<string> errors)
        {
            errors = new List<string>();
            
            if (skills == null || skills.Count == 0)
            {
                errors.Add("技能数据列表为空");
                return false;
            }
            
            // 检查重复的技能ID
            var duplicateIds = skills.GroupBy(s => s.SkillId)
                .Where(g => g.Count() > 1)
                .Select(g => g.Key)
                .ToList();
            
            if (duplicateIds.Count > 0)
            {
                errors.Add($"存在重复的技能ID: {string.Join(", ", duplicateIds)}");
            }
            
            // 验证每个技能
            foreach (var skill in skills)
            {
                if (!SkillDataValidator.Validate(skill, out var skillErrors))
                {
                    errors.AddRange(skillErrors.Select(e => $"技能 [{skill.SkillId}] {skill.SkillName}: {e}"));
                }
            }
            
            // 检查 SkillActionTable 中的 ActionId 是否重复
            var allActionIds = skills.SelectMany(s => s.SkillActions.Select(a => a.ActionId)).ToList();
            var duplicateActionIds = allActionIds.GroupBy(x => x)
                .Where(g => g.Count() > 1)
                .Select(g => g.Key)
                .ToList();
            
            if (duplicateActionIds.Count > 0)
            {
                errors.Add($"SkillActionTable 中存在重复的 ActionId（违反一一对应关系）: {string.Join(", ", duplicateActionIds)}");
            }
            
            return errors.Count == 0;
        }
        
        /// <summary>
        /// 批量更新技能数据
        /// </summary>
        public static bool BatchUpdate(List<SkillEditorData> skillsToUpdate)
        {
            if (skillsToUpdate == null || skillsToUpdate.Count == 0)
            {
                Debug.LogWarning($"{LOG_PREFIX} 没有需要更新的技能");
                return false;
            }
            
            try
            {
                // 读取现有数据
                var allSkills = SkillDataReader.ReadSkillData();
                
                // 更新或添加
                foreach (var updateSkill in skillsToUpdate)
                {
                    var existing = allSkills.FirstOrDefault(s => s.SkillId == updateSkill.SkillId);
                    if (existing != null)
                    {
                        allSkills.Remove(existing);
                    }
                    allSkills.Add(updateSkill);
                }
                
                // 写入所有数据
                return WriteSkillData(allSkills);
            }
            catch (System.Exception ex)
            {
                Debug.LogError($"{LOG_PREFIX} 批量更新失败: {ex.Message}");
                return false;
            }
        }
        
        /// <summary>
        /// 导出技能数据到备份文件
        /// </summary>
        public static bool ExportToBackup(List<SkillEditorData> skills, string backupSuffix = null)
        {
            if (string.IsNullOrEmpty(backupSuffix))
            {
                backupSuffix = System.DateTime.Now.ToString("yyyyMMdd_HHmmss");
            }
            
            try
            {
                // 修改配置路径为备份路径
                var skillTableConfig = SkillTableData.GetTableConfig();
                skillTableConfig.FilePath = skillTableConfig.FilePath.Replace(".csv", $"_backup_{backupSuffix}.csv");
                
                var skillActionTableConfig = SkillActionTableData.GetTableConfig();
                skillActionTableConfig.FilePath = skillActionTableConfig.FilePath.Replace(".csv", $"_backup_{backupSuffix}.csv");
                
                // 转换数据
                var skillTableList = skills.Select(ConvertToSkillTableData).ToList();
                var skillActionTableList = skills.SelectMany(s => s.SkillActions.Select(ConvertToSkillActionTableData)).ToList();
                
                // 写入备份文件
                bool success = LubanCSVWriter.WriteTable(skillTableList, skillTableConfig) &&
                               LubanCSVWriter.WriteTable(skillActionTableList, skillActionTableConfig);
                
                if (success)
                {
                    Debug.Log($"{LOG_PREFIX} 成功导出备份到: {backupSuffix}");
                }
                
                return success;
            }
            catch (System.Exception ex)
            {
                Debug.LogError($"{LOG_PREFIX} 导出备份失败: {ex.Message}");
                return false;
            }
        }
    }
}

```

现在更新 `TriggerFrameInfo` 使其在 Data 层也可用，并更新 `SkillEditorData.cs`：

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using Sirenix.OdinInspector;
using UnityEngine;
using Astrum.Editor.RoleEditor.Persistence.Mappings;
```

```csharp
using Astrum.Editor.RoleEditor.Persistence.Core;
using System.Collections.Generic;

namespace Astrum.Editor.RoleEditor.Persistence.Mappings
{
    /// <summary>
    /// SkillActionTable数据映射
    /// </summary>
    public class SkillActionTableData
    {
        [TableField(0, "actionId")]
        public int ActionId { get; set; }
        
        [TableField(1, "skillId")]
        public int SkillId { get; set; }
        
        [TableField(2, "attackBoxInfo")]
        public string AttackBoxInfo { get; set; }
        
        [TableField(3, "actualCost")]
        public int ActualCost { get; set; }
        
        [TableField(4, "actualCooldown")]
        public int ActualCooldown { get; set; }
        
        [TableField(5, "triggerFrames")]
        public string TriggerFrames { get; set; }
        
        /// <summary>
        /// 解析触发帧信息
        /// 格式: "Frame5:Collision:4001,Frame8:Direct:4002"
        /// </summary>
        public List<TriggerFrameInfo> ParseTriggerFrames()
        {
            var result = new List<TriggerFrameInfo>();
            
            if (string.IsNullOrEmpty(TriggerFrames))
                return result;
            
            var parts = TriggerFrames.Split(',');
            foreach (var part in parts)
            {
                var trimmed = part.Trim();
                if (string.IsNullOrEmpty(trimmed))
                    continue;
                
                var segments = trimmed.Split(':');
                if (segments.Length >= 3)
                {
                    // 解析帧号（去掉"Frame"前缀）
                    var frameStr = segments[0].Replace("Frame", "").Trim();
                    if (int.TryParse(frameStr, out int frame) &&
                        int.TryParse(segments[2].Trim(), out int effectId))
                    {
                        result.Add(new TriggerFrameInfo
                        {
                            Frame = frame,
                            TriggerType = segments[1].Trim(),
                            EffectId = effectId
                        });
                    }
                }
            }
            
            return result;
        }
        
        /// <summary>
        /// 设置触发帧信息
        /// </summary>
        public void SetTriggerFrames(List<TriggerFrameInfo> triggerFrames)
        {
            if (triggerFrames == null || triggerFrames.Count == 0)
            {
                TriggerFrames = string.Empty;
                return;
            }
            
            var parts = new List<string>();
            foreach (var info in triggerFrames)
            {
                parts.Add($"Frame{info.Frame}:{info.TriggerType}:{info.EffectId}");
            }
            
            TriggerFrames = string.Join(",", parts);
        }
        
        /// <summary>
        /// 获取表配置
        /// </summary>
        public static LubanTableConfig GetTableConfig()
        {
            return new LubanTableConfig
            {
                FilePath = "AstrumConfig/Tables/Datas/Skill/#SkillActionTable.csv",
                HeaderLines = 4,
                HasEmptyFirstColumn = true,
                Header = new TableHeader
                {
                    VarNames = new List<string>
                    {
                        "actionId", "skillId", "attackBoxInfo", "actualCost",
                        "actualCooldown", "triggerFrames"
                    },
                    Types = new List<string>
                    {
                        "int", "int", "string", "int", "int", "string"
                    },
                    Groups = new List<string>
                    {
                        "", "", "", "", "", ""
                    },
                    Descriptions = new List<string>
                    {
                        "动作ID", "技能ID", "攻击碰撞盒信息", "实际法力消耗",
                        "实际冷却时间(帧)", "触发帧信息"
                    }
                }
            };
        }
    }
    
    /// <summary>
    /// 触发帧信息（可序列化）
    /// </summary>
    [System.Serializable]
    public class TriggerFrameInfo
    {
        /// <summary>帧号</summary>
        public int Frame { get; set; }
        
        /// <summary>触发类型（Collision/Direct/Condition）</summary>
        public string TriggerType { get; set; } = "Direct";
        
        /// <summary>效果ID</summary>
        public int EffectId { get; set; }
        
        /// <summary>用于Odin显示</summary>
        public string DisplayName => ToString();
        
        public override string ToString()
        {
            return $"Frame{Frame}:{TriggerType}:{EffectId}";
        }
    }
}


```

现在更新TODO列表并检查编译错误：

很好！没有编译错误。现在创建一个测试脚本来测试数据层功能：

```csharp
using UnityEngine;
using UnityEditor;
using Astrum.Editor.RoleEditor.Data;
using Astrum.Editor.RoleEditor.Persistence;
using Astrum.Editor.RoleEditor.Persistence.Mappings;
using System.Collections.Generic;
using System.Linq;

namespace Astrum.Editor.RoleEditor.Test
{
    /// <summary>
    /// 技能数据测试工具
    /// </summary>
    public static class SkillDataTest
    {
        private const string MENU_ROOT = "Tools/Role & Skill Editor/Skill Data Tests/";
        
        // ===== 读取测试 =====
        
        [MenuItem(MENU_ROOT + "1. 测试读取技能数据")]
        public static void TestReadSkillData()
        {
            Debug.Log("========== 开始测试读取技能数据 ==========");
            
            try
            {
                var skills = SkillDataReader.ReadSkillData();
                
                Debug.Log($"✓ 成功读取 {skills.Count} 个技能");
                
                foreach (var skill in skills)
                {
                    Debug.Log($"  - [{skill.SkillId}] {skill.SkillName}");
                    Debug.Log($"    类型: {skill.SkillType}, 等级: {skill.RequiredLevel}-{skill.MaxLevel}");
                    Debug.Log($"    动作数量: {skill.SkillActions.Count}");
                    
                    foreach (var action in skill.SkillActions)
                    {
                        Debug.Log($"      └─ 动作 {action.ActionId}: {action.TriggerFrames.Count} 个触发帧");
                    }
                }
                
                EditorUtility.DisplayDialog("测试成功", 
                    $"成功读取 {skills.Count} 个技能数据", "确定");
            }
            catch (System.Exception ex)
            {
                Debug.LogError($"✗ 测试失败: {ex.Message}\n{ex.StackTrace}");
                EditorUtility.DisplayDialog("测试失败", 
                    $"读取技能数据失败：{ex.Message}", "确定");
            }
            
            Debug.Log("========== 测试完成 ==========");
        }
        
        [MenuItem(MENU_ROOT + "2. 测试读取单个技能")]
        public static void TestReadSingleSkill()
        {
            Debug.Log("========== 开始测试读取单个技能 ==========");
            
            try
            {
                int testSkillId = 2001; // 测试技能ID
                var skill = SkillDataReader.ReadSkillById(testSkillId);
                
                if (skill != null)
                {
                    Debug.Log($"✓ 成功读取技能 [{skill.SkillId}] {skill.SkillName}");
                    Debug.Log($"  描述: {skill.SkillDescription}");
                    Debug.Log($"  类型: {skill.SkillType}");
                    Debug.Log($"  冷却: {skill.DisplayCooldown}秒, 消耗: {skill.DisplayCost}");
                    Debug.Log($"  动作列表:");
                    
                    foreach (var action in skill.SkillActions)
                    {
                        Debug.Log($"    - ActionId: {action.ActionId}");
                        Debug.Log($"      攻击盒: {action.AttackBoxInfo}");
                        Debug.Log($"      实际消耗: {action.ActualCost}, 实际冷却: {action.ActualCooldown}帧");
                        Debug.Log($"      触发帧: {string.Join(", ", action.TriggerFrames.Select(t => t.ToString()))}");
                    }
                    
                    EditorUtility.DisplayDialog("测试成功", 
                        $"成功读取技能 [{skill.SkillId}] {skill.SkillName}", "确定");
                }
                else
                {
                    Debug.LogWarning($"✗ 未找到技能ID {testSkillId}");
                    EditorUtility.DisplayDialog("测试警告", 
                        $"未找到技能ID {testSkillId}", "确定");
                }
            }
            catch (System.Exception ex)
            {
                Debug.LogError($"✗ 测试失败: {ex.Message}\n{ex.StackTrace}");
                EditorUtility.DisplayDialog("测试失败", 
                    $"读取单个技能失败：{ex.Message}", "确定");
            }
            
            Debug.Log("========== 测试完成 ==========");
        }
        
        // ===== 验证测试 =====
        
        [MenuItem(MENU_ROOT + "3. 测试数据验证")]
        public static void TestDataValidation()
        {
            Debug.Log("========== 开始测试数据验证 ==========");
            
            try
            {
                var skills = SkillDataReader.ReadSkillData();
                
                int validCount = 0;
                int invalidCount = 0;
                
                foreach (var skill in skills)
                {
                    if (SkillDataValidator.Validate(skill, out var errors))
                    {
                        validCount++;
                        Debug.Log($"✓ 技能 [{skill.SkillId}] {skill.SkillName} 验证通过");
                    }
                    else
                    {
                        invalidCount++;
                        Debug.LogWarning($"✗ 技能 [{skill.SkillId}] {skill.SkillName} 验证失败:");
                        foreach (var error in errors)
                        {
                            Debug.LogWarning($"    - {error}");
                        }
                    }
                }
                
                Debug.Log($"验证完成: {validCount} 个通过, {invalidCount} 个失败");
                
                EditorUtility.DisplayDialog("验证完成", 
                    $"验证结果:\n通过: {validCount} 个\n失败: {invalidCount} 个", "确定");
            }
            catch (System.Exception ex)
            {
                Debug.LogError($"✗ 测试失败: {ex.Message}\n{ex.StackTrace}");
                EditorUtility.DisplayDialog("测试失败", 
                    $"数据验证失败：{ex.Message}", "确定");
            }
            
            Debug.Log("========== 测试完成 ==========");
        }
        
        [MenuItem(MENU_ROOT + "4. 测试数据完整性")]
        public static void TestDataIntegrity()
        {
            Debug.Log("========== 开始测试数据完整性 ==========");
            
            try
            {
                if (SkillDataReader.ValidateDataIntegrity(out var errors))
                {
                    Debug.Log("✓ 数据完整性验证通过，没有发现问题");
                    EditorUtility.DisplayDialog("验证成功", 
                        "数据完整性验证通过", "确定");
                }
                else
                {
                    Debug.LogWarning($"✗ 数据完整性验证失败，发现 {errors.Count} 个问题:");
                    foreach (var error in errors)
                    {
                        Debug.LogWarning($"  - {error}");
                    }
                    
                    EditorUtility.DisplayDialog("验证失败", 
                        $"发现 {errors.Count} 个问题，请查看Console", "确定");
                }
            }
            catch (System.Exception ex)
            {
                Debug.LogError($"✗ 测试失败: {ex.Message}\n{ex.StackTrace}");
                EditorUtility.DisplayDialog("测试失败", 
                    $"数据完整性验证失败：{ex.Message}", "确定");
            }
            
            Debug.Log("========== 测试完成 ==========");
        }
        
        // ===== ActionTable 映射测试 =====
        
        [MenuItem(MENU_ROOT + "5. 测试 ActionTable 对应关系")]
        public static void TestActionTableMapping()
        {
            Debug.Log("========== 开始测试 ActionTable 对应关系 ==========");
            
            try
            {
                var skills = SkillDataReader.ReadSkillData();
                
                int totalActions = 0;
                int validActions = 0;
                int invalidActions = 0;
                var invalidActionIds = new List<int>();
                
                foreach (var skill in skills)
                {
                    foreach (var action in skill.SkillActions)
                    {
                        totalActions++;
                        var actionTable = Services.ConfigTableHelper.GetActionTable(action.ActionId);
                        
                        if (actionTable != null)
                        {
                            validActions++;
                            Debug.Log($"✓ 技能 [{skill.SkillId}] 的动作 {action.ActionId} 在 ActionTable 中存在");
                            Debug.Log($"    ActionName: {actionTable.Name}, ActionType: {actionTable.ActionType}");
                        }
                        else
                        {
                            invalidActions++;
                            invalidActionIds.Add(action.ActionId);
                            Debug.LogError($"✗ 技能 [{skill.SkillId}] 的动作 {action.ActionId} 在 ActionTable 中不存在！");
                        }
                    }
                }
                
                Debug.Log($"对应关系测试完成:");
                Debug.Log($"  总动作数: {totalActions}");
                Debug.Log($"  有效: {validActions}");
                Debug.Log($"  无效: {invalidActions}");
                
                if (invalidActions > 0)
                {
                    EditorUtility.DisplayDialog("测试失败", 
                        $"发现 {invalidActions} 个无效的ActionId，不满足一一对应关系\n" +
                        $"无效ID: {string.Join(", ", invalidActionIds)}", "确定");
                }
                else
                {
                    EditorUtility.DisplayDialog("测试成功", 
                        $"所有技能动作都与 ActionTable 正确对应\n总计: {totalActions} 个动作", "确定");
                }
            }
            catch (System.Exception ex)
            {
                Debug.LogError($"✗ 测试失败: {ex.Message}\n{ex.StackTrace}");
                EditorUtility.DisplayDialog("测试失败", 
                    $"ActionTable 对应关系测试失败：{ex.Message}", "确定");
            }
            
            Debug.Log("========== 测试完成 ==========");
        }
        
        // ===== 写入测试（慎用！）=====
        
        [MenuItem(MENU_ROOT + "写入测试/创建测试技能")]
        public static void TestCreateSkill()
        {
            Debug.Log("========== 开始测试创建技能 ==========");
            
            try
            {
                // 创建测试技能
                var testSkill = SkillEditorData.CreateDefault(9999);
                testSkill.SkillName = "测试技能";
                testSkill.SkillDescription = "这是一个测试技能";
                testSkill.SkillType = SkillTypeEnum.攻击;
                
                // 添加一个测试动作
                testSkill.AddSkillAction(3001); // 使用现有的ActionId
                
                // 验证
                if (!SkillDataValidator.Validate(testSkill, out var errors))
                {
                    Debug.LogError("✗ 测试技能验证失败:");
                    foreach (var error in errors)
                    {
                        Debug.LogError($"  - {error}");
                    }
                    return;
                }
                
                Debug.Log("✓ 测试技能创建成功:");
                Debug.Log($"  ID: {testSkill.SkillId}");
                Debug.Log($"  名称: {testSkill.SkillName}");
                Debug.Log($"  动作数: {testSkill.SkillActions.Count}");
                
                EditorUtility.DisplayDialog("创建成功", 
                    "测试技能创建成功（未写入文件）\n" +
                    "请查看Console查看详细信息", "确定");
            }
            catch (System.Exception ex)
            {
                Debug.LogError($"✗ 测试失败: {ex.Message}\n{ex.StackTrace}");
                EditorUtility.DisplayDialog("测试失败", 
                    $"创建测试技能失败：{ex.Message}", "确定");
            }
            
            Debug.Log("========== 测试完成 ==========");
        }
        
        // ===== 实用工具 =====
        
        [MenuItem(MENU_ROOT + "工具/列出所有技能ID")]
        public static void ListAllSkillIds()
        {
            Debug.Log("========== 所有技能ID列表 ==========");
            
            try
            {
                var skillIds = SkillDataReader.GetAllSkillIds();
                Debug.Log($"共 {skillIds.Count} 个技能:");
                foreach (var id in skillIds)
                {
                    Debug.Log($"  - {id}");
                }
            }
            catch (System.Exception ex)
            {
                Debug.LogError($"✗ 获取失败: {ex.Message}");
            }
            
            Debug.Log("====================================");
        }
        
        [MenuItem(MENU_ROOT + "工具/清除 ConfigTableHelper 缓存")]
        public static void ClearConfigCache()
        {
            Services.ConfigTableHelper.ClearCache();
            Debug.Log("✓ ConfigTableHelper 缓存已清除");
            EditorUtility.DisplayDialog("清除成功", 
                "ConfigTableHelper 缓存已清除", "确定");
        }
    }
}

```

现在检查编译错误并编译项目：

---

**User**

继续

